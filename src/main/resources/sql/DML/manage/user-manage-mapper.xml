<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.wayplus.travel.mapper.manage.UserManageMapper">

    <select id="selectUserListCount" parameterType="HashMap" resultType="Integer">
        SELECT count(*) FROM user
         WHERE user_role = 'USER'
               <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(type)">
                   <if test="type != 'ALL'">
                       AND account_status = #{type}
                   </if>
               </if>
               <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(searchKey)">
                   AND (
                         user_email LIKE CONCAT('%', #{searchKey}, '%')
                         OR user_name LIKE CONCAT('%', #{searchKey}, '%')
                         OR REPLACE(user_mobile, '-', '') LIKE CONCAT('%', REPLACE(#{searchKey}, '-', ''), '%')
                       )
               </if>
               <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(searchText)">
                   AND (  CONCAT(ifnull(user_name,''), ifnull(REPLACE(user_mobile, '-', ''),''), ifnull(user_email,'')) LIKE CONCAT('%', #{searchText}, '%') )
               </if>
               <if test="isOnlyNewJoin">and user_join_date BETWEEN  now() - interval 3 day and now()</if>
    </select>

    <select id="selectUserList" parameterType="HashMap" resultType="LoginUser">
        SELECT user_email, user_join_type, user_name,
               user_nationality, ifnull(user_mobile,'') user_mobile, user_tel,
               user_addr_zipcode, user_addr_extra,
               user_addr_jibun, user_addr_road, user_addr_detail,
               user_role, user_class_name, user_class_code,
               user_group_code,
               user_token_id, user_grade_id, user_grade,
               user_grade_start, user_grade_end,
               user_membership_id, user_membership_grade,
               user_membership_start, user_membership_end,
               user_verified_email, user_verified_mobile,
               user_ci, user_di, user_di_corp,
               user_join_date, user_modify_date,
               last_login_date, last_password_date,
               last_login_fail_count, account_status,
               naver_token, naver_email, naver_join_date,
               kakao_token, kakao_email, kakao_join_date,
               google_token, google_email, google_join_date,
               facebook_token, facebook_email, facebook_join_date,
               secondary_email, privacy_retention_days, mailing_yn
          FROM user
         WHERE user_role = 'USER'
               <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(type)">
                   <if test="type != 'ALL'">
                       AND account_status = #{type}
                   </if>
               </if>
               <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(searchKey)">
                   AND (
                           user_email LIKE CONCAT('%', #{searchKey}, '%')
                           OR user_name LIKE CONCAT('%', #{searchKey}, '%')
                           OR REPLACE(user_mobile, '-', '') LIKE CONCAT('%', REPLACE(#{searchKey}, '-', ''), '%')
                       )
               </if>
               <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(searchText)">
                   AND (  CONCAT(ifnull(user_name,''), ifnull(REPLACE(user_mobile, '-', ''),''), ifnull(user_email,'')) LIKE CONCAT('%', #{searchText}, '%') )
               </if>
         ORDER BY user_join_date DESC
         <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(itemStartPosition) and @kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(pagePerSize)">
         LIMIT #{itemStartPosition}, #{pagePerSize}
         </if>
    </select>

    <update id="updateUserAccountStatus" parameterType="HashMap">
        UPDATE user
           SET account_status = #{accountStatus}, user_modify_date = now()
         WHERE user_email = #{userEmail} AND user_token_id = #{userTokenId}
    </update>

    <update id="updateUserAccountSimpleInfo" parameterType="HashMap">
        UPDATE user
		<set>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userName)"> user_name = #{userName},</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userMemo)"> user_memo = #{userMemo},</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userGrade)"> user_grade = #{userGrade},</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userMobile)"> user_mobile = #{userMobile},</if>
           user_modify_date = now()
		</set>
         WHERE user_email = #{userEmail} AND user_token_id = #{userTokenId}
    </update>

    <select id="selectUserDetail" parameterType="HashMap" resultType="LoginUser">
        SELECT user_email, user_join_type, user_name,
               user_nationality, user_mobile, user_tel,
               user_addr_zipcode, user_addr_extra,
               user_addr_jibun, user_addr_road, user_addr_detail,
               user_role, user_class_name, user_class_code,
               user_group_code,
               user_token_id, user_grade_id, user_grade,
               user_grade_start, user_grade_end,
               user_membership_id, user_membership_grade,
               user_membership_start, user_membership_end,
               user_verified_email, user_verified_mobile,
               user_ci, user_di, user_di_corp,
               user_join_date, user_modify_date,
               last_login_date, last_password_date,
               last_login_fail_count, account_status,
               naver_token, naver_email, naver_join_date,
               kakao_token, kakao_email, kakao_join_date,
               google_token, google_email, google_join_date,
               facebook_token, facebook_email, facebook_join_date,
               secondary_email, privacy_retention_days, mailing_yn
          FROM user
		<where>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userRole)">and user_role = #{userRole}</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userName)">and user_name = #{userName}</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)">and user_email = #{userEmail}</if>
		</where>
    </select>

    <insert id="insertUser" parameterType="LoginUser" useGeneratedKeys="true" keyProperty="userEmail">
        INSERT INTO user
            SET user_email = #{userEmail}
                , user_password = #{userPassword}
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userJoinType)">, user_join_type = #{userJoinType}</if>
                , user_name = #{userName}
                , user_mobile = #{userMobile}
                , user_tel = #{userTel}
                , user_addr_zipcode = #{userAddrZipcode}
                , user_addr_extra = #{userAddrExtra}
                , user_addr_jibun = #{userAddrJibun}
                , user_addr_road = #{userAddrRoad}
                , user_addr_detail = #{userAddrDetail}
                , user_nationality = #{userNationality}
                , user_birthday = #{userBirthday}
                , user_gender = #{userGender}
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userRole)">, user_role = #{userRole}</if>
                , user_class_name = #{userClassName}
                , user_class_code = #{userClassCode}
                , user_group_code = #{userGroupCode}
                , user_token_id = #{userTokenId}
                , user_grade = #{userGrade}
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userVerifiedEmail)">, user_verified_email = #{userVerifiedEmail}</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userVerifiedMobile)">, user_verified_mobile = #{userVerifiedMobile}</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userCi)">, user_ci = #{userCi}</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userDi)">, user_di = #{userDi}</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userDiCorp)">, user_di_corp = #{userDiCorp}</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(naverToken)">, naver_token = #{naverToken}</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(naverEmail)">, naver_email = #{naverEmail}</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(naverToken)">, naver_join_date = now()</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(kakaoToken)">, kakao_token = #{kakaoToken}</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(kakaoEmail)">, kakao_email = #{kakaoEmail}</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(kakaoToken)">, kakao_join_date = now()</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(googleToken)">, google_token = #{googleToken}</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(googleEmail)">, google_email = #{googleEmail}</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(googleToken)">, google_join_date = now()</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(facebookToken)">, facebook_token = #{facebookToken}</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(facebookEmail)">, facebook_email = #{facebookEmail}</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(facebookToken)">, facebook_join_date = now()</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(secondaryEmail)">, secondary_email = #{secondary_email}</if>
                <if test="privacyRetentionDays > 0">, privacy_retention_days = #{privacyRetentionDays}</if>
                <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(mailingYn)">, mailing_yn = #{mailingYn}</if>
    </insert>

    <select id="selectUserCustomerInfo" parameterType="HashMap" resultType="UserCustomerInfo">
        SELECT id, user_email,
               customer_grade, customer_note,
               create_type, create_id, create_date
          FROM user_customer_info
         WHERE user_email = #{value}
         ORDER BY id DESC
         LIMIT 1
    </select>

    <update id="updateUserInfoByManager" parameterType="LoginUser">
        UPDATE user
           SET user_name = #{userName}, user_mobile = #{userMobile},
               user_modify_date = now()
         WHERE user_email = #{userEmail} AND user_token_id = #{userTokenId}
    </update>

    <insert id="insertUserCustomerInfo" parameterType="UserCustomerInfo">
        INSERT INTO user_customer_info
           SET user_email = #{userEmail},
               customer_grade = #{customerGrade},
               customer_note = #{customerNote},
               create_type = #{createType},
               create_id = #{createId},
               create_date = now()
    </insert>

    <select id="selectUserCustomerCounselListCount" parameterType="HashMap" resultType="Integer">
        SELECT count(*) FROM user_customer_counsel
		<where>
           and delete_yn = 'N'
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)">AND user_email = #{userEmail}</if>

			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(dateType)">
				<choose>
					<when test="dateType eq 'req'">request_date between DATE_FORMAT(#{dateFrom}, '%Y-%m-%d') and DATE_FORMAT(#{dateTo}, '%Y-%m-%d') </when>
					<when test="dateType eq 'res'">response_date between DATE_FORMAT(#{dateFrom}, '%Y-%m-%d') and DATE_FORMAT(#{dateTo}, '%Y-%m-%d')</when>
				</choose>
			</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(requestCategory)">AND request_category = #{requestCategory}</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(responseName)">and response_name like concat('%',#{responseName},'%')</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(searchKey)">and concat(request_name,request_tel) like concat('%',#{searchKey},'%')</if>
		</where>
    </select>

    <select id="selectUserCustomerCounselList" parameterType="HashMap" resultType="UserCustomerCounsel">
        SELECT id, a.user_email,
               b.user_name,
               b.user_mobile,
               DATE_FORMAT( request_date , '%Y-%m-%d') request_date, request_category, request_subcategory,
               request_name, request_relation,
               request_tel, request_text,
               DATE_FORMAT( response_date , '%Y-%m-%d') response_date, response_name,
               response_text,
               response_category,c.name response_category_name, response_subcategory,
               a.create_id,
               a.create_date,
               a.last_update_id,
               a.last_update_date
          FROM user_customer_counsel a
          LEFT join user b on a.user_email = b.user_email
          left join code_item c on a.response_category = c.code and c.upper_code = 'statusType'
		<where>
           and a.delete_yn = 'N'
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)">AND a.user_email = #{userEmail}</if>

			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(dateType)">
				<choose>
					<when test="dateType eq 'req'">request_date between DATE_FORMAT(#{dateFrom}, '%Y-%m-%d') and DATE_FORMAT(#{dateTo}, '%Y-%m-%d') </when>
					<when test="dateType eq 'res'">response_date between DATE_FORMAT(#{dateFrom}, '%Y-%m-%d') and DATE_FORMAT(#{dateTo}, '%Y-%m-%d')</when>
				</choose>
			</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(requestCategory)">AND request_category = #{requestCategory}</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(responseName)">and response_name like concat('%',#{responseName},'%')</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(searchKey)">and concat(request_name,request_tel) like concat('%',#{searchKey},'%')</if>
		</where>
         ORDER BY request_date DESC
         LIMIT #{itemStartPosition}, #{pagePerSize}
    </select>

    <select id="selectUserCustomerCounsel" parameterType="HashMap" resultType="UserCustomerCounsel">
        SELECT id, a.user_email,
               b.user_name,
               b.user_mobile,
               DATE_FORMAT( request_date , '%Y-%m-%d') request_date, request_category, request_subcategory,
               request_name, request_relation,
               request_tel, request_text,
               DATE_FORMAT( response_date , '%Y-%m-%d') response_date, response_name,
               response_text,
               response_category, response_subcategory,
               create_id, create_date,
               last_update_id, last_update_date
          FROM user_customer_counsel a
          LEFT join user b on a.user_email = b.user_email
		<where>
           and delete_yn = 'N'
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(id)">AND id = #{id}</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)">AND a.user_email = #{userEmail}</if>

			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(dateType)">
				<choose>
					<when test="dateType eq 'req'">request_date between DATE_FORMAT(#{dateFrom}, '%Y-%m-%d') and DATE_FORMAT(#{dateTo}, '%Y-%m-%d') </when>
					<when test="dateType eq 'res'">response_date between DATE_FORMAT(#{dateFrom}, '%Y-%m-%d') and DATE_FORMAT(#{dateTo}, '%Y-%m-%d')</when>
				</choose>
			</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(requestCategory)">AND request_category = #{requestCategory}</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(responseName)">and response_name like concat('%',#{responseName},'%')</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(searchKey)">and concat(request_name,request_tel) like concat('%',#{searchKey},'%')</if>
		</where>
    </select>

    <insert id="insertUserCustomerCounsel" parameterType="UserCustomerCounsel">
        INSERT INTO user_customer_counsel
           SET user_email = #{userEmail},
               request_date = date_format(#{requestDate},'%Y-%m-%d'),
               request_category = #{requestCategory},
               request_subcategory = #{requestSubcategory},
               request_name = #{requestName},
               request_relation = #{requestRelation},
               request_tel = #{requestTel},
               request_text = #{requestText},
		<choose>
			<when test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(responseDate)">response_date = date_format(#{responseDate},'%Y-%m-%d'),</when>
			<otherwise>response_date = now(),</otherwise>
		</choose>
               response_name = #{responseName},
               response_text = #{responseText},
               response_category = #{responseCategory},
               response_subcategory = #{responseSubcategory},
               create_id = #{createId},
               create_date = now()
    </insert>

    <update id="deleteUserCustomerCounsel" parameterType="UserCustomerCounsel">
        Update user_customer_counsel
           SET delete_yn = 'Y',
               delete_date = now()
		<where>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(id)">AND id = #{id}</if>
		</where>
    </update>

    <update id="restoreUserCustomerCounsel" parameterType="UserCustomerCounsel">
        Update user_customer_counsel
           SET delete_yn = 'N',
               delete_date = null
		<where>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(id)">AND id = #{id}</if>
		</where>
    </update>


<!--################################### Reservation ###################################-->
	 <select id="selectCountUserCustomerPayment" parameterType="HashMap" resultType="Integer">
        SELECT count(id)
          FROM (
			SELECT a.id
			FROM user_customer_payment a
		<where>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(id)" >	and id=#{id}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(reservationId)" >	and reservation_id=#{reservationId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)" >	and user_email=#{userEmail}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payDate)" >	and pay_date=#{payDate}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payDivision)" >	and pay_division=#{payDivision}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payMethod)" >	and pay_method=#{payMethod}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payComment)" >	and pay_comment=#{payComment}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payAmount)" >	and pay_amount=#{payAmount}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(mid)" >	and mid=#{mid}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(tid)" >	and tid=#{tid}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(statusCode)" >	and status_code=#{statusCode}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(statusName)" >	and status_name=#{statusName}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(createId)" >	and create_id=#{createId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(createDate)" >	and create_date=#{createDate}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(lastUpdateId)" >	and last_update_id=#{lastUpdateId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(lastUpdateDate)" >	and last_update_date=#{lastUpdateDate}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteYn)" >	and delete_yn=#{deleteYn}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteId)" >	and delete_id=#{deleteId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteDate)" >	and delete_date=#{deleteDate}	</if>
         </where>) a
    </select>

	<select id="selectListUserCustomerPayment" parameterType="HashMap" resultType="UserCustomerPayment">
		SELECT *
		  FROM(
	        SELECT @rownum:=@rownum+1 AS rownum,
	        		a.id	,a.reservation_id	,a.user_email	,a.pay_date	,a.pay_division	,
					a.pay_method	,a.pay_comment	,a.pay_amount	,a.mid	,a.tid	,a.status_code	,
					a.status_name	,a.create_id,	u.user_name create_name, a.create_date	,
					a.last_update_id	,a.last_update_date	,a.delete_yn	,a.delete_id	,a.delete_date
	          FROM user_customer_payment a
	          left join code_item b on a.pay_method = b.code and b.upper_code = 'UserCustomerPaymentType'
	          left join `user` u on a.user_email = u.user_email
	          join (SELECT @rownum:= 0) rnum
	         <where>
	         	<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(id)" >	and id=#{id}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(reservationId)" >	and reservation_id=#{reservationId}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)" >	and user_email=#{userEmail}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payDate)" >	and pay_date=#{payDate}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payDivision)" >	and pay_division=#{payDivision}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payMethod)" >	and pay_method=#{payMethod}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payComment)" >	and pay_comment=#{payComment}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payAmount)" >	and pay_amount=#{payAmount}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(mid)" >	and mid=#{mid}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(tid)" >	and tid=#{tid}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(statusCode)" >	and status_code=#{statusCode}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(statusName)" >	and status_name=#{statusName}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(createId)" >	and create_id=#{createId}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(createDate)" >	and create_date=#{createDate}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(lastUpdateId)" >	and last_update_id=#{lastUpdateId}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(lastUpdateDate)" >	and last_update_date=#{lastUpdateDate}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteYn)" >	and delete_yn=#{deleteYn}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteId)" >	and delete_id=#{deleteId}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteDate)" >	and delete_date=#{deleteDate}	</if>
	         </where>

	         <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(sort) and @kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(sortOrder)">
		    	ORDER BY
		        <choose>
		            <when test="sort=='id'" >	id	</when>
					<when test="sort=='reservationId'" >	reservation_id	</when>
					<when test="sort=='userEmail'" >	user_email	</when>
					<when test="sort=='payDate'" >	pay_date	</when>
					<when test="sort=='payDivision'" >	pay_division	</when>
					<when test="sort=='payMethod'" >	pay_method	</when>
					<when test="sort=='payComment'" >	pay_comment	</when>
					<when test="sort=='payAmount'" >	pay_amount	</when>
					<when test="sort=='mid'" >	mid	</when>
					<when test="sort=='tid'" >	tid	</when>
					<when test="sort=='statusCode'" >	status_code	</when>
					<when test="sort=='statusName'" >	status_name	</when>
					<when test="sort=='createId'" >	create_id	</when>
					<when test="sort=='createDate'" >	create_date	</when>
					<when test="sort=='lastUpdateId'" >	last_update_id	</when>
					<when test="sort=='lastUpdateDate'" >	last_update_date	</when>
					<when test="sort=='deleteYn'" >	delete_yn	</when>
					<when test="sort=='deleteId'" >	delete_id	</when>
					<when test="sort=='deleteDate'" >	delete_date	</when>
		            <otherwise>rownum</otherwise>
		        </choose>
		        <choose><when test="sortOrder == 'asc'">ASC</when><when test="sortOrder == 'desc'">DESC</when></choose>
			</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(listSort)">
		    	ORDER BY  <foreach item="item" index="index" collection="listSort" separator=",">
		    	<choose>
		            <when test="item.sort=='id'" >	id	</when>
					<when test="item.sort=='reservationId'" >	reservation_id	</when>
					<when test="item.sort=='userEmail'" >	user_email	</when>
					<when test="item.sort=='payDate'" >	pay_date	</when>
					<when test="item.sort=='payDivision'" >	pay_division	</when>
					<when test="item.sort=='payMethod'" >	pay_method	</when>
					<when test="item.sort=='payComment'" >	pay_comment	</when>
					<when test="item.sort=='payAmount'" >	pay_amount	</when>
					<when test="item.sort=='mid'" >	mid	</when>
					<when test="item.sort=='tid'" >	tid	</when>
					<when test="item.sort=='statusCode'" >	status_code	</when>
					<when test="item.sort=='statusName'" >	status_name	</when>
					<when test="item.sort=='createId'" >	create_id	</when>
					<when test="item.sort=='createDate'" >	create_date	</when>
					<when test="item.sort=='lastUpdateId'" >	last_update_id	</when>
					<when test="item.sort=='lastUpdateDate'" >	last_update_date	</when>
					<when test="item.sort=='deleteYn'" >	delete_yn	</when>
					<when test="item.sort=='deleteId'" >	delete_id	</when>
					<when test="item.sort=='deleteDate'" >	delete_date	</when>
		        </choose>
		    	<choose><when test="item.sortOrder == 'asc'">ASC</when><when test="item.sortOrder == 'desc'">DESC</when></choose></foreach>
			</if>
			) a
		<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(itemStartPosition) and @kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(pagePerSize)">
         LIMIT #{itemStartPosition}, #{pagePerSize}
         </if>
	</select>

	<select id="selectListUserCustomerPaymentVirtualTotal" parameterType="HashMap" resultType="HashMap">
		SELECT *
		  FROM(
			SELECT @amtg := sum(case when pay_division in ('G','A') then pay_amount else 0 end) amt_g,
			       @amtd := sum(case when pay_division = 'D' then pay_amount else 0 end) amt_d,
			       @amte := sum(case when pay_division = 'E' then pay_amount else 0 end) amt_e,
			       @amtg - @amtd - @amte amt_b
			  FROM user_customer_payment
	         <where>
	         	<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(id)" >	and id=#{id}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(reservationId)" >	and reservation_id=#{reservationId}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)" >	and user_email=#{userEmail}	</if>
	         </where>

	         <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(sort) and @kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(sortOrder)">
		    	ORDER BY
		        <choose>
		            <otherwise>pay_date</otherwise>
		        </choose>
		        <choose><when test="sortOrder == 'asc'">ASC</when><when test="sortOrder == 'desc'">DESC</when></choose>
			</if>
			) a
		<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(itemStartPosition) and @kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(pagePerSize)">
         LIMIT #{itemStartPosition}, #{pagePerSize}
         </if>
	</select>

	<select id="selectCountUserCustomerPaymentVirtual" parameterType="HashMap" resultType="Integer">
		SELECT count(id)
		  FROM(
			SELECT id
			  FROM user_customer_payment a
	          join (SELECT @rownum:= 0) rnum
	         <where>
	         	<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(id)" >	and id=#{id}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(reservationId)" >	and reservation_id=#{reservationId}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)" >	and user_email=#{userEmail}	</if>
	         </where>
			) a
	</select>

	<select id="selectListUserCustomerPaymentVirtual" parameterType="HashMap" resultType="HashMap">
		SELECT *
		  FROM(
			SELECT @rownum:=@rownum+1 AS rownum,
			       a.id,
			       a.reservation_id,
			       a.user_email,
			       IFNULL( u.user_name,'') user_name,
			       IFNULL( u.user_mobile,'~연락처없음~') user_mobile,
			       date_format(pay_date,'%Y-%m-%d %h:%m:%s') pay_date,
			       case when pay_division in ('G','A') then pay_amount else 0 end amt_g,
			       case when pay_division = 'D' then pay_amount else 0 end amt_d,
			       case when pay_division = 'E' then pay_amount else 0 end amt_e,
			       pay_comment,
			       a.create_id,
			       u1.user_name create_name,
			       date_format(a.create_date,'%Y-%m-%d %H:%m:%s') create_date
			  FROM user_customer_payment a
			  left join `user` u on a.user_email = u.user_email
			  left join `user` u1 on a.create_id = u1.user_email
	          join (SELECT @rownum:= 0) rnum
	         <where>
	         	<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(id)" >	and a.id=#{id}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(reservationId)" >	and a.reservation_id=#{reservationId}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)" >	and a.user_email=#{userEmail}	</if>

				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(dateType)">
					<choose>
						<when test="dateType eq 'payDate'">   a.pay_date between DATE_FORMAT(#{dateFrom}, '%Y-%m-%d') and DATE_FORMAT(#{dateTo}, '%Y-%m-%d') </when>
						<when test="dateType eq 'createDate'">a.create_date between DATE_FORMAT(#{dateFrom}, '%Y-%m-%d') and DATE_FORMAT(#{dateTo}, '%Y-%m-%d')</when>
					</choose>
				</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payDivision)">AND a.pay_division = #{payDivision}</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(responseName)">and u1.user_name like concat('%',#{responseName},'%')</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(searchKey)">and concat(u.user_name,u.user_mobile) like concat('%',#{searchKey},'%')</if>
	         </where>

	         <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(sort) and @kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(sortOrder)">
		    	ORDER BY
		        <choose>
		        	<when test="sort=='payDate'" >	pay_date	</when>
		        	<when test="sort=='payComment'" >	pay_comment	</when>
		            <otherwise>pay_date</otherwise>
		        </choose>
		        <choose><when test="sortOrder == 'asc'">ASC</when><when test="sortOrder == 'desc'">DESC</when></choose>
			</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(listSort)">
		    	ORDER BY  <foreach item="item" index="index" collection="listSort" separator=",">
		    	<choose>
		            <when test="item.sort=='payDate'" >	pay_date	</when>
		            <when test="item.sort=='payComment'" >	pay_comment	</when>
					<when test="item.sort=='amtG'" >	amt_g	</when>
					<when test="item.sort=='amtD'" >	amt_d	</when>
					<when test="item.sort=='amtE'" >	amt_e	</when>
					<when test="item.sort=='createId'" >	create_id	</when>
					<when test="item.sort=='createName'" >	create_name	</when>
					<when test="item.sort=='createDate'" >	create_date	</when>
					<when test="item.sort=='lastUpdateId'" >	last_update_id	</when>
					<when test="item.sort=='lastUpdateDate'" >	last_update_date	</when>
					<when test="item.sort=='deleteYn'" >	delete_yn	</when>
					<when test="item.sort=='deleteId'" >	delete_id	</when>
					<when test="item.sort=='deleteDate'" >	delete_date	</when>
					<when test="item.sort=='deleteName'" >	create_name	</when>
		        </choose>
		    	<choose><when test="item.sortOrder == 'asc'">ASC</when><when test="item.sortOrder == 'desc'">DESC</when></choose></foreach>
			</if>
			) a
		<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(itemStartPosition) and @kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(pagePerSize)">
         LIMIT #{itemStartPosition}, #{pagePerSize}
         </if>
	</select>

	<select id="selectOneUserCustomerPayment" parameterType="HashMap" resultType="UserCustomerPayment">
         SELECT @rownum:=@rownum+1 AS rownum,
        		a.id	,a.reservation_id	,a.user_email	,a.pay_date	,a.pay_division	,a.pay_method	,a.pay_comment	,a.pay_amount	,a.mid	,a.tid	,a.status_code	,a.status_name	,a.create_id	,a.create_date	,a.last_update_id	,a.last_update_date	,a.delete_yn	,a.delete_id	,a.delete_date
          FROM user_customer_payment a
          left join code_item b on a.pay_method = b.code and b.upper_code = 'UserCustomerPaymentType'
          left join `user` u on a.user_email = u.user_email
          join (SELECT @rownum:= 0) rnum
         <where>
         	<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(id)" >	and id=#{id}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(reservationId)" >	and reservation_id=#{reservationId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)" >	and user_email=#{userEmail}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payDate)" >	and pay_date=#{payDate}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payDivision)" >	and pay_division=#{payDivision}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payMethod)" >	and pay_method=#{payMethod}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payComment)" >	and pay_comment=#{payComment}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payAmount)" >	and pay_amount=#{payAmount}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(mid)" >	and mid=#{mid}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(tid)" >	and tid=#{tid}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(statusCode)" >	and status_code=#{statusCode}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(statusName)" >	and status_name=#{statusName}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(createId)" >	and create_id=#{createId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(createDate)" >	and create_date=#{createDate}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(lastUpdateId)" >	and last_update_id=#{lastUpdateId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(lastUpdateDate)" >	and last_update_date=#{lastUpdateDate}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteYn)" >	and delete_yn=#{deleteYn}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteId)" >	and delete_id=#{deleteId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteDate)" >	and delete_date=#{deleteDate}	</if>
         </where>
	</select>

	<insert id="insertUserCustomerPayment" parameterType="UserCustomerPayment" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO user_customer_payment
        <set>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(reservationId)" >	reservation_id=#{reservationId},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)" >	user_email=#{userEmail},	</if>
			<choose>
				<when test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payDate)">pay_date=#{payDate},</when>
				<otherwise>pay_date=now(),</otherwise>
			</choose>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payDivision)" >	pay_division=#{payDivision},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payMethod)" >	pay_method=#{payMethod},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payComment)" >	pay_comment=#{payComment},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payAmount)" >	pay_amount=#{payAmount},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(mid)" >	mid=#{mid},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(tid)" >	tid=#{tid},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(statusCode)" >	status_code=#{statusCode},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(statusName)" >	status_name=#{statusName},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(createId)" >	create_id=#{createId},	</if>
			create_date = now()
		</set>
    </insert>

    <update id="updateUserCustomerPayment" parameterType="UserCustomerPayment">
        UPDATE user_customer_payment
        <set>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(reservationId)" >	reservation_id=#{reservationId},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)" >	user_email=#{userEmail},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payDate)" >	pay_date=#{payDate},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payDivision)" >	pay_division=#{payDivision},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payMethod)" >	pay_method=#{payMethod},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payComment)" >	pay_comment=#{payComment},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payAmount)" >	pay_amount=#{payAmount},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(mid)" >	mid=#{mid},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(tid)" >	tid=#{tid},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(statusCode)" >	status_code=#{statusCode},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(statusName)" >	status_name=#{statusName},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(lastUpdateId)" >	last_update_id=#{lastUpdateId},	</if>
			last_update_date = now()
		</set>
		<where>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(id)">and id = #{id}</if>
		</where>
    </update>

    <update id="restoreUserCustomerPayment" parameterType="UserCustomerPayment">
        UPDATE user_customer_payment
           SET delete_yn='N'
        WHERE id = #{id}
    </update>

    <update id="deleteUserCustomerPayment" parameterType="UserCustomerPayment">
        UPDATE user_customer_payment
           SET delete_yn='Y'
        WHERE id = #{id}
    </update>
	<!--################################### userCustomerOrderList ###################################-->
	 <select id="selectCountUserCustomerOrderList" parameterType="HashMap" resultType="Integer">
        SELECT count(pay_product_seq)
          FROM (
			SELECT
				pay_product_seq
			FROM User_customer_order_list a
		<where>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(reservationId)" >	and reservation_id=#{reservationId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payProductSeq)" >	and pay_product_seq=#{payProductSeq}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)" >	and user_email=#{userEmailr}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payMoid)" >	and pay_moid=#{payMoid}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productSerial)" >	and product_serial=#{productSerial}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productTourId)" >	and product_tour_id=#{productTourId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productName)" >	and product_name=#{productName}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productCount)" >	and product_count=#{productCount}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productAmt)" >	and product_amt=#{productAmt}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productDeliveryAmt)" >	and product_delivery_amt=#{productDeliveryAmt}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productStatus)" >	and product_status=#{productStatus}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(cancelProductCount)" >	and cancel_product_count=#{cancelProductCount}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(createId)" >	and create_id=#{createId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(createDate)" >	and create_date=#{createDate}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(lastUpdateId)" >	and last_update_id=#{lastUpdateId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(lastUpdateDate)" >	and last_update_date=#{lastUpdateDate}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteYn)" >	and delete_yn=#{deleteYn}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteId)" >	and delete_id=#{deleteId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteDate)" >	and delete_date=#{deleteDate}	</if>
         </where>) a
    </select>

	<select id="selectListUserCustomerOrderList" parameterType="HashMap" resultType="UserCustomerOrderList">
		SELECT *
		  FROM(
	        SELECT @rownum:=@rownum+1 AS rownum,
					a.*,
					b.product_title,
					b.product_thumbnail,
					(case when mu.upper_menu_id is not null then (select umu.menu_url from menu_user umu where umu.menu_id = mu.upper_menu_id ) else mu.menu_url end) menu_url
			  FROM user_customer_order_list a
			  left join product_tour b on a.product_serial  = b.product_serial and a.product_tour_id  = b.product_tour_id
			  LEFT JOIN menu_user mu on mu.menu_id = b.product_menu_id
			  join (SELECT @rownum:= 0) rnum
	         <where>
	         	<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(reservationId)" >	and reservation_id=#{reservationId}	</if>
	         	<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payProductSeq)" >	and pay_product_seq=#{payProductSeq}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)" >	and user_email=#{userEmail}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payMoid)" >	and pay_moid=#{payMoid}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productSerial)" >	and product_serial=#{productSerial}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productTourId)" >	and product_tour_id=#{productTourId}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productName)" >	and product_name=#{productName}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productCount)" >	and product_count=#{productCount}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productAmt)" >	and product_amt=#{productAmt}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productDeliveryAmt)" >	and product_delivery_amt=#{productDeliveryAmt}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productStatus)" >	and product_status=#{productStatus}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(cancelProductCount)" >	and cancel_product_count=#{cancelProductCount}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(createId)" >	and create_id=#{createId}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(createDate)" >	and create_date=#{createDate}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(lastUpdateId)" >	and last_update_id=#{lastUpdateId}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(lastUpdateDate)" >	and last_update_date=#{lastUpdateDate}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteYn)" >	and delete_yn=#{deleteYn}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteId)" >	and delete_id=#{deleteId}	</if>
				<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteDate)" >	and delete_date=#{deleteDate}	</if>
	         </where>

	         <if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(sort) and @kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(sortOrder)">
		    	ORDER BY
		        <choose>
		            <when test="sort=='travelScheduleDt'" >	travel_schedule_dt	</when>
		            <when test="sort=='productTitle'" >	p.product_title	</when>
		            <when test="sort=='id'" >	id	</when>
					<when test="sort=='userEmail'" >	user_email	</when>
					<when test="sort=='userName'" >	user_name	</when>
					<when test="sort=='userMobile'" >	user_mobile	</when>
					<when test="sort=='berthType'" >	berth_type	</when>
					<when test="sort=='productSerial'" >	product_serial	</when>
					<when test="sort=='applyCode'" >	apply_code	</when>
					<when test="sort=='reservationCode'" >	reservation_code	</when>
					<when test="sort=='cancelYn'" >	cancel_yn	</when>
					<when test="sort=='cancelCode'" >	cancel_code	</when>
					<when test="sort=='berthJson'" >	berth_json	</when>
					<when test="sort=='travelScheduleJson'" >	travel_schedule_json	</when>
					<when test="sort=='airTypeRequest'" >	air_type_request	</when>
					<when test="sort=='airScheduleJson'" >	air_schedule_json	</when>
					<when test="sort=='vehicleType'" >	vehicle_type	</when>
					<when test="sort=='vehicleCount'" >	vehicle_count	</when>
					<when test="sort=='vehicleJson'" >	vehicle_json	</when>
					<when test="sort=='totalAmount'" >	total_amount	</when>
					<when test="sort=='createId'" >	create_id	</when>
					<when test="sort=='createDate'" >	create_date	</when>
					<when test="sort=='lastUpdateId'" >	last_update_id	</when>
					<when test="sort=='lastUpdateDate'" >	last_update_date	</when>
					<when test="sort=='deleteYn'" >	delete_yn	</when>
					<when test="sort=='deleteId'" >	delete_id	</when>
					<when test="sort=='deleteDate'" >	delete_date	</when>
		            <otherwise>rownum</otherwise>
		        </choose>
		        <choose><when test="sortOrder == 'asc'">ASC</when><when test="sortOrder == 'desc'">DESC</when></choose>
			</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(listSort)">
		    	ORDER BY  <foreach item="item" index="index" collection="listSort" separator=",">
		    	<choose>
		            <when test="item.sort=='travelScheduleDt'" >	travel_schedule_dt	</when>
		            <when test="item.sort=='productTitle'" >	p.product_title	</when>
		            <when test="item.sort=='id'" >	id	</when>
					<when test="item.sort=='userEmail'" >	user_email	</when>
					<when test="item.sort=='userName'" >	user_name	</when>
					<when test="item.sort=='userMobile'" >	user_mobile	</when>
					<when test="item.sort=='berthType'" >	berth_type	</when>
					<when test="item.sort=='productSerial'" >	product_serial	</when>
					<when test="item.sort=='applyCode'" >	apply_code	</when>
					<when test="item.sort=='reservationCode'" >	reservation_code	</when>
					<when test="item.sort=='cancelYn'" >	cancel_yn	</when>
					<when test="item.sort=='cancelCode'" >	cancel_code	</when>
					<when test="item.sort=='berthJson'" >	berth_json	</when>
					<when test="item.sort=='travelScheduleJson'" >	travel_schedule_json	</when>
					<when test="item.sort=='airTypeRequest'" >	air_type_request	</when>
					<when test="item.sort=='airScheduleJson'" >	air_schedule_json	</when>
					<when test="item.sort=='vehicleType'" >	vehicle_type	</when>
					<when test="item.sort=='vehicleCount'" >	vehicle_count	</when>
					<when test="item.sort=='vehicleJson'" >	vehicle_json	</when>
					<when test="item.sort=='totalAmount'" >	total_amount	</when>
					<when test="item.sort=='createId'" >	create_id	</when>
					<when test="item.sort=='createDate'" >	create_date	</when>
					<when test="item.sort=='lastUpdateId'" >	last_update_id	</when>
					<when test="item.sort=='lastUpdateDate'" >	last_update_date	</when>
					<when test="item.sort=='deleteYn'" >	delete_yn	</when>
					<when test="item.sort=='deleteId'" >	delete_id	</when>
					<when test="item.sort=='deleteDate'" >	delete_date	</when>

		        </choose>
		    	<choose><when test="item.sortOrder == 'asc'">ASC</when><when test="item.sortOrder == 'desc'">DESC</when></choose></foreach>
			</if>
			) a
		<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(itemStartPosition) and @kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(pagePerSize)">
         LIMIT #{itemStartPosition}, #{pagePerSize}
         </if>
	</select>
	<select id="selectOneUserCustomerOrderList" parameterType="HashMap" resultType="UserCustomerOrderList">
         SELECT @rownum:=@rownum+1 AS rownum,
        		a.*
          FROM User_customer_order_list a
          join (SELECT @rownum:= 0) rnum
         <where>
         	<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payProductSeq)" >	and pay_product_seq=#{payProductSeq}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)" >	and user_email=#{userEmail}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payMoid)" >	and pay_moid=#{payMoid}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productSerial)" >	and product_serial=#{productSerial}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productTourId)" >	and product_tour_id=#{productTourId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productName)" >	and product_name=#{productName}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productCount)" >	and product_count=#{productCount}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productAmt)" >	and product_amt=#{productAmt}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productDeliveryAmt)" >	and product_delivery_amt=#{productDeliveryAmt}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productStatus)" >	and product_status=#{productStatus}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(cancelProductCount)" >	and cancel_product_count=#{cancelProductCount}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(createId)" >	and create_id=#{createId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(createDate)" >	and create_date=#{createDate}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(lastUpdateId)" >	and last_update_id=#{lastUpdateId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(lastUpdateDate)" >	and last_update_date=#{lastUpdateDate}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteYn)" >	and delete_yn=#{deleteYn}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteId)" >	and delete_id=#{deleteId}	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(deleteDate)" >	and delete_date=#{deleteDate}	</if>
         </where>
	</select>

	<insert id="insertUserCustomerOrderList" parameterType="UserCustomerOrderList" useGeneratedKeys="true" keyProperty="payProductSeq">
        INSERT INTO user_customer_order_list
        <set>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payProductSeq)" >	pay_product_seq=#{payProductSeq},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)" >	user_email=#{userEmail},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(reservationId)" >	reservation_id =#{reservationId},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payMoid)" >	pay_moid=#{payMoid},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productSerial)" >	product_serial=#{productSerial},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productTourId)" >	product_tour_id=#{productTourId},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productName)" >	product_name=#{productName},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productPrice)" >	product_price=#{productPrice},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productCount)" >	product_count=#{productCount},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productAmt)" >	product_amt=#{productAmt},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productDeliveryAmt)" >	product_delivery_amt=#{productDeliveryAmt},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productStatus)" >	product_status=#{productStatus},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(orderDate)" >	order_date=#{orderDate},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(optionPack)" >	option_pack=#{optionPack},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(optionTime)" >	option_time=#{optionTime},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(cancelProductCount)" >	cancel_product_count=#{cancelProductCount},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(createId)" >	create_id=#{createId},	</if>
			create_date = now()
		</set>
    </insert>

    <update id="updateUserCustomerOrderList" parameterType="UserCustomerOrderList">
        UPDATE user_customer_order_list
        <set>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(userEmail)" >	user_email=#{userEmail},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(reservationId)" >	reservation_id =#{reservationId},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payMoid)" >	pay_moid=#{payMoid},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productSerial)" >	product_serial=#{productSerial},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productTourId)" >	product_tour_id=#{productTourId},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productName)" >	product_name=#{productName},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productPrice)" >	product_price=#{productPrice},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productCount)" >	product_count=#{productCount},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productAmt)" >	product_amt=#{productAmt},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productDeliveryAmt)" >	product_delivery_amt=#{productDeliveryAmt},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(productStatus)" >	product_status=#{productStatus},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(orderDate)" >	order_date=#{orderDate},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(optionPack)" >	option_pack=#{optionPack},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(optionTime)" >	option_time=#{optionTime},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(cancelProductCount)" >	cancel_product_count=#{cancelProductCount},	</if>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(lastUpdateId)" >	last_update_id=#{lastUpdateId},	</if>
			last_update_date = now()
		</set>
		<where>
			<if test="@kr.co.wayplus.travel.util.MybatisUtil@isNotEmpty(payProductSeq)" >and pay_product_seq=#{payProductSeq}	</if>
		</where>
    </update>

    <update id="restoreUserCustomerOrderList" parameterType="UserCustomerOrderList">
        UPDATE User_customer_order_list
           SET delete_yn='N'
        WHERE id = #{id}
    </update>

    <update id="deleteUserCustomerOrderList" parameterType="UserCustomerOrderList">
        UPDATE User_customer_order_list
           SET delete_yn='Y'
        WHERE id = #{id}
    </update>
</mapper>