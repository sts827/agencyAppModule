<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/manage/inc/manage-common-include :: main-include}" />
<link rel="stylesheet" th:href="@{/css/manage/product-add.css}" href="/css/manage/product-add.css">
<link rel="stylesheet" th:href="@{/css/manage/product-add-editor.css}" href="/css/manage/product-add-editor.css">
<link rel="stylesheet" th:href="@{/css/manage/product-add-default-editor.css}" href="/css/manage/product-add-default-editor.css">
<link rel="stylesheet" th:href="@{/plugin/pagination/pagination.css}" href="/plugin/pagination/pagination.css">
<link rel="stylesheet" th:href="@{/plugin/daterangepicker/css/common.css}" href="/plugin/daterangepicker/css/common.css">
<script src="/plugin/smooth-zoom/smooth-zoom.js"></script>
<script src="/plugin/pagination/Pagination.min.js"></script>
<script src="/js/manage/product/product-common.js"></script>


<style>
    .box-line {
        border: 1px solid red;
    }

    /******* FullCalendar *******/
    /*날짜, 버튼 부분*/
    .fc-toolbar-chunk div {
        display: flex;
    }
    .fc .fc-button {
        all: unset;
    }
    .fc .fc-button {

    }
    .fc .fc-toolbar.fc-header-toolbar {
        margin-bottom: 4px;
    }
    .fc .fc-toolbar-title {
        font: 600 24px Pretendard;
        color: #222222;
    }
    .fc .fc-button-primary:hover {
        all: unset;
    }
    .fc .fc-button-primary:hover {
        cursor: pointer;
    }
    .fc .fc-button-primary:not(:disabled).fc-button-active, .fc .fc-button-primary:not(:disabled):active {
        all: unset;
    }
    .fc .fc-button-primary:not(:disabled).fc-button-active:focus, .fc .fc-button-primary:not(:disabled):active:focus {
        all: unset;
    }
    .fc .fc-button-primary:focus {
        all: unset;
    }
    .fc .fc-button:focus {
        all: unset;
    }
    .fc-icon-chevron-left:before {
        all: unset;
    }
    .fc-icon-chevron-left {
        margin-right : 18px; background: url('/images/icon/left-arrow-gray-6x12.svg') no-repeat center top / cover; background-size: 9px 21px;
    }
    .fc-icon-chevron-right:before {
        all: unset;
    }
    .fc-icon-chevron-right {
        margin-left : 18px; background: url('/images/icon/right-arrow-gray-6x12.svg') no-repeat center top / cover; background-size: 9px 22px;
    }
    /*달력부분*/
    .item-block {
        height: 0 !important;
        margin-top: 23px;
        border: none;
    }
    .fc-theme-standard .fc-scrollgrid {
        border-top: 2px solid #333333; border-bottom: 2px solid #333333; border-left: none;
    }
    .fc-theme-standard .fc-scrollgrid th {
        width: 100%; height: 55px; background-color: #EEEEEE;
    }
    .fc .fc-scrollgrid-section > * {
        border-right: none;
    }
    thead .fc-scroller-harness .fc-scrollgrid-sync-inner {
        height: 100%; display: flex; justify-content: center; align-items: center;
    }
    thead .fc-col-header-cell-cushion {
        font: 500 18px Pretendard;
        color: #222222;
    }
    .fc .fc-daygrid-day-top {
        all: unset;
    }
    .fc .fc-daygrid-day-number {
        padding-left: 13px;
    }
    tbody a {
        font: 400 17px Pretendard;
        color: #222222;
    }
    .fc-day-sat a {
        color: #0062D4;
    }
    .fc-day-sun a {
        color: #E74133;
    }
    .fc-daygrid-day-events {
        margin-right: 9px;
    }
    .fc-event-title.fc-sticky {
        font: 500 14px Pretendard;
        color: #333333;
    }
    .fc-direction-ltr .fc-daygrid-event.fc-event-start, .fc-direction-rtl .fc-daygrid-event.fc-event-end {
        margin-left: 15px;
    }
    .fc-event-title-container {
        height: 26px;
        cursor: pointer;
    }
    .fc-daygrid-event {
        border-radius: 5px;
    }
</style>
<body class="hold-transition sidebar-mini layout-fixed">
<section class="wrapper">
    <div th:replace="~{/manage/inc/manage-common-include :: common-preloader-include}"></div>
    <nav th:replace="~{/manage/inc/manage-header-include :: header}"/>
    <aside th:replace="~{/manage/inc/manage-sidebar-include :: sidebar-menu-v1}"></aside>
    <main class="content-wrapper">
        <div class="content-header">
            <h1 class="m-0" th:text="|${menuName} 상품 등록|"></h1>
        </div>
        <div class="container-fluid p-0">
            <input class="radio-check" id="basic-info" type="hidden" value="N">
            <input class="radio-check" id="product-info" type="hidden" value="N">
            <input class="radio-check" id="price-info" type="hidden" value="N">
            <input class="radio-check" id="schedule-info" type="hidden" value="N">
            <input type="hidden" id="product-tour-id" value="">
            <input type="hidden" value="" id="product-status" name="productStatus">
            <div class="product-input-wrapper">
                <div class="title-div">
                    <h3>기본정보*</h3>
                    <div class="info-toggle basic">
                        <button class="arrow-down" type="button" th:style="|background-image:url('@{/images/icons/arrow_down.svg}')|"></button>
                        <!--                            <button class="arrow-up" type="button" th:style="|background-image:url('@{/images/icons/arrow_up.svg}')|"></button>-->
                    </div>
                </div>
                <div class="basic-info">
                    <form id="basic-info-add-form" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="productStatus" value="">
                        <input type="hidden" name="productDescription" value="">
                        <div class="row-div">
                            <div class="quad-div">
                                <h5>상품구분</h5>
                                <select class="form-select" disabled>
                                    <option th:text="${menuName}"></option>
                                </select>
                            </div>
                            <div class="quad-div">
                                <h5>분류구분</h5>
                                <th:block th:if="${not #lists.isEmpty(categoryList)}">
                                    <select class="form-select" name="productMenuId" id="product-category-id">
                                        <th:block th:each="item : ${categoryList}">
                                            <option th:value="${item.menuId}" th:text="${item.menuName}"></option>
                                        </th:block>
                                    </select>
                                </th:block>
                                <th:block th:unless="${not #lists.isEmpty(categoryList)}">
                                    <select class="form-select" name="productMenuId" id="product-category-id" disabled>
                                        <option readonly="readonly" th:text="|하위 분류 없음|"></option>
                                    </select>
                                </th:block>
                            </div>
                            <div class="quad-div">
                                <h5>카테고리</h5>
                                <select class="form-select" name="productCategoryId" id="product-subcategory">
                                </select>
                            </div>
                            <div class="quad-div">
                                <h5>공개여부</h5>
                                <input type="checkbox" name="productUseYn" value="Y" id="isDisplay" class="toggle" checked hidden>
                                <div class="switch-box">
                                    <label for="isDisplay" class="toggleSwitch">
                                        <span class="toggleButton"></span>
                                    </label>
                                    <ul class="status">
                                        <li class="no-checked">비공개</li>
                                        <li class="active checked">공개</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="row-div">
                            <div class="tri-div-double">
                                <h5>상품명*</h5>
                                <input class="form-control" type="text" id="product-title" name="productTitle">
                            </div>
                            <div class="quad-div">
                                <h5>인기상품</h5>
                                <input type="checkbox" name="isPopular" value="Y" id="isPopular" class="toggle" checked hidden>
                                <div class="switch-box">
                                    <label for="isPopular" class="toggleSwitch">
                                        <span class="toggleButton"></span>
                                    </label>
                                    <ul class="status">
                                        <li class="no-checked">미사용</li>
                                        <li class="active checked">사용</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="row-div">
                            <div class="tri-div-double">
                                <h5>상품사진*</h5>
                                <input type="file" id="upload-product-image" name="upload" multiple="multiple" hidden>
                                <label for="upload-product-image" class="upload-wrapper">
                                    <ul class="upload_btn">
                                        <li class="icon" th:style="|background-image:url('@{/images/icons/upload_btn.svg}')|">
                                        </li>
                                        <li class="text">사진등록</li>
                                    </ul>
                                </label>
                                <p class="notification-icon">이미지 추천 사이즈 : 500px * 500px</p>
                                <div id="product-images" class="product-images swiper">
                                    <div class="product-image-list swiper-wrapper">

                                    </div>
                                    <ul class="product-image-pagination">
                                        <li class="swiper-button-prev"></li>
                                        <li class="swiper-button-next"></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="quad-div">
                                <input type="hidden" id="product-thumbnail" name="productThumbnail">
                                <div id="product-thumbnail-view" class="product-thumbnail-view"></div>
                            </div>
                        </div>
                        <div class="row-div">
                            <h5 class="showDate">노출기간</h5>
                            <div class="picky quad-div">
                                <input name="productShowStartDate" id="display-start-date" type="text" class="form-control with-button" placeholder="20XX-XX-XX">
                                <button type="button" class="input-button" onclick="setDefaultSalesPeriod()"><div class="calendar" th:style="|background-image:url('@{/images/icons/calendar.svg}')|"></div></button>
                                <span>~</span>
                            </div>
                            <div class="picky quad-div">
                                <input name="productShowEndDate" id="display-end-date" type="text" class="form-control with-button" placeholder="20XX-XX-XX">
                                <button type="button" class="input-button" onclick="setNullSalesEndDate()"><div class="calendar" th:style="|background-image:url('@{/images/icons/calendar.svg}')|"></div></button>
                            </div>
                            <div class="quad-div">
                                <p class="notification-icon">홈페이지에 상품이 노출되는 기간입니다. (미설정시 상시노출)</p>
                            </div>
                        </div>
                        <div class="row-div">
                            <h5 class="sellDate">판매기간</h5>
                            <div class="picky quad-div">
                                <input name="productReservStartDate" type="text" class="form-control with-button" id="sales-start-date" required placeholder="20XX-XX-XX">
                                <button type="button" class="input-button" onclick="setDefaultSalesPeriod()"><div class="calendar" th:style="|background-image:url('@{/images/icons/calendar.svg}')|"></div></button>
                                <span>~</span>
                            </div>
                            <div class="picky quad-div">
                                <input name="productReservEndDate" type="text" class="form-control with-button" id="sales-end-date" required placeholder="20XX-XX-XX">
                                <button type="button" class="input-button" onclick="setNullSalesEndDate()"><div class="calendar" th:style="|background-image:url('@{/images/icons/calendar.svg}')|"></div></button>
                            </div>
                            <div class="quad-div">
                                <p class="notification-icon">상품이 판매되는 기간입니다(결제기간) (미설정시 상시판매)</p>
                            </div>
                        </div>
                        <div class="row-div">
                            <div class="dotted"></div>
                        </div>
                        <div class="row-div">
                            <div class="full-div text-area">
                                <h5>상품요약</h5>
                                <textarea name="productNotice" id="product-notice" class="form-control" type="text" placeholder="ex) 제주 동부 핫플레이스 총집합! 체험과 힐링을 한번에, 제주 맞춤 2박3일 여행 패키지!"></textarea>
                            </div>
                        </div>
                        <div class="row-div">
                            <div class="full-div hashtag">
                                <h5>태그</h5>
                                <input name="productTag" id="product-tag" class="form-control" type="text" placeholder="ex) #제주도, #체험관광, #자연관광">
                            </div>
                            <p class="notification-icon">콤마(,)로 구분해주세요</p>
                        </div>

                        <div class="row-div">
                            <div class="full-div include-info">
                                <h5>포함내역</h5>
                                <input name="productIncludeItem" id="product-include-item" class="form-control" type="text" placeholder="ex) 입장료,버스요금,숙박비">
                            </div>
                        </div>
                        <div class="row-div">
                            <div class="full-div exclude-info">
                                <h5>불포함내역</h5>
                                <input name="productExcludeItem" id="product-exclude-item" class="form-control" type="text" placeholder="ex) 여행자보험,개인경비,전일정 식사비">
                            </div>
                        </div>

                        <ul class="buttons">
                            <li class="cancel"><button type="button">취소하기</button></li>
                            <li class="save"><button type="button">저장하기</button></li>
                        </ul>
                    </form>
                </div>
            </div>
            <div class="product-input-wrapper">
                <div class="title-div">
                    <h3>상품정보*</h3>
                    <div class="info-toggle product">
                        <button class="arrow-down" type="button" th:style="|background-image:url('@{/images/icons/arrow_down.svg}')|"></button>
                    </div>
                </div>
                <div class="product-info template-container">
                    <form id="product-info-add-form" enctype="multipart/form-data">
                        <input type="hidden" class="product-tour-id" name="productTourId" value="">
                        <input type="hidden" name="productStatus" value="">
                        <input type="hidden" id="template-html" name="templateHtml" value="">
                        <input type="hidden" id="template-title" name="templateTitle" value="">
                        <div id="template-thema">
                            <ul class="templates"></ul>
                        </div>
                        <!-- text-block,table-block,image-block, -->
                        <ul id="component-design">
                            <li class="edit-insert-template"><img src="./images/icon/template_icon.svg" alt=""><span>템플릿 선택</span></li>
                            <li class="edit-insert-bgImage"><span>배경</span></li>
                            <li class="edit-insert-image"><span>이미지</span></li>
                            <li class="edit-insert-text active"><span>텍스트</span></li>
                            <!--                                <li class="edit-insert-table"><span>표</span></li>-->
                        </ul>
                        <div class="section-wrapper">
                            <section id="library-section">
                                <div class="library-wrapper">
                                    <div class="library text active">
                                        <h3>텍스트</h3>
                                        <ul id="font">
                                            <li id="align-components">
                                                <h4>정렬</h4>
                                                <ul class="align-types">
                                                    <li class="left">
                                                        <div class="align-img" th:style="|background-image:url(@{/images/icons/align-left.svg})|"></div>
                                                        <div class="align-text">왼쪽</div>
                                                    </li>
                                                    <li class="right">
                                                        <div class="align-img" th:style="|background-image:url(@{/images/icons/align-right.svg})|"></div>
                                                        <div class="align-text">오른쪽</div>
                                                    </li>
                                                    <li class="top">
                                                        <div class="align-img" th:style="|background-image:url(@{/images/icons/align-top.svg})|"></div>
                                                        <div class="align-text">위</div>
                                                    </li>
                                                    <li class="bottom">
                                                        <div class="align-img" th:style="|background-image:url(@{/images/icons/align-bottom.svg})|"></div>
                                                        <div class="align-text">아래</div>
                                                    </li>
                                                    <li class="center">
                                                        <div class="align-img" th:style="|background-image:url(@{/images/icons/align-center.svg})|"></div>
                                                        <div class="align-text">중앙</div>
                                                    </li>
                                                </ul>
                                            </li>
                                            <li>
                                                <h4>글꼴</h4>
                                                <select name="" id="font-family">
                                                    <option value="none" disabled>글꼴 선택</option>
                                                    <option value="Pretendard-Regular">Pretendard</option>
                                                    <option value="NanumSquare">나눔스퀘어</option>
                                                    <option value="Gmarket-Sans">Gmarket-sans</option>
                                                </select>
                                            </li>
                                            <li>
                                                <h4>글꼴색상</h4>
                                                <div class="input-wrapper">
                                                    <input type="color" id="font-color">
                                                </div>
                                                <div class="hex-value"></div>
                                            </li>
                                            <li>
                                                <h4>글꼴 크기</h4>
                                                <div class="input-wrapper">
                                                    <input id="font-size" type="number" min="0" value="" placeholder="(입력예) 12">
                                                </div>
                                            </li>
                                            <li>
                                                <h4>굵기</h4>
                                                <div class="input-wrapper">
                                                    <input id="font-weight" type="number" min="0" value="" placeholder="(입력예) 300">
                                                </div>
                                            </li>
                                            <!--                                                <li>-->
                                            <!--                                                    <h4>기울기</h4>-->
                                            <!--                                                    <p class="notification-icon">(-) 값은 왼쪽으로 회전, (+) 값은 오른쪽으로 회전</p>-->
                                            <!--                                                    <div class="input-wrapper">-->
                                            <!--                                                        <input id="text-rotate" type="number" value="" placeholder="">-->
                                            <!--                                                    </div>-->
                                            <!--                                                </li>-->

                                        </ul>
                                        <ul class="insert-button">
                                            <li class="text-create">
                                                <button type=button>생성하기</button>
                                            </li>
                                            <li class="text-cancel">
                                                <button type=button>취소</button>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="library table">
                                        <h3>테이블 설정</h3>
                                        <!--                                                <ul id="table">-->
                                        <!--                                                    <li class="add">셀추가</li>-->
                                        <!--                                                    <li class="delete">셀삭제</li>-->
                                        <!--                                                </ul>-->
                                        <ul class="insert-button">
                                            <li class="table-create">
                                                <button type=button>테이블 생성</button>
                                            </li>
                                            <li class="table-cancel">
                                                <button type=button>취소</button>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="library image">
                                        <h3>이미지 설정</h3>
                                        <ul>
                                            <li>
                                                <h4>이미지 추가</h4>
                                                <p class="notification-icon">업로드 후 미리보기 이미지를 선택해주세요</p>
                                                <div class="upload-btn">
                                                    <label for="image-upload">
                                                        <div class="icon" th:style="|background-image:url('@{/images/icon/upload-icon.svg}')|">
                                                        </div>
                                                        <div>파일선택</div>
                                                    </label>
                                                    <input id="image-upload" name="editor-image-upload"class="input-wrapper" type="file" multiple="multiple" accept="image/*,.pdf">
                                                </div>
                                                <div id="image-preview" class="preview-container">
                                                    <ul class="image">
                                                    </ul>
                                                </div>
                                            </li>
                                            <li>
                                                <h4>너비</h4>
                                                <div class="input-wrapper">
                                                    <input id="image-width" class="input-wrapper" type="number" min="0">
                                                </div>
                                                <h4>높이</h4>
                                                <div class="input-wrapper">
                                                    <input id="image-height" class="input-wrapper" type="number" min="0">
                                                </div>
                                                <!--                                                    <h4>회전</h4>-->
                                                <!--                                                    <div class="input-wrapper">-->
                                                <!--                                                        <input id="image-rotate" class="input-wrapper" type="number" min="-360" max="360">-->
                                                <!--                                                    </div>-->
                                            </li>
                                        </ul>
                                        <!--                                            <ul class="insert-button">-->
                                        <!--                                                <li class="images-create">-->
                                        <!--                                                    <button type=button>삽입</button>-->
                                        <!--                                                </li>-->
                                        <!--                                                <li class="images-cancel">-->
                                        <!--                                                    <button type=button>취소</button>-->
                                        <!--                                                </li>-->
                                        <!--                                            </ul>-->
                                    </div>
                                    <div class="library bgImage">
                                        <h3>배경설정</h3>
                                        <ul>
                                            <li>
                                                <h4>배경이미지</h4>
                                                <p class="notification-icon">업로드 후 미리보기 이미지를 선택해주세요</p>
                                                <div class="upload-btn">
                                                    <label for="bgImage-upload">
                                                        <div class="icon" th:style="|background-image:url('@{/images/icon/upload-icon.svg}')|">
                                                        </div>
                                                        <div>파일선택</div>
                                                    </label>
                                                    <input id="bgImage-upload" name="editor-bgImage-upload" type="file" accept="image/*,.pdf" multiple="multiple" hidden="hidden">
                                                </div>
                                                <div id="bgImage-preview" class="preview-container">
                                                    <ul class="image">
                                                    </ul>
                                                </div>
                                            </li>
                                            <li>
                                                <h4>배경색상</h4>
                                                <div class="input-wrapper">
                                                    <input id="bg-color" type="color">
                                                </div>
                                                <h4>불투명도</h4>
                                                <div class="range-wrapper">
                                                    <input id="bg-opacity" type="range" min="0" max="100">
                                                </div>
                                            </li>
                                        </ul>
                                        <!--                                            <ul class="insert-button">-->
                                        <!--                                                <li class="bgImage-create">-->
                                        <!--                                                    <button type=button>삽입</button>-->
                                        <!--                                                </li>-->
                                        <!--                                                <li class="bgImage-cancel">-->
                                        <!--                                                    <button type=button>취소</button>-->
                                        <!--                                                </li>-->
                                        <!--                                            </ul>-->
                                    </div>
                                </div>
                            </section>
                            <section id="editor-section">
                                <header>
                                    <div class="zoom-out">축소(-)</div>
                                    <div class="scale-value">100%</div>
                                    <div class="zoom-in">확대(+)</div>
                                    <div class="slide-width-height">850x1000px</div>
                                </header>
                                <article id="container-wrapper">
                                    <div id="content-container" class="editor">
                                        <ul class="slides">
                                            <li class="slide current-slide">
                                            </li>
                                        </ul>
                                    </div>
                                </article>
                                <ul id="util-buttons">
                                    <li class="slide-add">
                                        <img th:src="|@{/images/icon/plusBtn.svg}|" alt="">
                                    </li>
                                    <li class="slide-remove">
                                        <img th:src="|@{/images/icon/trash.svg}|" alt="">
                                    </li>
                                </ul>
                            </section>
                            <div class="clear-fix"></div>
                        </div>
                        <ul class="buttons">
                            <li class="cancel"><button type="button">취소하기</button></li>
                            <li class="save"><button type="button">저장하기</button></li>
                        </ul>
                    </form>
                </div>
            </div>
            <div class="product-input-wrapper">
                <input type="hidden" id="add-basic-option-id">
                <div class="title-div">
                    <h3>판매가격설정*</h3>
                    <div class="info-toggle price">
                        <button class="arrow-down" id="product-input-wrapper-btn" type="button" th:style="|background-image:url('@{/images/icons/arrow_down.svg}')|"></button>
                    </div>
                </div>
                <form class="price-info">
                    <div class="detail-schedule-text-box">
                        <p class="schedule-p-text">판매유형*</p>
                        <select class="price-select" name="priceType">
                            <option value="fix">고정가격 설정</option>
                            <option value="calender">일자별 가격설정</option>
                        </select>
                        <img src="/images/icon/text-info.svg" class="text-info-image" alt="">
                        <p class="detail-schedule-caution-text">선택한 유형에 따라 설정 에디터가 변경됩니다.</p>
                    </div>
                    <hr style="margin-bottom: 30px;">
                    <div class="fix-price-box">
                        <p class="schedule-p-text">가격설정*</p>
                        <div style="width: 100%;" th:if="!${#arrays.isEmpty(fixPriceOptionList)}">
                            <div id="fix-price-list-box">
                                <div class="price-option-id-box" th:each="list : ${fixPriceOptionList}">
                                    <div class="fix-price-option-title">
                                        <input data-fix-option-type="name" type="text" class="schedule-p-text" style="width: 100%;" th:value="${list.optionName}" placeholder="항목을 입력해주세요." />
                                        <input data-fix-option-type="price" type="text" onkeyup="checkInputNumValidation(event)" class="schedule-price-text" placeholder="가격을 입력해주세요." />
                                    </div>
                                    <div class="fix-price-option-quantity">
                                        <p class="schedule-p-text">최대수량</p>
                                        <input data-fix-option-type="maxQuantity" type="text" onkeyup="checkInputNumValidation(event)" class="schedule-price-text" th:value="${list.maxQuantity}" placeholder="수량입력" />
                                    </div>
                                    <div class="option-btx-box">
                                        <button type="button" class="delete-option-btn" onclick="deleteFixPriceOption(this)">
                                            <img src="/images/icon/x-black-box-15x15.svg" style="width: 15px; height: 15px;" alt="">
                                        </button>
                                    </div>
                                    <input type="hidden" data-fox-option-type="optionSettingId" th:value="${list.optionSettingId}">
                                </div>
                            </div>
                            <div class="fix-add-option-btn" onclick="addFixPriceOption()">
                                <p class="add-option-btn-text">판매항목 추가</p>
                                <img src="/images/icon/+-white-10x10.svg" style="width: 15px; height: 15px;" alt="">
                            </div>
                        </div>
                    </div>
                    <div class="calendar-box">
                        <div>
                            <button type="button" class="schedule-add-btn" onclick="showScheduleAddModal('');">일정추가</button>
                            <button type="button" class="option-add-btn" onclick="goAddOption()">항목추가</button>
                        </div>
                        <div style="width: 100%; height: 100%;" id="calendar"></div>
                    </div>
                    <ul class="buttons">
                        <li class="cancel"><button type="button">취소하기</button></li>
                        <li class="save"><button type="button">저장하기</button></li>
                    </ul>
                </form>
            </div>
            <div class="product-input-wrapper">
                <div class="title-div">
                    <h3>세부일정</h3>
                    <div class="info-toggle schedule">
                        <button class="arrow-down" type="button" th:style="|background-image:url('@{/images/icons/arrow_down.svg}')|"></button>
                    </div>
                </div>
                <form class="schedule-info">
                    <div class="row-div">
                        <div class="detail-schedule-text-box">
                            <h5>일정일수*</h5>
                            <select class="detail-schedule-select" name="optionType">
                                <option value="notUse">세부일정 사용안함</option>
                            </select>
                            <img src="/images/icon/text-info.svg" style="margin-left: 21px; margin-right: 5px;" alt="">
                            <p class="detail-schedule-caution-text">선택한 일수에따라 일정입력칸이 조정됩니다.</p>
                        </div>
                        <div class="detail-schedule-box">
                            <div class="detail-schedule-day-tab-box">
                                <!--스크립트에서 추가-->
                            </div>
                            <div id="detail-schedule-content-box-list">
                                <!--스크립트에서 추가-->
                            </div>
                        </div>
                        <ul class="buttons">
                            <li class="cancel"><button type="button">취소하기</button></li>
                            <li class="save"><button type="button">저장하기</button></li>
                        </ul>
                    </div>
                </form>
            </div>
            <div id="product-util-buttons">
                <button id="preview" type="button" class="preview" th:onclick="previewProduct()">미리보기</button>
                <button id="temp-save" type="button" class="flag" th:onclick="productTempSave()">임시저장</button>
                <button id="cancel" type="button" class="cancel" th:onclick="registCancel()">취소하기</button>
                <button id="save" type="button" class="save" th:onclick="registProduct()">등록하기</button>
            </div>
        </div>
    </main>

    <div id="modal" class="show-modal">
        <div class="data-wrapper">
            <header>
                <h1>상세페이지 템플릿 선택</h1>
                <div class="cancel-btn" onclick="hideTemplateModal()">
                    <img src="./images/icon/cancel_btn.svg" alt="">
                </div>
            </header>
            <div class="data swiper">
                <ul class="template">
                </ul>
                <ul class="template-select-button">
                    <li class="swiper-button-prev"></li>
                    <li class="swiper-button-next"></li>
                </ul>
            </div>
            <ul class="select-button">
                <li class="add">선택</li>
                <li class="cancel">취소</li>
            </ul>
        </div>
    </div>

    <footer th:replace="~{/manage/inc/manage-footer-include :: footer}"/>
    <aside class="control-sidebar control-sidebar-dark"></aside>
</section>

<!-- ./wrapper -->

<!--일정등록 모달-->
<div class="schedule-add-modal-box">
    <!--스크립트에서 처리-->
</div>
<!--일정수정 모달-->
<div class="schedule-modify-modal-box">
    <!--스크립트에서 처리-->
</div>
<!--연결 장소 선택 모달-->
<div class="connect-place-select-modal-box">
    <div class="connect-place-select-modal-inner-box">
        <div class="schedule-add-modal-top" style="">
            <p class="schedule-add-modal-top-text">연결 장소 선택</p>
            <button type="button" onclick="closeConnectPlaceModal()"><img src="/images/icon/x-black-17x17.svg" style="width: 17px; height: 17px;" alt=""></button>
        </div>
        <div class="connect-place-select-modal-scroll-box">
            <div id="scheduleAddModalScrollInnerBox" class="connect-place-select-modal-scroll-inner-box">
                <form id="search-form" style="padding-right: 17px;">
                    <label class="region-type-select">
                        <span class="schedule-p-text">지역구분</span>
                        <select id="region-type-select" style="margin-left: 18px;" disabled>
                            <option value="samePrice">제주 동부</option>
                            <option value="samePrice">제주 서부</option>
                            <option value="samePrice">제주 남부</option>
                            <option value="samePrice">제주 북부</option>
                        </select>
                    </label>
                    <label class="region-type-select">
                        <span class="schedule-p-text">장소구분</span>
                        <select id="place-type-select" style="margin-left: 18px;" disabled>
                            <option value="samePrice">관광지</option>
                        </select>
                    </label>
                    <div class="place-search-box">
                        <p class="place-search-name">장소명</p>
                        <input type="text" class="place-search-name-input">
                        <button type="button" class="place-search-btn" onclick="searchTourPlace()">조회</button>
                    </div>
                    <hr class="place-hr">
                    <div id="place-item-list">
                        <!--스크립트에서 처리-->
                    </div>
                    <div id="place-item-list-paging" class="pagination-box"></div>
                </form>
            </div>
        </div>

        <div class="place-choose-btn-box">
            <button type="button" class="place-choose-btn" onclick="selectConnectPlace()">선택</button>
            <button type="button" class="place-choose-close-btn" onclick="closeConnectPlaceModal()">닫기</button>
        </div>
    </div>
</div>

<script th:inline="javascript">
    let tempInfo = [[${tempBasicInfo}]];

    $(document).ready(function(event){
        // initialize-product-add-script
        thumbnailImages();
        initializeDatepicker();

        $(".product-input-wrapper .title-div").on("click",showProductInputWrapper);

        $(".switch-box").on("click",switchButton);

        //
        $(".product-input-wrapper form .buttons").on("click",setFlagButtons);

        // 처음 html load시 setSubcategory 실행
        if($("#product-category-id option:selected")){
            initSubProductCategory();
        }


        const categorySelect = document.getElementById('product-category-id');
        categorySelect.addEventListener('change', function () {
            initSubProductCategory();
        });

        // showModifyBlockItem();
        $(".preview-container .image").html("");


        document.querySelector(".product-input-wrapper .info-toggle").click();

        $(".picky").on("change",validationDatePeriod)
    });

    validationDatePeriod = function(event){
        let target = event.target.closest("input");
        let type = target.getAttribute("id");

        if(type =="display-end-date"){
            // display-start-date value가 있을때 해당 값과 비교하여 값이 적으면 alert()
            let endDate = new Date(document.querySelector("#display-end-date").value);
            let startDate = new Date(document.querySelector("#display-start-date").value);
            if(startDate > endDate){
                alert("날짜를 확인해주세요");
                document.querySelector("#display-start-date").value="";
            }

        }else if(type=="display-start-date"){
            let endDate = new Date(document.querySelector("#display-end-date").value);
            let startDate = new Date(document.querySelector("#display-start-date").value);
            if(startDate > endDate){
                alert("날짜를 확인해주세요");
                document.querySelector("#display-end-date").value="";
            }
        }else if(type=="sales-start-date"){
            let endDate = new Date(document.querySelector("#sales-end-date").value);
            let startDate = new Date(document.querySelector("#sales-start-date").value);
            if(startDate > endDate){
                alert("날짜를 확인해주세요");
                document.querySelector("#sales-end-date").value="";
            }
        } else if(type =="sales-end-date"){
            let endDate = new Date(document.querySelector("#sales-end-date").value);
            let startDate = new Date(document.querySelector("#sales-start-date").value);
            if(startDate > endDate){
                alert("날짜를 확인해주세요");
                document.querySelector("#sales-start-date").value="";
            }
        }
    }

    showModifyBlockItem = function(){
        const radioItem = document.querySelectorAll('.radio-check');

        if(tempInfo != null){
            let productStatus = tempInfo.productStatus.replace('R-','');
            for (let i=0; i < radioItem.length; i++) {
                if( radioItem[i].id !== productStatus ){
                    radioItem[i].value = "Y";
                }
                else {
                    document.querySelector(`.${productStatus}`).closest('.product-input-wrapper').nextElementSibling.querySelector('.title-div div.button').click();
                    break;
                }
            }
        }


    }

    initSubProductCategory = function () {
        let selectCategoryId = $("#product-category-id").val();
        console.log("selectCategoryId: ",selectCategoryId);
        $.ajax({
            url:"/manage/product/getProductCategory",
            data:"categoryId="+selectCategoryId,
            type:"GET",
            beforeSend:function(xhr){
                xhr.setRequestHeader( [[${_csrf.headerName}]], [[${_csrf.token}]] );
            },
            success:function(data){
                let subCategoryList = data.subCategories;
                let productSubCategory = document.querySelector("#product-subcategory");
                productSubCategory.innerHTML="";
                console.log("sub-categories: ",data);
                if(data.result=="success"&&subCategoryList.length > 0){
                    productSubCategory.removeAttribute("disabled");
                    productSubCategory.removeAttribute("readonly");

                    Array.from(subCategoryList).forEach(function(item,idx){
                        let optionTag = document.createElement("option");
                        optionTag.setAttribute("value",item.productCategoryId);
                        optionTag.innerText=item.categoryTitle;
                        productSubCategory.appendChild(optionTag);
                    });
                }else{
                    productSubCategory.setAttribute("disabled","disabled");
                    productSubCategory.setAttribute("readonly","readonly");
                    let optionTag = document.createElement("option");
                    optionTag.innerText="하위 카테고리 없음";
                    productSubCategory.appendChild(optionTag);
                }

            },
            error:function(data){
            }
        })
    }

    setFlagButtons = function(event){
        // cancel? save?
        let buttons = event.target.closest("li");
        if(buttons){
            let type = buttons.classList[0];
            let inputWrapper = event.target.closest(".product-input-wrapper");
            let currentInfoToggle = inputWrapper.querySelector(".info-toggle");
            let infoType = inputWrapper.lastElementChild.classList[0];
            if(type == "cancel"){
                // hide tab
                let infoTitle = inputWrapper.querySelector("h3").innerText.replace("*",'');
                if(confirm(infoTitle+" 등록을 취소하시겠습니까?")){
                    if(infoType ==="basic-info"){
                        resetBasicInfo();
                    }
                    if(infoType=="product-info"){
                        resetProductInfo();
                    }
                    if(infoType =="price-info"){
                        resetPriceInfo();
                    }
                    if(infoType=="schedule-info"){
                        resetScheduleInfo();
                    }
                    currentInfoToggle.click();
                }
            }
            if(type=="save"){
                // form-valid-check : 상품이미지, 상품 제목, 상품구분, 상품 요약?
                switch (infoType){
                    case "basic-info":
                        if(productInputValidation(infoType)){
                            if (confirm("해당 정보를 저장하시겠습니까?")){
                                $("#product-status").val("R-basic-info");
                                $("#basic-info-add-form input[name='productStatus']").val("R-basic-info")
                                saveProductInfo(inputWrapper)
                                $("#basic-info").prop("checked",true);
                            }
                        }
                        break;
                    case "product-info":
                        $("#template-html").val($("#content-container").html());
                        if(confirm("해당 정보를 저장하시겠습니까?")){
                            $("#product-status").val("R-product-info");
                            $("#basic-info-add-form input[name='productStatus']").val("R-product-info")
                            saveProductInfo(inputWrapper);

                            $("#product-info").prop("checked",true)
                        }
                        break;
                    case "price-info":
                        if(confirm("해당 정보를 저장하시겠습니까?")){
                            $("#product-status").val("R-price-info");
                            saveProductPriceInfo(inputWrapper)
                            $("#price-info").prop("checked",true)
                        }
                        break;
                    case "schedule-info":
                        if(confirm("해당 정보를 저장하시겠습니까?")){
                            $("#product-status").val("R-schedule-info");
                            saveProductDetailSchedule()
                            $("#schedule-info").prop("checked",true)
                        }
                        break;
                }
            }
        }

    }

    saveProductInfo = function(inputWrapper){
        let formID = inputWrapper.querySelector("form").getAttribute("id");
        let data = formSerialize($(`#`+formID)[0]);
        let type;
        if(formID =="basic-info-add-form"){
            type="productInfo";
        }
        if(formID =="product-info-add-form"){
            type="productTemplate";
        }
        $.ajax({
            url : '/manage/product/saveProduct'
            , data : `{"${type}" : ${data}}`
            , type : 'POST'
            , contentType:"application/json;utf-8"
            , dataType:"JSON"
            , beforeSend : function (xhr) {
                xhr.setRequestHeader([[${_csrf.headerName}]], [[${_csrf.token}]]);
            }
            , success : function(data) {
                let id = data.id
                if ( id !== undefined ) {
                    $("#product-tour-id").val(id); // setting product-tour-id
                }
                $("#basic-info").trigger("click");
                if ( type === "productInfo" ) {
                    document.getElementById('basic-info').value = 'Y';
                }
                else if ( type === "productTemplate" ) {
                    document.getElementById('product-info').value = 'Y';
                }
                // product-info
                // $(".product-tour-id").val(id)
                $("#product-info-add-form > input[name='productTourId']").val(id);

                let nextInfoTab = inputWrapper.nextElementSibling;
                let nextInfoToggle = nextInfoTab.querySelector(".title-div > .info-toggle");
                nextInfoToggle.click();

                let currentInfoToggle = inputWrapper.querySelector(".title-div > .info-toggle");
                currentInfoToggle.click();


            }
            , error:function(){

            }
        });
    }

    productTempSave = function () {
        let postFlag = true;
        const radioInput = document.querySelectorAll('.radio-check');
        for ( let i = 0; i < radioInput.length; i++) {
            if( radioInput[i].id === 'schedule-info' ){
                if ( radioInput[i].value === "N" ) {
                    postFlag = false;
                    let infoTitle = document.querySelector(`.${radioInput[i].id}`).closest('.product-input-wrapper').querySelector("h3").innerText.replace("*",'');
                    alert(`먼저 ${infoTitle} 정보를 저장해주세요.`)
                    break;
                }

            }
        }


        if ( postFlag ) {
            let data = formSerialize($('#basic-info-add-form')[0]);
            const jsonData = JSON.parse(data);
            jsonData.productTourId = document.getElementById('product-tour-id').value;
            jsonData.productMenuId = document.getElementById('product-category-id').value;
            const newData = JSON.stringify(jsonData);
            data = newData;

            $.ajax({
                url: "/manage/product/saveProduct"
                , data : `{"productInfo" : ${data}}`
                , type : 'POST'
                , contentType:"application/json;utf-8"
                , beforeSend:function(xhr){
                    xhr.setRequestHeader([[${_csrf.headerName}]], [[${_csrf.token}]]);
                },
                success:function(data){
                    if ( data.result === 'success' ) {
                        alert("임시저장되었습니다");
                    }
                    else {
                        alert(data.message);
                    }
                },
                error:function(){

                }
            })
        }

    }

    registCancel = function () {
        if ( confirm("저장한 정보는 임시 저장되지만 저장하지 않은 정보는 사라집니다.\n등록 취소하시겠습니까?") ) {
            if ( $("#product-tour-id").val() !== '' ) {
                let data = formSerialize($('#basic-info-add-form')[0]);
                const jsonData = JSON.parse(data);
                jsonData.productTourId = document.getElementById('product-tour-id').value;
                jsonData.productMenuId = document.getElementById('product-category-id').value;
                const newData = JSON.stringify(jsonData);
                data = newData;

                $.ajax({
                    url: "/manage/product/saveProduct"
                    , data : `{"productInfo" : ${data}}`
                    , type : 'POST'
                    , contentType:"application/json;utf-8"
                    , beforeSend:function(xhr){
                        xhr.setRequestHeader([[${_csrf.headerName}]], [[${_csrf.token}]]);
                    },
                    success:function(data){
                        if ( data.result === 'success' ) {
                            location.href = `/manage${[[${listUrl}]]}`;
                        }
                        else {
                            alert(data.message);
                        }
                    },
                    error:function(){

                    }
                })
            }
            else {
                location.href = `/manage${[[${listUrl}]]}`;
            }
        }
    }

    registProduct = function(){
        let postFlag = true;
        const radioInput = document.querySelectorAll('.radio-check');
        //기본정보, 상품정보, 판매가격설정이 저장되어 있는지 체크
        for ( let i = 0; i < radioInput.length; i++) {
            if( radioInput[i].id !== 'schedule-info' ){
                if ( radioInput[i].value === "N" ) {
                    postFlag = false;

                    let infoTitle = document.querySelector(`.${radioInput[i].id}`).closest('.product-input-wrapper').querySelector("h3").innerText.replace("*",'');
                    alert(`먼저 ${infoTitle} 정보를 저장해주세요.`)
                    break;
                }

            }
        }


        if ( postFlag ) {
            $("#basic-info-add-form input[name='productStatus']").val("S")
            let data = $('#basic-info-add-form').serialize();
            data += `&productTourId=${$('#product-tour-id').val()}`;
            $.ajax({
                url: "/manage/product/registProduct",
                data: data,
                type: "post",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader([[${_csrf.headerName}]], [[${_csrf.token}]]);
                },
                success: function (data) {
                    alert(data.message);
                    location.href = `/manage/product/${[[${typeCode}]]}`;
                },
                error: function () {

                }
            })
        }
    }

    productInputValidation = function(infoType){

        let result=false;
        switch (infoType){
            case "basic-info":
                // 상품명, 상품 사진, 상품 대표 사진
                // $("#product-title"),$("#product-thumbnail"), $(".product-image-list");
                if($("#product-title").val() == undefined || $("#product-title").val() ==''){
                    alert("타이틀을 입력해주세요");
                    $("#product-title").focus();
                    result=false;
                }else if($("#product-thumbnail").val() == undefined || $("#product-thumbnail").val() ==''){
                    alert("상품 대표이미지를 선택해주세요");
                    $(".upload-wrapper").focus();
                    result=false;
                }else if($(".product-image-list").children().length <1){
                    alert("이미지를 등록해주세요");
                    $(".upload-wrapper").focus();
                    result=false;
                }else{
                    result=true;
                }
                break;
            case "template-container":
                if($("#template-html").val() != null &&$("#template-html").val().trim()!= ''){
                    result=true
                }else{
                    alert("상품 정보를 등록해주세요");
                    result=false;
                }
                break;
            case "price-info":
                break;
            case "schedule-info":
                break;
        }

        return result;

    }


    formValidCheck = function(item, type, classname, regexType){
        if($(item) === undefined) return false;
        let result = true;
        switch (type){
            case 'input':
                if($(item).val() === undefined || $(item).val() === null || $(item).val().trim() === ''){
                    result = false;
                }else {
                    if(regexType !== null && regexType.trim() !== ''){
                        switch (regexType){
                            case 'email':
                                if($(item).val().match( /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/ ) === null) {
                                    result = false;
                                }
                                break;
                            case 'mobile':
                                if($(item).val().match( /^0[0-9]{2}-?[0-9]{3,4}-?[0-9]{4}$/ ) === null) {
                                    result = false;
                                }
                                break;
                            case 'tel':
                                if($(item).val().match( /^0[0-9]{1,2}-?[0-9]{3,4}-?[0-9]{4}$/ ) === null) {
                                    result = false;
                                }
                                break;
                            case 'count':
                                if($(item).val().match( /^[0-9]+$/ ) === null) {
                                    result = false;
                                }
                                break;
                            case 'medium-pass':
                                if($(item).val().match(/^.*(?=^.{8,16}$)(?=.*\d)(?=.*[a-zA-Z])(?=.*[!@#$%^&+=]).*$/) === null) {
                                    result = false;
                                }
                                break;
                            case 'strong-pass':
                                if($(item).val().match(/^.*(?=^.{8,30}$)(?=.*\d)(?=.*[a-zA-Z])(?=.*[!@#$%^&+=]).*$/) === null) {
                                    result = false;
                                }
                                break;
                            case 'text':
                            default: break;
                        }
                    }
                }
                break;
            case 'select':
            default:
                if($(item).val() === undefined || $(item).val() === null){
                    result = false;
                }
                break;
        }

        if(result){
            $(item).removeClass(classname);
        }else{
            $(item).addClass(classname);
            $(item).focus();
        }

        return result;
    }

    resetBasicInfo = function(){
        $("#product-title").val();
        $("#upload-product-image").val("");
        $("#product-thumbnail").val("");
        $("#product-thumbnail-view").html("");
        $(".product-image-list").html("");
        $("#display-start-date").val("");
        $("#display-end-date").val("");
        $("#sales-start-date").val("");
        $("#sales-end-date").val("");
        $("#product-notice").val("");
        $("#product-tag").val("");
        $("#product-include-item").val("");
        $("#product-exclude-item").val("");
    }

    resetProductInfo = function(){
        $("#product-info-html").val("");
        $("#content-container .slides").html('<li class="slide"></li>');
    }

    resetPriceInfo = function(){
        calendarJson = [];
        calendarBarList = [];
        document.querySelector('.calendar-box').querySelector('.fc-daygrid-event-harness')?.remove();

        const fixPriceOptionList = [[${fixPriceOptionList}]];
        const listBox = document.getElementById('fix-price-list-box');

        listBox.innerHTML = "";
        fixPriceOptionList.forEach((item)=>{
            listBox.insertAdjacentHTML('beforeend',
                `
                <div class="price-option-id-box">
                    <div class="fix-price-option-title">
                        <input data-fix-option-type="name" type="text" class="schedule-p-text" style="width: 100%;" value="${item.optionName}" placeholder="항목을 입력해주세요." />
                        <input data-fix-option-type="price" type="text" onkeyup="checkInputNumValidation(event)" class="schedule-price-text" placeholder="가격을 입력해주세요." />
                    </div>
                    <div class="fix-price-option-quantity">
                        <p class="schedule-p-text">최대수량</p>
                        <input data-fix-option-type="maxQuantity" type="text" onkeyup="checkInputNumValidation(event)" class="schedule-price-text" value="${item.maxQuantity}" placeholder="수량입력" />
                    </div>
                    <div class="option-btx-box">
                        <button type="button" class="delete-option-btn" onclick="deleteFixPriceOption(this)">
                            <img src="/images/icon/x-black-box-15x15.svg" style="width: 15px; height: 15px;" alt="">
                        </button>
                    </div>
                    <input type="hidden" data-fox-option-type="optionSettingId" value="${item.optionSettingId}">
                </div>
                `)
        })

    }

    resetScheduleInfo = function(){
        // TODO..주영님
    }

    setNullSalesEndDate = function(){
        $('#sales-end-date').val('');
    }

    initializeDatepicker = function(){
        console.log("initialized datepicker")
        const datepickerOption = {
            dateFormat:"yy-mm-dd",
            prevText: '이전 달',
            nextText: '다음 달',
            monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
            monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
            dayNames: ['일', '월', '화', '수', '목', '금', '토'],
            dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
            dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
            showMonthAfterYear: true,
            yearSuffix: '년',
        }

        $('#sales-start-date, #sales-end-date').datepicker(datepickerOption);
        $('#display-start-date, #display-end-date').datepicker(datepickerOption);

    };

    setDefaultSalesPeriod = function(){
        $('#sales-start-date').val('');
        $('#sales-end-date').val('');
        $('#display-start-date').val('');
        $('#display-end-date').val('');
        initializeDatepicker();
        $('.picker').show();
    };

    switchButton = function(event){
        // 중요 input태그와 .switch-box의 mark-up 구조및 순서는 fixed!!
        // input태그 다음 .switch-box태그가 와야함
        let target= event.target.closest(".switch-box").previousElementSibling; // input checkbox를 가리킴;
        let switchBox = event.target.closest(".switch-box");
        let noChecked = switchBox.querySelector(".status li.no-checked");
        let checked = switchBox.querySelector(".status li.checked");

        let chkButton = $(target).is(':checked');
        $(target).prop('checked',!chkButton);
        if(!chkButton){
            $(noChecked).removeClass("active");
            $(checked).addClass("active");
            $(target).val("Y") // 서버에 보내는 값
        }else{
            $(checked).removeClass("active");
            $(noChecked).addClass("active");
            $(target).val("N")// 서버에 보내는 값
        }
    }

    showProductInputWrapper = function(event){
        // slide up down
        event.stopPropagation();
        let infoToggle = event.target.closest(".title-div");
        // let titleDiv = infoToggle.parentElement;
        // let formWrapper = titleDiv.parentElement;
        let productWrapper = infoToggle.parentElement;
        let button = productWrapper.querySelector("button");


        productWrapper.classList.toggle("active");
        if(button.classList.contains("arrow-down")){
            button.style.backgroundImage="url(/images/icons/arrow_up.svg)";
            button.classList.add("arrow-up");
            button.classList.remove("arrow-down");
        }else{
            button.style.backgroundImage="url(/images/icons/arrow_down.svg)";
            button.classList.add("arrow-down");
            button.classList.remove("arrow-up");
        }
    }

    thumbnailImages = function(event){
        $('#upload-product-image').on("change",function(event){
            $.ajax({
                url: '/manage/product/upload-product-images',
                type : "POST",
                enctype : 'multipart/form-data',
                data : new FormData($('#basic-info-add-form')[0]),
                contentType : false,
                processData : false,
                beforeSend:function(xhr){
                    xhr.setRequestHeader(
                        [[${_csrf.headerName}]], [[${_csrf.token}]]
                    );
                },
                success : function(data) {
                    if (typeof data.result != "undefined" && data.result == "error") {
                        alert(data.error);
                        return;
                    } else {
                        for(var i=0; i<data.list.length; i++){
                            var row = '<div class="product-image-item swiper-slide" onclick="changeThumbnailImage(this)">';
                            row += '<input type="hidden" name="images" value="'+data.list[i].imageId+'">';
                            row += '<img src="/upload/product/' + data.list[i].uploadFilename + '" class="product-image-preview" />';
                            row += '<button type="button" class="product-image-delete-button" onclick="deleteThumbnailImage(this, \''+data.list[i].imageId+'\');">X</button>';
                            row += '</div>';
                            $('#product-images').find('.product-image-list').append(row);
                        }
                        $('#product-images').show();

                        $('#product-thumbnail').val($('#product-images').find('.product-image-preview').eq(0).attr('src'));
                        $('#product-thumbnail-view').html('<img src="'+$('#product-images').find('.product-image-preview').eq(0).attr('src')+'" class="product-image-preview thumbnail" />');
                    }

                    initializeImageSwiper();
                }
            })
        });
    }

    changeThumbnailImage = function(item){
        let img = item.querySelector("img");
        let src = img.getAttribute("src");
        $('#product-thumbnail').val(src);
        $('#product-thumbnail-view').html('<img src="'+src+'" class="product-image-preview thumbnail" />');
    }

    deleteThumbnailImage = function(item, id){
        $('#product-thumbnail-view').empty();
        $(item).parent().remove();

        $.ajax({
            url: '/manage/product/delete-product-images',
            type : "DELETE",
            data : {
                [[${_csrf.parameterName}]]: [[${_csrf.token}]],
                'product_tour_id' : 0,
                'image_id': id,
            },
            success : function(data) {
                if (typeof data.result != "undefined" && data.result == "error") {
                    alert(data.error);

                } else {
                    let thumbnail = $('#product-images').find('.product-image-preview').eq(0);
                    initializeImageSwiper();
                    if($('#product-images').find('.product-image-preview').length > 0){
                        $('#product-thumbnail').val($(thumbnail).attr('src'));
                        $('#product-thumbnail-view').html('<img src="'+$(thumbnail).attr('src')+'" class="product-image-preview thumbnail" />');
                    }else{
                        $('#product-thumbnail').val('');
                        $('#product-thumbnail-view').html('');
                    }
                }
            },
            error : function(xhr, code, errorMsg) { },
            beforeSend : function() { },
            complete : function() { }
        });
    }

    initializeImageSwiper = function(){
        const swiper = new Swiper('.swiper', {
            direction: 'horizontal',
            speed: 400,
            slidesPerView: Math.floor($('#product-images').width()/200),
            spaceBetween: 10,

            // Navigation arrows
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });
    }

    formSerialize = function(obj) {
        var formData = new FormData(obj);
        var jsonObject = {};

        formData.forEach(function(value, key) {
            if (jsonObject[key] === undefined && key != "images") {
                jsonObject[key] = value;
            }else if(key =="images"){
                jsonObject[key] = [value];
            } else {
                if (!Array.isArray(jsonObject[key])) {
                    jsonObject[key] = [jsonObject[key]];
                }
                jsonObject[key].push(value);
            }
        });

        var jsonString = JSON.stringify(jsonObject);
        return jsonString
    }

</script>
<script th:inline="javascript">
    let dragElement = null;
    let offsetX = 0;
    let offsetY = 0;
    let isDragging = false;
    let initialScale = 1
    let selectTemplateId=0;
    let currentScale = 1;
    let cntBlock=0;
    let COPYcomponent;
    let isMouseClick = false;
    let isShiftPressed = false;
    let COMPONETS_GROUP=[];
    let templateLists=[];
    /****************** 현재는 안쓰이는것 *********************************
     *   let imageSrcFile = {"bgImage":[],"images":[]};
     *   const MODE = {"text-mode":[],"img-mode":[],"table-mode":[]}
     * *****************************************************************/


    $(document).ready(function () {
        //================================= editor-controller ==========================================//
        // 상품 정보 수정 상태
        $("#component-design li").on("click",selectController);

        // 수정중인 슬라이드 edit-style추가
        // $("#editor-section").on("click", function (event) {
        //     // TODO 최적화 필요
        //     console.log("click-component: ",event.target.closest(".component-item"));
        //     console.log("click-slide: ",event.target.closest(".slides li"));
        //
        //
        //     // let selectComponent = document.querySelector(".component-item.edit-style");
        //     // let selectedSlide = document.querySelector(".slides li.edit-style");
        //     //
        //     // if (selectComponent != null) {
        //     //     selectComponent.classList.remove("edit-style");
        //     // }
        //     // if(selectedSlide != null){
        //     //     selectedSlide.classList.remove("edit-style");
        //     // }
        // })

        // 버튼(삽입,취소)
        $(document).on("click",".insert-button li",handleComponentInsertButton);

        //================================= component-item ==========================================//
        // drag
        $(document).on("mousedown", "#content-container .component-item", startDrag);
        // grouping-component
        // $(document).on("mouseup","#content-container .component-item",handleComponentGroup);
        // component-item 스타일 수정
        $(document).on("click", "#content-container .component-item", styleLibrary);
        // component-item 내용 수정
        $(document).on("dblclick", "#content-container .component-item", editContent);
        // 에디터 영역 스케일 조정
        $(document).on("mousewheel","#container-wrapper",handleMouseWheel);
        //정렬
        $(document).on("click",".align-types",alignComponentItem);

        //================================= slide-item ==========================================//
        $(document).keydown("#content-container .slides li.slide", function (event) {
            // key event
            if(event.key ==="Delete"){
                let deleteComponent = event.target.querySelector(".component-item.edit-style");
                console.log("delete component: ",deleteComponent);
                let container = document.querySelector("#content-container .slides .current-slide");
                if (deleteComponent != null && confirm("해당 요소를 삭제 하시겠습니까?")){
                    container.removeChild(deleteComponent);
                }
            }
            if(event.key==="Backspace"){
                let deleteComponent = event.target.closest("div.edit-style");
                console.log("deleteComponent: ",deleteComponent);
                let container = document.querySelector("#content-container .slides .current-slide");
                let textContainer = deleteComponent.querySelector("p");
                if (deleteComponent.childElementCount == 1 && textContainer.innerText.trim()==""&&confirm("해당 요소를 삭제하시겠습니까?")){
                    container.removeChild(deleteComponent);
                }

            }
            if (event.key === 'c' && (event.ctrlKey || event.metaKey)) {
                // Ctrl+C가 눌렸을 때 실행될 코드
                // 선택한 태그의 내용을 복사하는 로직을 작성
                console.log("target: ",event.target.querySelector(".component-item.edit-style"));
                let clickedComponent = document.querySelector(".component-item.edit-style");

                cntBlock+=1; //id값 1증가 data-type-{id}
                COPYcomponent = clickedComponent.cloneNode(true);
                let dataTypeId = COPYcomponent.getAttribute("data-type-id");
                let stringType = dataTypeId.split('-')[0];
                let StringId = dataTypeId.split('-')[1];
                let numId = Number.parseInt(StringId);
                numId+=1;
                cntBlock = numId;
                COPYcomponent.setAttribute("data-type-id",`${stringType}-${numId}`);
                console.log("COPYcomponent: ",COPYcomponent);

            }
            if (event.key === 'v' && (event.ctrlKey || event.metaKey)) {
                let currentSlide = document.querySelector("#content-container .slides li.current-slide");
                console.log("currentSlide: ",currentSlide);
                console.log("copiedComponent",COPYcomponent);
                if (COPYcomponent != null && currentSlide != null){
                    COPYcomponent.style.top="50%";
                    COPYcomponent.style.left="50%";
                    currentSlide.appendChild(COPYcomponent);
                }else{
                    console.log("복사실패")
                }
            }
            if (event.key==="Shift"){
                isShiftPressed=true;
            }
            if(event.key=="Escape"){
                let selectComponent = document.querySelectorAll(".component-item.edit-style");
                let selectedSlide = document.querySelector(".slides li.edit-style");

                if (selectComponent != null && selectComponent.length >=1) {
                    Array.from(selectComponent).forEach(function(item){
                        item.classList.remove("edit-style");
                    })
                }
                if(selectedSlide != null){
                    selectedSlide.classList.remove("edit-style");
                }
            }
            event.stopImmediatePropagation();
        });

        $(document).keyup("#content-container .slides li.slide",function(event){
            if (event.key==="Shift"){
                isShiftPressed=false;
                console.log("isShiftPress: ",isShiftPressed);
            }
            if (event.key ==="Delete"){
                let delBgImage = event.target.querySelector(".slides li.edit-style");
                if (delBgImage != null && confirm("해당 배경 이미지를 삭제 하시겠습니까?")){
                    delBgImage.style.backgroundImage = "";
                }

            }
            event.stopImmediatePropagation();
        });

        // 슬라이드 수정
        $(document).on("click", "#content-container .slides li.slide", selectSlide);

        // 슬라이드 추가
        $(document).on("click", "#editor-section #util-buttons .slide-add", addSlide)

        // 슬라이드 삭제
        $(document).on("click", "#editor-section #util-buttons .slide-remove", removeSlide)

        // 템플릿 scale 조정
        $("#editor-section header div.zoom-out").on("click", sectionZoomOut)

        // 템플릿 scale 조정
        $("#editor-section header div.zoom-in").on("click", sectionZoomIn);

        //================================= upload ==========================================//
        // 이미지,배경이미지 업로드
        $(document).on("change",".library-wrapper .upload-btn input",handleUploadEvent)

        // $(document).on("click",".library-wrapper .upload-btn bgImage-upload,.library-wrapper .upload-btn image-upload",handleUploadEvent);

        //================================= 페이지 기본 기능 ==========================================//
        // 해당 페이지 ctrl + scroll 이벤트 제한(스크롤 확대/축소 막기)
        document.addEventListener("wheel",function(event){
            if (event.ctrlKey) {
                event.preventDefault(); // Ctrl 키와 마우스 휠 기본 동작 막음
            }
        }, { passive: false })

        // modal
        $(document).on("click", "#modal .data-wrapper .select-button .cancel", deSelectTemplate);

        $(document).on("click","#modal .data-wrapper .select-button .add",renderTemplate);

    });

    function handleComponentGroup(event){
        // TODO group-select 최적화 필요
        console.log("grouping.....");
        isMouseClick=true;

        let component = event.target.closest(".component-item");

        // COMPONETS_GROUP.length =0 // 배열 비우기
        if ( isMouseClick && isShiftPressed){
            component.classList.add("edit-style");
            console.log("grouping....");
            // let slide = document.querySelector("#content-container .slides li.current-slide");
            let componentGroupList = document.querySelectorAll(".component-item.edit-style");
            console.log("componentGroupList: ",componentGroupList);
            Array.from(componentGroupList).forEach(function(item){
                COMPONETS_GROUP.push(item);
            });
        }else{
            event.stopPropagation();
        }
    }

    function handleMouseWheel(event){

        if(event.ctrlKey){
            event.preventDefault();
            if(event.deltaY>0){
                currentScale += 0.1;
                if (currentScale < 0.1) currentScale = 0.1;

                let contentContainer = document.querySelector("#content-container");
                let scaleValueElement = document.querySelector(".scale-value");
                contentContainer.style.transform = `scale(${currentScale})`;
                scaleValueElement.innerText = `${(currentScale * 100).toFixed(0)}%`;
            }else{
                currentScale -= 0.1;
                if (currentScale < 0.1) currentScale = 0.1;
                let contentContainer = document.querySelector("#content-container");
                let scaleValueElement = document.querySelector(".scale-value");
                contentContainer.style.transform = `scale(${currentScale})`;
                scaleValueElement.innerText = `${(currentScale * 100).toFixed(0)}%`;

            }
        }
    }

    function sectionZoomIn(event) {
        currentScale += 0.1;
        if (currentScale > 2) currentScale = 2;
        let contentContainer = document.querySelector("#content-container");
        let scaleValueElement = document.querySelector(".scale-value");
        contentContainer.style.transform = `scale(${currentScale})`;
        scaleValueElement.innerText = `${(currentScale * 100).toFixed(0)}%`;
        document.removeEventListener("#editor-section header div.zoom-in",sectionZoomIn);
    }

    function sectionZoomOut(event){
        currentScale -= 0.1;
        if (currentScale < 0.1) currentScale = 0.1;
        let contentContainer = document.querySelector("#content-container");
        let scaleValueElement = document.querySelector(".scale-value");
        contentContainer.style.transform = `scale(${currentScale})`;
        scaleValueElement.innerText = `${(currentScale * 100).toFixed(0)}%`;
        document.removeEventListener("#editor-section header div.zoom-in",sectionZoomOut);
    }

    function handleComponentInsertButton(event){
        // library의 버튼 타입 class로 파악 ex) class="text-create" or
        let buttonClassArr = event.target.closest("li").classList[0].split('-'); //  -> ["text","create"],["text","cancel"]
        let button = buttonClassArr[1]; // -> ["create"],["cancel"]
        let editType = buttonClassArr[0] // -> text? table? images? bgImage?
        // cntBlock = 0;// ->block 생성개수 초기화
        if(button =="create"){
            // 컴포넌트 생성
            cntBlock+=1;
            renderComponentBlock(editType,cntBlock);

        }else if(button =="cancel"){
            // 컴포넌트 취소(삭제)
            // selectComponentBlock
            if(editType=="text"){
                resetComponentStyle(editType);
            }
            if(editType=="bgImage"){
                resetComponentStyle();
            }
        }
    }

    function resetComponentStyle(editType){
        let library = document.querySelector("#library-section .library-wrapper div.active");

        if (editType =="text"){
            let inputValues = library.querySelectorAll("input");
            let selectOptions = library.querySelector("select");
            let options = selectOptions.querySelectorAll("option");
            Array.from(inputValues).forEach(function(item){
                item.value=""
            })
            selectOptions.value="";
            Array.from(options).forEach(function(item){
                item.selected =false;
            });
        }else if(editType =="bgImage") {

        }else{

        }


    }

    function renderComponentBlock(type,cnt){
        // TODO.. cnt 부분 수정필요
        // 확장 가능함... 선택한 type별로 element를 현재 slide에 추가
        let currentSlide = document.querySelector("#content-container .slides li.current-slide");
        switch(type){
            case "text":
                // element 생성
                let div = document.createElement("div");
                div.classList.add("component-item");
                div.setAttribute("data-type-id",`${type}-${cnt}`);
                div.innerHTML=`<p data-protected="true">더블클릭하여 수정하세요</p>`;
                div.style.position="absolute";
                div.style.top="20%";
                div.style.left="0";
                let fontFamily=  document.querySelector("#font-family").value;
                let fontSize = document.querySelector("#font-size").value;
                let fontWeight = document.querySelector("#font-weight").value;
                let fontColor = document.querySelector("#font-color").value;
                let fontColorSample = document.querySelector(".hex-value").innerText;

                div.style.fontFamily= (fontFamily != null && fontFamily != undefined) ? fontFamily : 'Pretendard-Regular';
                div.style.fontSize = (fontSize != null && fontSize != undefined) ? fontSize+'px' : "16px";
                div.style.fontWeight = (fontWeight != null && fontWeight != undefined) ? fontWeight : "400";
                div.style.color = (fontColor != null && fontColor != undefined) ? fontColor : fontColorSample;


                // current-slide 삽입
                currentSlide.appendChild(div);
                break;
            case "table":
                // element 생성
                // element 생성
                let block = document.createElement("div");
                block.classList.add("component-item");
                block.setAttribute("data-type-id", `${type}-${cnt}`);
                let table = document.createElement("table");
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>제목1</th>
                            <th>제목2</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>내용1</td>
                            <td>내용2</td>
                        </tr>
                    </tbody>
                    `;
                block.appendChild(table);

                block.style.position = "absolute";
                block.style.top = "20%";
                block.style.left = "30%";

                currentSlide.appendChild(block);
                break;
            case "images":
                // element 생성
                selectUploadImage();
                break;
            case "bgImage":
                // element 생성
                styleForBackground();
                break;
            case "card":
                // element 생성
                styleForImages();
                break;
        }

    }

    function selectController(event){
        let selected = event.target.closest("li");
        let designType = selected.classList[0].split('-')[2];
        let controllers = document.querySelectorAll("#component-design li");

        Array.from(controllers).forEach(function(item){
            item.classList.remove("active");
        });
        selected.classList.add("active");

        let bgColor = document.querySelector("#bg-color");
        let bgOpacity = document.querySelector("#bg-opacity");

        if(bgColor != null && bgOpacity != null){
            bgColor.removeAttribute("disabled");
        }
        if (bgOpacity != null){
            bgOpacity.removeAttribute("disabled");
        }

        if(designType != "template"){
            showLibraryTab(designType);
        }else{
            // template은 ajax로 요청
            if (templateLists.length>0){
                showTemplateModal();
                const templateSwiperWrapper = document.querySelector("#modal ul.template");
                templateSwiperWrapper.innerHTML = "";
                templateSwiperWrapper.classList.add("swiper-wrapper");
                for (let i = 0; i < templateLists.length; i++) {
                    templateSwiperWrapper.appendChild(templateLists[i]);
                }
                templateSwiperWrapper.classList.add("swiper-wrapper");
                templateSwiper();

            }else{
                getTemplateLists();
            }
        }
    }

    function addSlide(event) {
        let slideContainer = document.querySelector("#content-container .slides");
        let li = document.createElement("li");
        li.classList.add(`slide`);
        slideContainer.appendChild(li);

        // current-slide 클래스 제어
        let slides = slideContainer.querySelectorAll(".current-slide");
        Array.from(slides).forEach(function (item) {
            item.classList.remove("current-slide");
            item.classList.remove("edit-style");
        });
        slideContainer.lastElementChild.classList.add("current-slide");
        slideContainer.lastElementChild.classList.add("edit-style");

        // current-slide 위치로 이동
        let container = document.querySelector("#content-container");
        let currentSlide = container.querySelector(".current-slide");

        if (currentSlide) {
            currentSlide.scrollIntoView({ behavior: 'smooth' });
        }


        let cnt = slideContainer.childElementCount;
        console.log("cnt: ",cnt);
        let slideSize = document.querySelector("#editor-section header .slide-width-height");
        slideSize.innerText = `850 X ${1000*cnt}`;


    }

    function selectSlide(event){

        let currentSlide = event.target.closest("li"); // 선택된 슬라이드
        let components = currentSlide.querySelectorAll("div.edit-style");

        if (!currentSlide.classList.contains("edit-style")) {
            // edit-style추가
            let slidesContainer = currentSlide.parentElement; // ul.slides
            let slides = slidesContainer.querySelectorAll("li");
            //slides > 선택된 li 클래스 동적 추가/제거
            Array.from(slides).forEach(function (item) {
                item.classList.remove("edit-style");
                item.classList.remove("current-slide");
            });

            Array.from(components).forEach(function(item){
                item.classList.remove("edit-style");
            })

            // 선택된 슬라이드 class명 추가 edit-style current-slide
            currentSlide.classList.add("edit-style");
            currentSlide.classList.add("current-slide");
        }

        showLibraryTab('bgImage');
        styleForBackground()
        removeEditStyleComponent();
    }

    function removeEditStyleComponent(){
        let currentSlide = document.querySelector("#content-container .slides li.current-slide");
        let editComponent = currentSlide.querySelector("div.edit-content");
        if (editComponent != null){
            editComponent.removeAttribute("contenteditable");
            editComponent.classList.remove("edit-content");
        }
    }

    function removeSlide(event) {

        let container = document.querySelector("#content-container");
        let slidesContainer = container.querySelector(".slides");
        let currentSlide = container.querySelector(".current-slide");
        let lastSlide = slidesContainer.lastChild;

        if (slidesContainer.childElementCount === 1) {
            alert("슬라이드는 1개이상 필요합니다.");
        } else {
            if (confirm("현재 슬라이드를 삭제하시겠습니까?")) {
                // 해당 슬라이드 제거
                slidesContainer.removeChild(currentSlide);
                let lastChild = document.querySelector(".slides li:last-child");
                lastChild.classList.add("current-slide");

                let cnt = slidesContainer.childElementCount;
                console.log("cnt: ",cnt);
                let slideSize = document.querySelector("#editor-section header .slide-width-height");
                slideSize.innerText = `850 X ${1000*cnt}`;

            }
        }
    }

    function deleteComponent() {
        let deleteComponent = document.querySelector(".component-item");
        let container = document.querySelector(".slides li.current-slide");
        container.removeChild(deleteComponent);
    }

    function getTemplateLists() {
        showTemplateModal();
        // ajax -> 함수 템플릿 가져오기
        $.ajax({
            url:"/manage/product/template-list",
            success:function(data){
                showTemplateModal();
                const templateSwiperWrapper = document.querySelector("#modal ul.template");
                templateSwiperWrapper.innerHTML = "";
                templateSwiperWrapper.classList.add("swiper-wrapper");
                for (let i = 0; i < data.templateList.length; i++) {
                    let li = document.createElement("li");
                    li.classList.add("item");
                    li.classList.add("swiper-slide");
                    li.innerHTML = `
                                    <div class="template-thumbnail" onclick="selectTemplate(this,${data.templateList[i].templateId})">
                                        <img src="/upload/product/${data.templateList[i].templateThumbnail}">
                                    </div>
                                    <div class="template-title">${data.templateList[i].title}</div>`;
                    templateSwiperWrapper.appendChild(li);
                    templateLists.push(li);
                }
                templateSwiperWrapper.classList.add("swiper-wrapper");
                templateSwiper();
            },
            error:function(data){
                console.log("error: ",data.result);
            }
        })
    }

    function showTemplateModal() {
        let modal = document.querySelector('#modal');
        modal.classList.add("active");
    }

    function hideTemplateModal() {
        let modal = document.querySelector('#modal');
        modal.classList.remove("active");
        selectTemplateId = 0;
    }

    function uploadEditorImage(item) {

        let id = item.getAttribute("id");
        let type = id.split("-")[0];

        let previewContainer = document.querySelector(`#${id}`).parentElement.nextElementSibling;
        let formData = new FormData();


        if(type != null){
            // 미리보기
            let imagePreview = document.querySelector("#"+`${type}-preview .image`);
            imagePreview.innerHTML = "";

            // image type별 formData 세팅
            let imageFile = (type=="image") ? item.files : "";
            let bgImageFile = (type=="bgImage") ? item.files : "";

            if(imageFile != null && imageFile.length >0) {
                Array.from(imageFile).forEach(function(item){
                    formData.append("editor-image-upload",item);
                })
            }else if(bgImageFile != null && bgImageFile.length > 0){
                Array.from(bgImageFile).forEach(function(item){
                    formData.append("editor-bgImage-upload",item);
                })
            }

            // data : new FormData($("#product-info-add-form")[0]);
            $.ajax({
                url:`/manage/product/upload-template-image`,
                type:"POST",
                enctype : 'multipart/form-data',
                data: formData,
                contentType : false,
                processData : false,
                beforeSend:function(xhr){
                    xhr.setRequestHeader(
                        [[${_csrf.headerName}]], [[${_csrf.token}]]
                    );
                },
                success:function(data){
                    if(typeof data.result != undefined && data.result=="error"){
                        alert(data.error)
                    }else{
                        let bgColor;
                        let bgOpacity;
                        switch(type){
                            case "bgImage":
                                for(let i=0;i<data.list.length;i++){
                                    let li = document.createElement("li");
                                    li.innerHTML = `<div class='preview-image'>
                                                        <img src="/upload/product/${data.list[i].uploadFilename}" class='product-image-preview'
                                                        onclick="selectUploadBgImage(this)">
                                                        <button type='button' class='product-image-delete-button' onclick='deleteEditorImage(this,${data.list[i].fileId})'>X</button>
                                                    </div>`;
                                    imagePreview.appendChild(li);
                                }

                                // 배경색상- 투명도 조절제어
                                bgColor = document.querySelector("#bg-color");
                                bgOpacity = document.querySelector("#bg-opacity");

                                if(bgColor != null && bgOpacity != null){
                                    bgColor.setAttribute("disabled","disabled");
                                    bgOpacity.setAttribute("disabled","disabled");
                                }

                                break;
                            case "image":
                                for(let i=0;i<data.list.length; i++){
                                    let li = document.createElement("li");
                                    li.innerHTML = `<div class='preview-image'>
                                                        <img src="/upload/product/${data.list[i].uploadFilename}" class='product-image-preview'
                                                        onclick="selectUploadImage(this)">
                                                        <button type='button' class='product-image-delete-button' onclick='deleteEditorImage(this,${data.list[i].fileId})'>X</button>
                                                    </div>`;
                                        imagePreview.appendChild(li);
                                }

                                bgColor = document.querySelector("#bg-color");
                                bgOpacity = document.querySelector("#bg-opacity");

                                if(bgColor != null && bgOpacity != null){
                                    bgColor.setAttribute("disabled","disabled");
                                    bgOpacity.setAttribute("disabled","disabled");
                                }
                                break;
                        }
                    }
                },
                error:function(){
                },
                complete:function(){
                }
            })
        }

    }

    function selectUploadBgImage(item){
        let src = item.getAttribute("src");
        let currentSlide = document.querySelector("#content-container .slides li.current-slide");
        currentSlide.style.backgroundImage=`url(${src})`;
    }

    function selectUploadImage(item){
        let currentSlide = document.querySelector("#content-container .slides li.current-slide");
        let src = item.getAttribute("src");
        let div = document.createElement("div");
        cntBlock +=1;
        div.classList.add("component-item");
        div.style.position="absolute";
        div.classList.add("edit-style");
        div.setAttribute("data-type-id",`image-${cntBlock}`);
        div.innerHTML = `<div class="card-container">
                            <div class='image-box' style="background-image:url('${src}')">
                            </div>
                        </div>`;
        currentSlide.appendChild(div);
    }

    function renderPreviewImages(){
        let previewImageContainer = document.querySelector("#image-preview .image");
        let imagesArr = imageSrcFile.images;
        previewImageContainer.innerHTML ="";
        Array.from(imagesArr).forEach(function(src,id){
            // TODO...
            // 추후 image의 id값은 ajax에서 image업로드시 처리
            // 해당 id는 임시방편
            let li = document.createElement("li");
            li.innerHTML = `<div class='preview-image'>
                                <input id='${id}' type='checkbox' class='check'>
                                <label for='${id}'>
                                    <img src='${src}'>
                                </label>
                            </div>`;
            previewImageContainer.appendChild(li);
        });

    }

    function createTextComponent(event) {
        const container = document.querySelector(".editor.active");

        if (container) {
            const inputElement = document.createElement("input");
            inputElement.style.position = "absolute";
            inputElement.style.backgroundColor = "transparent";
            inputElement.style.height = "20px";
            inputElement.style.lineHeight = "25px";
            inputElement.style.width = "fit-content";
            inputElement.style.outline = "none";
            inputElement.style.borderStyle = "none";

            // coordintates
            inputElement.style.left = event.clientX + "px";
            inputElement.style.top = event.clientY + "px";
            inputElement.addEventListener("keyup", function (event) {
                if (event.key === "Enter") {
                    const text = inputElement.value;
                    if (text) {
                        const textElement = document.createElement("p");
                        const divElement = document.createElement("div");
                        divElement.classList.add("component-item");
                        divElement.setAttribute("draggable", isDragging);

                        textElement.innerText = text;
                        divElement.appendChild(textElement);
                        divElement.style.position = "absolute";
                        divElement.style.zIndex = "1000";
                        divElement.style.left = inputElement.style.left;
                        divElement.style.top = inputElement.style.top;

                        // divElement.addEventListener("mousedown", startDrag);
                        container.appendChild(divElement);

                    }
                    container.removeChild(inputElement);
                }
            });
            container.appendChild(inputElement);
            inputElement.focus();
        }
    }

    function insertComponentBlock(dom) {
        let cloneDOM = dom.cloneNode(true);
        let container = document.querySelector("#content-container");
        let currentSlide = container.querySelector(".current-slide");

        // slide에 삽입
        currentSlide.appendChild(cloneDOM);

        let rect = cloneDOM.getBoundingClientRect();

        let width = rect.width;
        let height = rect.height;

        cloneDOM.style.position = "absolute";
        cloneDOM.style.top = "10%";
        cloneDOM.style.left = "35%";
        // dom.style.width="300px";
        // dom.style.height="fit-content";

        // cloneDOM.style.transform = "translate(-50%,-50%)";
        //
        // dom.addEventListener("mousedown", startDrag);

    }

    function createCardComponent(event) {
        let container = document.querySelector("#content-container");
        let ajaxComp = `
            <div class='component-item-card'>
                <span>
                    <div class='cardimage'>
                        <img src='./images/sample-background.jpg'>
                    </div>
                    <div class='cardText'>테스트 이미지</div>
                </span>
            </div>
            `;
        let comElem = evnet.traget.closest(".component-item");

    }

    function startDrag(event) {
        dragElement = event.target.closest(".component-item");

        if(dragElement != null && dragElement.classList.contains("component-item")){

            let container = document.querySelector("#content-container .slides li.current-slide");
            // mouse-down시 클릭 시 dragElement의 좌표 calibration계산
            offsetX = (event.clientX - dragElement.getBoundingClientRect().left);
            offsetY = (event.clientY - dragElement.getBoundingClientRect().top);

            // mouse-down과 mouse-move, mouseup, mouseleave 를 binding
            container.addEventListener("mousemove", onMouseMove);
            container.addEventListener("mouseup", stopDrag);
        }
        event.stopPropagation();

    }

    function onMouseMove(event) {
        event.preventDefault();
        isDragging = true; // drag 여부

        let container = document.querySelector("#content-container .slides li.current-slide");
        let rect = container.getBoundingClientRect();
        let scaleRatio = currentScale / initialScale;

        if (isDragging && dragElement != null) {
            // 기존
            dragElement.classList.add("dragging");
            dragElement.style.left = (event.clientX - rect.left - offsetX )/scaleRatio + "px";
            dragElement.style.top = (event.clientY - rect.top- offsetY )/scaleRatio + "px";
        }else{

        }

    }

    function stopDrag(event) {
        let component = document.querySelector(".edit-style");
        let container = document.querySelector("#content-container .slides .slide");

        isDragging = false;
        if (dragElement != null){
            dragElement.classList.remove("dragging");
            dragElement = null;
        }

        // event fired 이벤트 삭제
        container.removeEventListener("mousemove", onMouseMove);
        container.removeEventListener("mouseup", stopDrag);
        event.stopImmediatePropagation();
    }

    function convertPxToPercentage(DOM) {
        const containerWidth = DOM.offsetWidth;
        const containerHeight = DOM.offsetHeight;

        // 마우스 클릭 이벤트 발생 시 클릭한 좌표
        const clickX = event.clientX - DOM.getBoundingClientRect().left;
        const clickY = event.clientY - DOM.getBoundingClientRect().top;

        // 픽셀 좌표를 백분율로 변환
        const clickPercentX = (clickX / containerWidth) * 100;
        const clickPercentY = (clickY / containerHeight) * 100;

        // 클릭한 좌표를 백분율로 표시
        let x = clickPercentX;
        let y = clickPercentY;
        let coordinates = { "X": clickPercentX, "Y": clickPercentY };
        return coordinates;
    }

    function editContent(event) {
        // selectComponent
        event.preventDefault();
        let container = document.querySelector("#content-container .slides li.current-slide");
        let component = event.target.closest(".component-item");
        let editType = component.getAttribute("data-type-id").split("-")[0];

        component.classList.toggle("edit-content");
        component.setAttribute("contenteditable", "true");
        // component.setAttribute("spellcheck", "true")

        component.addEventListener("keydown", function (event) {
            let item = event.target; // component

            // let textContainer = item.closest("p");
            let textContainer = item.querySelector("p");
            let text = textContainer.innerText;

            if (event.key == "Escape") {
                let item = event.target;
                let text = item.innerText;
                if (text){
                    if (editType=="text"){
                        // component.innerHTML = `<p>${text}</p>`
                        component.setAttribute("contenteditable", "false");
                        component.setAttribute("spellcheck", "false");
                        component.classList.remove("edit-content");
                        component.classList.remove("edit-style");
                    }
                    else if(editType=="table"){
                        let td = table.getElementsByTagName("td");
                        let th = table.getElementsByTagName("th");
                        Array.from(td).forEach(function(cell){
                            cell.innerHTML = cell.innerHTML.replace("/<br>/g",'');
                        })
                        Array.from(th).forEach(function(heads){
                            heads.innerHTML.replace("/<br>/g",'')
                        })
                        component.setAttribute("contenteditable", "false");
                        component.setAttribute("spellcheck", "false");
                        component.classList.remove("edit-content");
                    }
                    else if(editType=="image"){
                        component.setAttribute("contenteditable", "false");
                        component.setAttribute("spellcheck", "false");
                        component.classList.remove("edit-content");
                    }
                }else{
                    container.removeChild(item);
                }
            }

            if (event.key === 'Backspace') {

                let selection = window.getSelection();
                let range = selection.getRangeAt(0);
                let startContainer = range.startContainer;

                // 선택한 시작컨테이너가 특정 p태그이면서 그 p태그가 수정되면 안되는경우
                if (startContainer === textContainer && textContainer.getAttribute('data-protected') === "true") {
                    event.preventDefault(); // 백스페이스 키의 기본 동작을 중단
                }
            }


            // if (event.key=="Enter"){
            //     let item = event.target;
            //     let text = item.innerText;
            //     let table = item.querySelector("table");
            //     if (text){
            //         if (editType=="text"){
            //             component.innerHTML = `<p>${text}</p>`
            //             component.setAttribute("contenteditable", "false");
            //             component.setAttribute("spellcheck", "false");
            //             component.classList.remove("edit-content");
            //         }else if(editType=="table"){
            //             let td = table.getElementsByTagName("td");
            //             let th = table.getElementsByTagName("th");
            //             Array.from(td).forEach(function(cell){
            //                 cell.innerHTML = cell.innerHTML.replace("/<br>/g",'');
            //             })
            //             Array.from(th).forEach(function(heads){
            //                 heads.innerHTML.replace("/<br>/g",'')
            //             })
            //
            //             component.setAttribute("contenteditable", "false");
            //             component.setAttribute("spellcheck", "false");
            //             component.classList.remove("edit-content");
            //         }
            //     }
            //     else{
            //         container.removeChild(component);
            //     }
            // }
            // else if(event.shiftKey && event.key=="Enter"){
            //     let item = event.target;
            //     let text = item.innerText;
            //     let table = item.querySelector("table");
            //     console.log("editType: ",editType)
            //     console.log("text:",text);
            //     if (text){
            //         if (editType=="text"){
            //             component.innerHTML = `${text}`
            //             component.classList.remove("edit-content");
            //         }else if(editType=="table"){
            //             let td = table.getElementsByTagName("td");
            //             let th = table.getElementsByTagName("th");
            //             Array.from(td).forEach(function(cell){
            //                 cell.innerHTML = cell.innerHTML.replace("/<br>/g",'');
            //             })
            //             Array.from(th).forEach(function(heads){
            //                 heads.innerHTML.replace("/<br>/g",'')
            //             })
            //             component.classList.remove("edit-content");
            //         }
            //     }
            //     else{
            //         container.removeChild(component);
            //     }
            //
            // }

            // if (event.key == "Enter" && !event.shiftKey) {
            //     let item = event.target;
            //     let text = item.innerText;
            //     let table = item.querySelector("table");
            //
            //     if (text) {
            //         if(dataType=="text"){
            //             component.innerHTML = `<p>${text}</p>`
            //             component.setAttribute("contenteditable", "false");
            //             component.setAttribute("spellcheck", "false");
            //             component.classList.remove("edit-content");
            //         }
            //         if(dataType=="table"){
            //             let td = table.getElementsByTagName("td");
            //             let th = table.getElementsByTagName("th");
            //             Array.from(td).forEach(function(cell){
            //                 cell.innerHTML = cell.innerHTML.replace("/<br>/g",'');
            //             })
            //             Array.from(th).forEach(function(heads){
            //                 heads.innerHTML.replace("/<br>/g",'')
            //             })
            //
            //             component.setAttribute("contenteditable", "false");
            //             component.setAttribute("spellcheck", "false");
            //             component.classList.remove("edit-content");
            //         }
            //     } else {
            //         // 텍스트가 없으면 삭제
            //         container.removeChild(component);
            //     }
            // }

        });

        event.stopImmediatePropagation();

    }

    function styleLibrary(event) {
        // 선택한 component의 타입별 library 탭 보이기
        let clickedComponent = event.target.closest(".component-item");
        let dataTypeId = clickedComponent.getAttribute("data-type-id");
        let dataset = dataTypeId.split('-');
        let dataType = dataset[0];
        // let dataId = dataset[1];
        let components = document.querySelectorAll(".component-item");
        let currentSlide = clickedComponent.parentElement;
        currentSlide.classList.remove("edit-style");
        if (clickedComponent != null) {
            // component-item 클릭시 tab 보여주기
            showLibraryTab(dataType);
            switch (dataType){
                case "text":
                    if(isShiftPressed ==false){
                        console.log("non-grouping....");
                        Array.from(components).forEach(function (item) {
                            item.classList.remove("edit-style");
                        });
                        clickedComponent.classList.add("edit-style");
                    }else{
                        clickedComponent.classList.add("edit-style");
                    }
                    styleForText(dataTypeId);
                    break;
                case "table":
                    // component-item에 edit-style 클래스 동적 추가
                    if(isShiftPressed ==false){
                        Array.from(components).forEach(function (item) {
                            item.classList.remove("edit-style");
                        });
                        clickedComponent.classList.add("edit-style");
                    }else{
                        clickedComponent.classList.add("edit-style");
                    }
                    styleForTable(dataTypeId);
                    break;
                case "bgImage":
                    // component-item에 edit-style 클래스 동적 추가
                    if(isShiftPressed ==false){
                        Array.from(components).forEach(function (item) {
                            item.classList.remove("edit-style");
                        });
                        clickedComponent.classList.add("edit-style");
                    }else{
                        clickedComponent.classList.add("edit-style");
                    }
                    styleForBackground();
                    break;
                case "image":
                    // component-item에 edit-style 클래스 동적 추가
                    if(isShiftPressed ==false){
                        Array.from(components).forEach(function (item) {
                            item.classList.remove("edit-style");
                        });
                        clickedComponent.classList.add("edit-style");
                    }else{
                        clickedComponent.classList.add("edit-style");
                    }
                    styleForImages(dataTypeId)

                    break;
            }
        }

        if (isShiftPressed){
            // isGroup?
            console.log("grouping....");
            // let slide = document.querySelector("#content-container .slides li.current-slide");
            let componentGroupList = document.querySelectorAll("div.edit-style");

            // 대상의style
            let computedStyle = getComputedStyle(clickedComponent);


            Array.from(componentGroupList).forEach(function(item){
                COMPONETS_GROUP.push(item);
            });
            console.log("componentGroupList: ",componentGroupList);
        }

        event.stopImmediatePropagation();// selectSlide 이벤트 전파 방지
    }

    function showLibraryTab(className) {
        // 클릭 대상의 style가져오기
        let currentSlide = document.querySelector("#content-container .slides li.current-slide");
        let clickedComponent = currentSlide.querySelector("div.edit-style");
        if(clickedComponent != null){
            let computedStyle = getComputedStyle(clickedComponent);
            if (className=="text"){
                initializeTextStyleInputValue(computedStyle);
            }
            if(className=="image"){
                initializeImageStyleInputValue(computedStyle);
            }

        }
        // tab보여주기
        let libraryList = document.querySelectorAll(".library-wrapper .library");
        Array.from(libraryList).forEach(function (item) {
            item.classList.remove("active");
        });
        let activeLibrary = document.querySelector(`.library-wrapper div.${className}`);
        activeLibrary.classList.add("active");

    }

    function initializeImageStyleInputValue(computedStyle){
        let newImageWidth = computedStyle.getPropertyValue("width").replace('px','');
        let newImageHeight = computedStyle.getPropertyValue("height").replace('px','');
        let previewImage = document.querySelector("#image-preview .image");
        previewImage.innerHTML = "";

        console.log("newImageWidth: ",newImageWidth);
        console.log("newImageHeight: ",newImageHeight);

        let targetImageWidth = document.querySelector("#image-width");
        let targetImageHeight = document.querySelector("#image-height");

        targetImageWidth.value = Number.parseInt(newImageWidth);
        targetImageHeight.value = Number.parseInt(newImageHeight);

    }

    function initializeTextStyleInputValue(computedStyle){
        let libraryTab = document.querySelector("#font");

        // 선택한 요소의 style
        let newFontFamily=computedStyle.getPropertyValue("font-family");
        let newFontSize=Number.parseInt(computedStyle.getPropertyValue("font-size").replace('px',''));
        let newFontWeight=Number.parseInt(computedStyle.getPropertyValue("font-weight"));
        let newFontColor = rgbToHex(computedStyle.getPropertyValue("color"));

        // 기존 style
        let targetFontFamily=document.querySelector("#font-family");
        let targetFontSize = document.querySelector("#font-size");
        let targetFontWeight = document.querySelector("#font-weight");
        let targetFontColor = document.querySelector("#font-color");
        let targetFontHexColor = document.querySelector(".hex-value");

        for (let i=0;i<targetFontFamily.options.length;i++){
            let option = targetFontFamily.options[i];
            if (option.value === newFontFamily){
                option.selected = true;
                break;
            }
        }

        targetFontSize.value=newFontSize;
        targetFontWeight.value=newFontWeight;
        targetFontColor.value=newFontColor;
        targetFontHexColor.innerText = newFontColor;

    }

    function rgbToHex(rgb) {
        // RGB 값을 파싱하여 숫자 값으로 추출
        let rgbValues = rgb.match(/\d+/g);

        // 각각의 RGB 값들을 16진수(hex)로 변환하고 합치기
        let hexValue = "#" + rgbValues.map(function (value) {
            return ('0' + parseInt(value, 10).toString(16)).slice(-2);
        }).join('');

        return hexValue;
    }

    function handleUploadEvent(event){
        let input = event.target.closest("input");
        uploadEditorImage(input);
        // input.addEventListener("change",uploadEditorImage(id));

        // console.log("type: ",type);
        // switch (type){
        //     case "bgImage":
        //         item = document.querySelector(`.${type} input[name='editor-upload']`);
        //         if(item != null && item != undefined){
        //             item.addEventListener("change",uploadEditorImage('bgImage'))
        //         }
        //
        //         break;
        //     case "image":
        //         item = document.querySelector(`.${type} input[name='editor-upload']`);
        //         if(item != null && item != undefined){
        //             item.addEventListener("change",uploadEditorImage('image'))
        //         }
        //         break;
        // }

    }

    function styleForText(dataTypeId) {

        let styleEditor = document.querySelector(".library-wrapper div.active");
        let fontFamily = styleEditor.querySelector("#font-family");
        let fontSize = styleEditor.querySelector("#font-size");
        let fontColor = styleEditor.querySelector("#font-color");
        let fontWeight = styleEditor.querySelector("#font-weight");
        // let textWidth = styleEditor.querySelector("#text-width");
        // let textHeight = styleEditor.querySelector("#text-height");
        let textPosition = styleEditor.querySelector("#text-position");

        // let textBackgrond = styleEditor.querySelector("#background-color");
        let textBackgroundOpacity = styleEditor.querySelector("#opacity");

        fontFamily.addEventListener("change", function (event) {
            let font = event.target.value;
            let component = document.querySelector(`div.edit-style[data-type-id='${dataTypeId}']`);
            if (component != null) {
                component.style.fontFamily = font;
            }
        });

        fontSize.addEventListener("change", function (event) {
            let size = event.target.value;
            let component = document.querySelector(`div.edit-style[data-type-id='${dataTypeId}']`);
            if (component != null){
                let component = document.querySelector(`div.edit-style[data-type-id='${dataTypeId}']`);
                component.style.fontSize = size + 'px';
            }

        });

        fontColor.addEventListener("change", function (event) {
            let textColor = event.target.value;
            let hexValue = document.querySelector(".hex-value");
            let component = document.querySelector(`div.edit-style[data-type-id='${dataTypeId}']`);
            if (component != null){
                hexValue.innerText = textColor;
                component.style.color=textColor;
            }


        });

        fontWeight.addEventListener("change", function (event) {
            let weight = event.target.value;
            let component = document.querySelector(`div.edit-style[data-type-id='${dataTypeId}']`);
            if(component != null){
                component.style.fontWeight = weight;

            }

        });

    }

    function styleForTable(component) {

    }

    function styleForImages(dataTypeId) {
        let imgWidth = document.querySelector("#image-width");
        let imgHeight = document.querySelector("#image-height");
        // let imgRotate = document.querySelector('#image-rotate');

        imgWidth.addEventListener("change", function (event) {
            let value = event.target.value;
            let component = document.querySelector(`div.edit-style[data-type-id='${dataTypeId}']`);
            if (component != null){
                let cardContainer = component.querySelector(".card-container");
                cardContainer.style.width = value + 'px';
            }
        })

        imgHeight.addEventListener("change", function (event) {
            let value = event.target.value;
            let component = document.querySelector(`div.edit-style[data-type-id='${dataTypeId}']`);
            if (component != null){
                let cardContainer = component.querySelector(".card-container");
                let card = cardContainer.querySelector(".image-box")
                card.style.height = value + 'px';
            }
        })

        // imgRotate.addEventListener("change", function (event) {
        //     let value = event.target.value;
        //     if (component != null){
        //         component.style.transformOrigin = "center";
        //         component.style.transform = `rotate(${value}deg)`;
        //     }
        // });
        // if (component != null){
        //     component.style.zIndex="auto";
        // }

    }

    function styleForBackground() {

        let currentSlide = document.querySelector(".slides li.current-slide");
        let bgColor = document.querySelector("#bg-color");
        let bgWidth = document.querySelector("#bg-width");
        let bgHeight = document.querySelector("#bg-height");
        // let item = component.parentElement;
        // component.style.zIndex="0";
        let bgColorOpacity = document.querySelector("#bg-opacity");
        let hexColor;

        bgColor.addEventListener("change", function (event) {
            hexColor = event.target.value;
            let slide = document.querySelector(".slides li.current-slide");
            slide.style.backgroundColor = `${hexColor}`;
        });

        bgColorOpacity.addEventListener("input", function (event) {
            let opacity = event.target.value;
            let rgba = hexToRGBA(hexColor, opacity);
            let slide = document.querySelector(".slides li.current-slide");
            slide.style.backgroundColor = `${rgba}`;
        });

        //TODO
        // bgWidth.addEventListener("change",function(event){
        //     let value = event.target.value;
        //     component.style.width=value+'px';
        // });

        // bgHeight.addEventListener("change",function(event){
        //     let value = event.target.value;
        //     component.style.height=value+'px';
        // });
    }

    function hexToRGBA(hex, opacity) {
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);
        let a;
        if (opacity != null) {
            a = parseFloat(opacity * 0.01); // opacity
        } else {
            a = 1;
        }
        return `rgba(${r}, ${g}, ${b}, ${a})`;
    }

    function templateSwiper(){
        const swiper = new Swiper('#modal div.data', {
            slidesPerView:4.2,
            speed: 400,
            spaceBetween: 30,
            slidesOffsetBefore:30,
            slidesOffsetAfter:30,

            // Navigation arrows
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });
    }

    function selectTemplate(obj,id){
        let template = obj.parentElement;
        let templateContainer = template.parentElement;
        let templateLists = templateContainer.querySelectorAll("li");
        Array.from(templateLists).forEach(function(item){
            item.classList.remove("selected");
        });
        template.classList.add("selected");
        selectTemplateId = id;
    }

    function renderTemplate(){
        // ajax로
        $.ajax({
                url:"/manage/product/getSampleTemplate",
                type:"GET",
                data:`templateId=${selectTemplateId}`,
                beforeSend:function(xhr){
                    xhr.setRequestHeader(
                        [[${_csrf.headerName}]], [[${_csrf.token}]]
                    );
                },
                success:function(data){
                    let templateContainer = document.querySelector("#content-container");
                    templateContainer.innerHTML = '';
                    if(data.template != null){
                        hideTemplateModal();
                        templateContainer.innerHTML=data.template;
// /                    $("#content-container").html(data.template);
                    }else{
                        //
                        console.log("empty-template");
                    }
                },
                error:function(data){

                }
            })

    }

    function deSelectTemplate(){
        selectTemplateId = 0;
        let templateContainer = document.querySelector("#modal .data .template");
        let templateLists = templateContainer.querySelectorAll("li");
        Array.from(templateLists).forEach(function(item){
            item.classList.remove("selected");
        })
        hideTemplateModal();
    }

    function deleteEditorImage(item,id){
        // item=> clicked button
        $.ajax({
            url:'/manage/product/removeEditorImage',
            type:"DELETE",
            data:`file_id=${id}&template_id=${0}`,
            beforeSend:function(xhr){
                xhr.setRequestHeader(
                    [[${_csrf.headerName}]], [[${_csrf.token}]]
                )
            },
            success : function(data) {
                if (typeof data.result != "undefined" && data.result == "error") {
                    alert(data.error);

                } else {
                    $(item).parent().parent().remove();
                }
            },
            error : function(xhr, code, errorMsg) { },
            complete : function() { }

        })

    }

    function saveTemplate() {
        // 최적화 필요
        html2canvas(document.querySelector("#content-container .slides")).then(function(canvas) {
            let imageByte = canvas.toDataURL("image/png");
            imageByte = imageByte.replace("data:image/png;base64,", "");
            const templateContainer = document.querySelector('#content-container .slides');
            const form = document.getElementById('product-info-add-form');
            const postForm = new FormData(form);
            let serializedData = '';

            for (let formItem of postForm.entries()) {
                if (serializedData !== '') {
                    serializedData += '&';
                }
                serializedData += encodeURIComponent(formItem[0]) + '=' + encodeURIComponent(formItem[1]);
            }
            serializedData += `&templateHtml=${templateContainer.innerHTML}`;
            serializedData += `&imageByte=${imageByte}`;

            $.ajax({
                url : "/manage/product/addTemplate"
                , type : "POST"
                , data : serializedData
                , beforeSend: function (xhr) {
                    xhr.setRequestHeader(
                        [[${_csrf.headerName}]], [[${_csrf.token}]]
                    );
                },
                success : function(data) {
                    alert(data.message);
                },
                error : function(a, b, c) {
                    alert("error");
                }
            });
        });
    }

    function alignComponentItem(event){

        // TODO..
        let component = document.querySelector("div.edit-style");
        console.log("align-component: ",component);
        let isGroup = COMPONETS_GROUP.length > 1 ? true : false;
        let eventType = event.target.closest("li").classList[0];
        console.log("eventType: ",eventType);
        let scaleRatio = currentScale / initialScale;
        // computed style:
        // let computedStyle = getComputedStyle(component);

        switch (eventType){
            case "left":
                // 왼쪽 정렬
                if(isGroup){
                    // 다중 정렬
                    console.log("group-align");
                    Array.from(COMPONETS_GROUP).forEach(function(item){
                        item.style.removeProperty("right");
                        let computedStyle = getComputedStyle(item);

                    });


                }else{
                    // 단일 정려
                    component.style.removeProperty("right");
                    component.style.left="0px";
                }
                break;
            case "right":
                // 오른쪽 정렬
                if(isGroup){
                    // 다중 정렬
                    console.log("group-align")

                }else{
                    // 단일 정렬
                    component.style.removeProperty("left");
                    component.style.right="0";
                }

                break;
            case "top":
                // 위로 정렬
                if(isGroup){
                    // 다중 정렬
                    console.log("group-align")

                }else{
                    // 단일 정렬
                    component.style.removeProperty("bottom");
                    component.style.top="0";
                }

                break;
            case "bottom":
                // 아래로 정렬
                if(isGroup){
                    // 다중 정렬
                    console.log("group-align")

                }else{
                    // 단일 정렬
                    component.style.removeProperty("top");
                    component.style.bottom="0";
                }

                break;
            case "center":
                // 오른쪽 정렬
                if(isGroup){
                    // 다중 정렬
                    console.log("group-align")

                }else{
                    // 단일 정렬 -> slide 스케일이 변경 될경우 중앙값도 변경됨.....
                    component.style.removeProperty("top");
                    component.style.removeProperty("bottom");
                    component.style.removeProperty("left");
                    component.style.removeProperty("right");

                    // 요소 위치 재 계산
                    let currentSlide = document.querySelector("#content-container .slides li.current-slide");

                    let slideRect = currentSlide.getBoundingClientRect();
                    let itemRect = component.getBoundingClientRect();

                    let offsetX = slideRect.left + slideRect.width / 2 - (itemRect.left + itemRect.width / 2);
                    let offsetY = slideRect.top + slideRect.height / 2 - (itemRect.top + itemRect.height / 2);

                    component.style.top=`${offsetY/scaleRatio}px`;
                    component.style.left=`${offsetX/scaleRatio}px`;
                }

                break;
            case "middle":
                // 중앙 정렬
                if(isGroup){
                    // 다중 정렬
                    console.log("group-align")

                }else{
                    // 단일 정렬

                }
                break;
        }

    }

</script>

<script th:inline="javascript">
    let priceTypeSelect;
    let modifyPriceTypeSelect;
    let startDate = new Date().toISOString().split('T')[0];
    let endDate = new Date().toISOString().split('T')[0];

    const days = ['일', '월', '화', '수', '목', '금', '토'];
    let postJson = {
        basicPriceList: [],
        fixPriceList: [],
        priceSequence: '0',
        dayList: {
            0 : [], 1 : [], 2 : [], 3 : [], 4 : [], 5 : [], 6 : [],
        }
    };

    let calendar;
    const color = ["#f15454","#d5a16b","#d5d56f"
        ,"#53b453","#B2B2FF","#FFB2B2FF","#D24133FF"
        ,"#A2B7BFFF","#B2FFFFFF","#FFB2F5"]
    $(function () {
            const optionSortItem = document.querySelector('#detail-schedule-content-box-list').querySelectorAll('.detail-schedule-content-box');
            optionSortItem.forEach((item, index)=>{
                const scheduleBox = item.querySelectorAll('ul');
                for(let i = 0; i < scheduleBox.length; i++){
                    scheduleBox[i].querySelector('.detail-schedule-order-text').textContent = `일정#${Number(i + 1)}`;
                    initScheduleItemSwiper(scheduleBox[i]);
                }

                item.querySelector('.detail-schedule-content-inner-box').querySelectorAll('.detail-schedule-item-image-box').forEach((item)=>{
                    Zoom(`.${item.querySelector('img').getAttribute('class')}`);
                })
                initScheduleItemSortable(index+1);
            })

            const calendarEl = document.getElementById('calendar');
            loadCalendar(calendarEl);
            //판매유형 - 판매가격 선택시 이벤트
            document.querySelector('.price-select').addEventListener('change', function () {
                const selectValue = this.value;

                if ( selectValue === 'fix' ) {
                    document.querySelector('.calendar-box').style.display = 'none';
                    document.querySelector('.fix-price-box').style.display = 'flex';

                }
                else {
                    document.querySelector('.fix-price-box').style.display = 'none';
                    initCalendar();
                    document.querySelector('.calendar-box').style.display = 'flex';
                }
            })

            //세부일정 일정일수(14일기준)
            for (let i = 1; i <= 14; i++) {
                document.querySelector('.detail-schedule-select').insertAdjacentHTML('beforeend',
                    `<option value="${i}">${i}일</option>`)
            }
            //세부일정 선택시 이벤트
            document.querySelector('.detail-schedule-select').addEventListener('change', function () {
                const dayValue = this.value;
                if ( dayValue === 'notUse' ) {
                    document.querySelector('.detail-schedule-box').style.display = 'none';
                }
                //세부일정 사용시
                else {
                    document.querySelectorAll(`.detail-schedule-content-box`).forEach((item)=>{
                        item.style.display = 'none';
                    })
                    document.querySelector('.detail-schedule-box').style.display = 'block';
                    const dayTabBox = document.querySelector('.detail-schedule-day-tab-box');

                    //노출되어 있는 노출이 선택한 일수보다 낮을 경우
                    for (let i = 1; i <= dayValue; i++) {
                        if ( dayTabBox.children[i-1] !== undefined ) {
                            dayTabBox.children[i-1].style.display = 'block';
                        }
                        else {
                            dayTabBox.insertAdjacentHTML('beforeend',
                                `<button type="button" class="tab-btn" data-btn-order-num="${i}" style="display: block;" onclick="showContentBox(this, ${i})">${i}일차</button>`
                            );
                            document.querySelector('#detail-schedule-content-box-list').insertAdjacentHTML('beforeend',
                                `
                            <div id="detail-schedule-content-box-${i}" class="detail-schedule-content-box">
                                <div id="detail-schedule-content-item-${i}">
                                    <!--스크립트에서 추가-->
                                </div>
                                <div class="add-schedule-btn" onclick="addDetailScheduleItem(${i})">
                                    <img src="/images/icon/+-white-10x10.svg" class="add-detail-schedule-item-btn-img" alt="">
                                    <p class="add-schedule-btn-text">일정 추가</p>
                                </div>
                            </div>`);
                        }
                    }

                    //노출되어 있는 노출이 선택한 일수보다 높을 경우
                    for (let i = dayTabBox.children.length; i > dayValue; i--) {
                        dayTabBox.children[i-1].style.display = 'none';
                    }
                }
            })
            initScheduleItemSortable();
    })

    function initCalendar() {
        setTimeout(function () {
            calendar.render();
        }, 100)
    }
    
    function showContentBox(e, num) {
        //버튼 액티브 효과
        document.querySelectorAll('.tab-btn').forEach((item)=>{
            item.classList.remove('active');
        })
        e.classList.add('active');

        //일차별 버튼에 클릭에 속해있는 일정 보임
        document.querySelectorAll(`.detail-schedule-content-box`).forEach((item)=>{
            item.style.display = 'none';
        })
        document.querySelector(`#detail-schedule-content-box-${num}`).style.display = 'block';
    }

    function showScheduleAddModal(type) {
        const scheduleAddModalBox = document.querySelector('.schedule-add-modal-box');
        scheduleAddModalBox.insertAdjacentHTML('beforeend', `
        <div class="schedule-add-modal-inner-box" >
        <div class="schedule-add-modal-top" style="">
            <p class="schedule-add-modal-top-text">일정추가</p>
            <button type="button" onclick="closeScheduleAddModal()"><img src="/images/icon/x-black-17x17.svg" style="width: 17px; height: 17px;" alt=""></button>
        </div>
        <div class="schedule-add-modal-scroll-box">
            <div id="scheduleAddModalScrollInnerBox" class="schedule-add-modal-scroll-inner-box">
                <div class="schedule-add-modal-price-select-box">
                    <label style="width: 100%; height: 35px">
                        <span class="schedule-p-text">요금방식*</span>
                        <select id="priceTypeSelect" style="margin-left: 10px">
                            <option value="samePrice">단일금액</option>
                            <option value="periodSamePrice">기간 동일금액</option>
                            <option value="byDayPrice">출발요일별 차등금액</option>
                        </select>
                    </label>
                    <hr class="schedule-hr-15">
                </div>
                <div style="padding-right: 17px;">
                    <div class="start-day-box">
                        <p class="schedule-p-text">시작일*</p>
                        <div class="calendar-text" id="startDatePicker">
                        </div>
                    </div>
                    <div class="end-day-box">
                        <p class="schedule-p-text">종료일*</p>
                        <div class="calendar-text" id="endDatePicker">
                        </div>
                    </div>
                    <hr class="schedule-hr">
                    <div style="display:flex;">
                        <p class="schedule-p-text">기본가격*</p>
                        <div>
                            <div id="basicPriceOptionBox">
                            </div>
                            <div class="add-option-btn" onclick="addBasicPriceOption()">
                                <p class="add-option-btn-text">판매항목 추가</p>
                                <img src="/images/icon/+-white-10x10.svg" style="width: 15px; height: 15px;" alt="">
                            </div>

                        </div>
                    </div>
                    <hr class="schedule-hr">
                    <div id="byDayPriceOption" class="by-day-price-option-box">
                        <div class="by-day-price-option-item-box">
                            <label class="schedule-option-item-label">
                                <input role="switch" type="checkbox" class="day-checkbox">
                                <span class="schedule-p-text" style="margin-right: 21px;">월요일 출발</span>
                            </label>
                            <div data-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
                                <!--스크립트에서 처리-->
                            </div>
                        </div>
                        <div class="by-day-price-option-item-box">
                            <label class="schedule-option-item-label">
                                <input role="switch" type="checkbox" class="day-checkbox">
                                <span class="schedule-p-text" style="margin-right: 21px;">화요일 출발</span>
                            </label>
                            <div data-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
                                <!--스크립트에서 처리-->
                            </div>
                        </div>
                        <div class="by-day-price-option-item-box">
                            <label class="schedule-option-item-label">
                                <input role="switch" type="checkbox" class="day-checkbox">
                                <span class="schedule-p-text" style="margin-right: 21px;">수요일 출발</span>
                            </label>
                            <div data-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
                                <!--스크립트에서 처리-->
                            </div>
                        </div>
                        <div class="by-day-price-option-item-box">
                            <label class="schedule-option-item-label">
                                <input role="switch" type="checkbox" class="day-checkbox">
                                <span class="schedule-p-text" style="margin-right: 21px;">목요일 출발</span>
                            </label>
                            <div data-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
                                <!--스크립트에서 처리-->
                            </div>
                        </div>
                        <div class="by-day-price-option-item-box">
                            <label class="schedule-option-item-label">
                                <input role="switch" type="checkbox" class="day-checkbox">
                                <span class="schedule-p-text" style="margin-right: 21px;">금요일 출발</span>
                            </label>
                            <div data-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
                                <!--스크립트에서 처리-->
                            </div>
                        </div>
                        <div class="by-day-price-option-item-box">
                            <label class="schedule-option-item-label">
                                <input role="switch" type="checkbox" class="day-checkbox">
                                <span class="schedule-p-text" style="margin-right: 21px;">토요일 출발</span>
                            </label>
                            <div data-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
                                <!--스크립트에서 처리-->
                            </div>
                        </div>
                        <div class="by-day-price-option-item-box">
                            <label class="schedule-option-item-label">
                                <input role="switch" type="checkbox" class="day-checkbox">
                                <span class="schedule-p-text" style="margin-right: 21px;">일요일 출발</span>
                            </label>
                            <div data-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
                                <!--스크립트에서 처리-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="display: flex; justify-content: center; margin-top: 15px;">
            <button type="button" style="width: 75px; height: 35px; margin-right: 10px; font: 600 14px Pretendard; border-radius: 5px; color: #FFFFFF; background-color: #0062D4" onclick="addSchedule()">저장</button>
            <button type="button" style="width: 75px; height: 35px; font: 600 14px Pretendard; border-radius: 5px; color: #FFFFFF; background-color: #383838" onclick="closeScheduleAddModal()">취소</button>
        </div>
    </div>
        `)

        loadPriceOption();
        priceTypeSelect = document.getElementById('priceTypeSelect');
        if (priceTypeSelect.value === 'samePrice') {
            document.getElementById('byDayPriceOption').style.display = 'none';
            scheduleAddModalBox.querySelector('.end-day-box').style.display = 'none';
            postJson.priceSetType = "samePrice";
        }
        priceTypeSelect.addEventListener('change', function() {
            const selectedValue = this.value;

            if (selectedValue === 'samePrice') {
                document.getElementById('byDayPriceOption').style.display = 'none';
                scheduleAddModalBox.querySelector('.end-day-box').style.display = 'none';
                endDate = startDate;
                postJson.endDate = startDate;
                postJson.priceSetType = "samePrice";
            }
            else if (selectedValue === 'byDayPrice') {
                document.getElementById('byDayPriceOption').style.display = 'block';
                scheduleAddModalBox.querySelector('.end-day-box').style.display = 'flex';
                endDate = startDate;
                endDate = scheduleAddModalBox.querySelector('#endDatePicker').textContent.trim().replaceAll(". ", "-");
                postJson.priceSetType = "byDayPrice";
            }
            else if (selectedValue === 'periodSamePrice') {
                document.getElementById('byDayPriceOption').style.display = 'none';
                scheduleAddModalBox.querySelector('.end-day-box').style.display = 'flex';
                endDate = startDate;
                endDate = scheduleAddModalBox.querySelector('#endDatePicker').textContent.trim().replaceAll(". ", "-");
                postJson.priceSetType = "periodSamePrice";
            }
        });

        scheduleAddModalBox.style.display = "flex";

        initStartDatePicker();
        initEndDatePicker();

        const checkboxes = document.querySelectorAll(".day-checkbox");
        checkboxes.forEach((checkbox) => {
            checkbox.addEventListener('change', checkDayCheckBox);
        });

        //요금방식 disable용
        if ( type === 'samePrice' ) {
            priceTypeSelect.disabled = true;
            priceTypeSelect.style.backgroundColor = '#D9D9D9';
            priceTypeSelect.style.color = '#666666';
        }

    }

    let priceSequenceValue = 0;
    let addedPriceSetList;
    let loadedEndDate;
    function showScheduleModifyModal(priceSequence) {
        $.ajax({
            url : "/manage/product/load-modify-price-option"
            , type : "GET"
            , data : { "priceSequence" : priceSequence }
            , beforeSend: function (xhr) {
                xhr.setRequestHeader(
                    [[${_csrf.headerName}]], [[${_csrf.token}]]
                );
            },
            success : function(data) {
                startDate = data.startDate.priceSetDate;
                endDate = data.endDate.priceSetDate;
                loadedEndDate = data.endDate.priceSetDate;
                postJson.priceSequence = priceSequence;
                priceSequenceValue = priceSequence;
                addedPriceSetList = data.addedPriceSetList;
                //본문세팅
                const scheduleModifyModalBox = document.querySelector('.schedule-modify-modal-box');
                scheduleModifyModalBox.insertAdjacentHTML('beforeend', `
                                                            <div class="schedule-add-modal-inner-box" >
                                                                <div class="schedule-add-modal-top" style="">
                                                                    <p class="schedule-add-modal-top-text">일정수정</p>
                                                                    <button type="button" onclick="closeScheduleModifyModal()"><img src="/images/icon/x-black-17x17.svg" style="width: 17px; height: 17px;" alt=""></button>
                                                                </div>
                                                                <div class="schedule-add-modal-scroll-box">
                                                                <div id="modifyScheduleAddModalScrollInnerBox" class="schedule-add-modal-scroll-inner-box">
                                                                    <div class="schedule-add-modal-price-select-box">
                                                                        <label style="width: 100%; height: 35px">
                                                                            <span class="schedule-p-text">요금방식*</span>
                                                                            <select id="modifyPriceTypeSelect" style="margin-left: 10px">
                                                                                <option value="samePrice">단일금액</option>
                                                                                <option value="periodSamePrice">기간 동일금액</option>
                                                                                <option value="byDayPrice">출발요일별 차등금액</option>
                                                                            </select>
                                                                        </label>
                                                                        <hr class="schedule-hr-15">
                                                                    </div>
                                                                    <div style="padding-right: 17px;">
                                                                        <div class="start-day-box">
                                                                            <p class="schedule-p-text">시작일*</p>
                                                                            <div class="calendar-text" id="startDatePicker">
                                                                            </div>
                                                                        </div>
                                                                        <div class="end-day-box">
                                                                            <p class="schedule-p-text">종료일*</p>
                                                                            <div class="calendar-text" id="endDatePicker">
                                                                            </div>
                                                                        </div>
                                                                        <hr class="schedule-hr">
                                                                        <div style="display:flex;">
                                                                            <p class="schedule-p-text">기본가격*</p>
                                                                            <div>
                                                                                <div id="modifyBasicPriceOptionBox">
                                                                                    <!--스크립트에서 처리-->
                                                                                </div>
                                                                                <div class="add-option-btn" onclick="addModifyBasicPriceOption()">
                                                                                    <p class="add-option-btn-text">판매항목 추가</p>
                                                                                    <img src="/images/icon/+-white-10x10.svg" style="width: 15px; height: 15px;" alt="">
                                                                                </div>

                                                                            </div>
                                                                        </div>
                                                                        <hr class="schedule-hr">
                                                                        <div id="modifyByDayPriceOption" class="by-day-price-option-box">
                                                                            <div class="by-day-price-option-item-box">
                                                                                <label class="schedule-option-item-label">
                                                                                    <input role="switch" type="checkbox" class="modify-day-checkbox">
                                                                                    <span class="schedule-p-text" style="margin-right: 21px;">월요일 출발</span>
                                                                                </label>
                                                                                <div data-modify-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
                                                                                    <!--스크립트에서 처리-->
                                                                                </div>
                                                                            </div>
                                                                            <div class="by-day-price-option-item-box">
                                                                                <label class="schedule-option-item-label">
                                                                                    <input role="switch" type="checkbox" class="modify-day-checkbox">
                                                                                    <span class="schedule-p-text" style="margin-right: 21px;">화요일 출발</span>
                                                                                </label>
                                                                                <div data-modify-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
                                                                                    <!--스크립트에서 처리-->
                                                                                </div>
                                                                            </div>
                                                                            <div class="by-day-price-option-item-box">
                                                                                <label class="schedule-option-item-label">
                                                                                    <input role="switch" type="checkbox" class="modify-day-checkbox">
                                                                                    <span class="schedule-p-text" style="margin-right: 21px;">수요일 출발</span>
                                                                                </label>
                                                                                <div data-modify-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
                                                                                    <!--스크립트에서 처리-->
                                                                                </div>
                                                                            </div>
                                                                            <div class="by-day-price-option-item-box">
                                                                                <label class="schedule-option-item-label">
                                                                                    <input role="switch" type="checkbox" class="modify-day-checkbox">
                                                                                    <span class="schedule-p-text" style="margin-right: 21px;">목요일 출발</span>
                                                                                </label>
                                                                                <div data-modify-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
                                                                                    <!--스크립트에서 처리-->
                                                                                </div>
                                                                            </div>
                                                                            <div class="by-day-price-option-item-box">
                                                                                <label class="schedule-option-item-label">
                                                                                    <input role="switch" type="checkbox" class="modify-day-checkbox">
                                                                                    <span class="schedule-p-text" style="margin-right: 21px;">금요일 출발</span>
                                                                                </label>
                                                                                <div data-modify-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
                                                                                    <!--스크립트에서 처리-->
                                                                                </div>
                                                                            </div>
                                                                            <div class="by-day-price-option-item-box">
                                                                                <label class="schedule-option-item-label">
                                                                                    <input role="switch" type="checkbox" class="modify-day-checkbox">
                                                                                    <span class="schedule-p-text" style="margin-right: 21px;">토요일 출발</span>
                                                                                </label>
                                                                                <div data-modify-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
                                                                                    <!--스크립트에서 처리-->
                                                                                </div>
                                                                            </div>
                                                                            <div class="by-day-price-option-item-box">
                                                                                <label class="schedule-option-item-label">
                                                                                    <input role="switch" type="checkbox" class="modify-day-checkbox">
                                                                                    <span class="schedule-p-text" style="margin-right: 21px;">일요일 출발</span>
                                                                                </label>
                                                                                <div data-modify-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
                                                                                    <!--스크립트에서 처리-->
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div id="dayModifyItemBox" style="display: none">

                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="product-add-btn-group">
                                                                <button type="button" class="product-modify-btn" onclick="modifySchedule()">수정</button>
                                                                <button type="button" class="product-delete-btn" onclick="deleteSchedule(priceSequenceValue)">삭제</button>
                                                                <button type="button" class="product-close-btn" onclick="closeScheduleModifyModal()">취소</button>
                                                            </div>
                                                            </div>
                                                            `)

                //본문세팅이 완료되면 select 박스 이벤트 처리
                let selectType = data.startDate.priceSetType;
                modifyPriceTypeSelect = document.getElementById('modifyPriceTypeSelect');

                for ( const i of data.addedPriceSetList ) {
                    if ( i.priceSetType === 'byDayPrice' ) {
                        selectType = "byDayPrice";
                        document.getElementById('modifyByDayPriceOption').style.display = 'block';
                        break;
                    }
                }

                modifyPriceTypeSelect.value = selectType;
                if (selectType === 'samePrice') {
                    document.getElementById('modifyByDayPriceOption').style.display = 'none';
                    scheduleModifyModalBox.querySelector('.end-day-box').style.display = 'none';
                    postJson.priceSetType = "samePrice";
                }

                modifyPriceTypeSelect.addEventListener('change', function() {
                    const selectedValue = this.value;

                    if (selectedValue === 'samePrice') {
                        document.getElementById('modifyByDayPriceOption').style.display = 'none';
                        scheduleModifyModalBox.querySelector('.end-day-box').style.display = 'none';
                        endDate = startDate;
                        postJson.endDate = startDate;
                        postJson.priceSetType = "samePrice";
                    }
                    else if (selectedValue === 'byDayPrice') {
                        document.getElementById('modifyByDayPriceOption').style.display = 'block';
                        scheduleModifyModalBox.querySelector('.end-day-box').style.display = 'flex';
                        endDate = startDate;
                        endDate = scheduleModifyModalBox.querySelector('#endDatePicker').textContent.trim().replaceAll(". ", "-");
                        postJson.priceSetType = "byDayPrice";
                    }
                    else if (selectedValue === 'periodSamePrice') {
                        document.getElementById('modifyByDayPriceOption').style.display = 'none';
                        scheduleModifyModalBox.querySelector('.end-day-box').style.display = 'flex';
                        endDate = startDate;
                        endDate = scheduleModifyModalBox.querySelector('#endDatePicker').textContent.trim().replaceAll(". ", "-");
                        postJson.priceSetType = "periodSamePrice";
                    }
                });

                scheduleModifyModalBox.style.display = "flex";

                const checkboxes = document.querySelectorAll(".modify-day-checkbox");
                checkboxes.forEach((checkbox) => {
                    checkbox.addEventListener('change', modifyCheckDayCheckBox);
                });

                //datepicker 처리
                initStartDatePicker();
                initEndDatePicker();

                //본문세팅이 완료되면 각종 데이터 처리
                let optionName = "";
                let maxQuantity = "";
                let priceOptionId = "";
                let productPrice = "";
                let priceId = "";

                const modifyBasicPriceOptionBox = document.getElementById("modifyBasicPriceOptionBox");
                basicPriceOptionLength = data.addedBasicPriceList.length;

                for (let i = 0; i < basicPriceOptionLength; i++) {
                    optionName = data.addedBasicPriceList[i].optionName;
                    maxQuantity = data.addedBasicPriceList[i].maxQuantity;
                    priceOptionId = data.addedBasicPriceList[i].priceOptionId;
                    productPrice = data.addedBasicPriceList[i].productPrice;
                    priceId = data.addedBasicPriceList[i].priceId;
                    //기본가격 칸에 세팅
                    modifyBasicPriceOptionBox.insertAdjacentHTML("beforeend", `<div style="display:flex;" data-price-option-id="${priceOptionId}">
                                                                            <div class="price-option-title">
                                                                                <input data-modify-basic-option-type="name" type="text" class="schedule-p-text" style="width: 100%;" value="${optionName}" placeholder="항목을 입력해주세요." />
                                                                                <input data-modify-basic-option-type="price" type="text" onkeyup="checkInputNumValidation(event)" class="schedule-price-text" value="${insertSpecialCharReverse(productPrice, 3, ',')}" placeholder="가격을 입력해주세요." />
                                                                            </div>
                                                                            <div class="price-option-quantity">
                                                                                <p class="schedule-p-text">최대수량</p>
                                                                                <input data-modify-basic-option-type="maxQuantity" type="text" onkeyup="checkInputNumValidation(event)" class="schedule-price-text" value="${maxQuantity}" placeholder="수량입력"/>
                                                                            </div>
                                                                            <div class="option-btx-box">
                                                                                <button type="button" class="delete-option-btn" onclick="deleteModifyBasicPriceOption(this)">
                                                                                    <img src="/images/icon/x-black-box-15x15.svg" style="width: 15px; height: 15px;" alt="">
                                                                                </button>
                                                                            </div>
                                                                            <input type="hidden" data-modify-basic-option-type="priceOptionId" value="${priceOptionId}">
                                                                            <input type="hidden" data-modify-basic-option-type="priceId" value="${priceId}">
                                                                        </div>`)

                }

                const byDayPriceOptionItemBoxDiv = document.querySelectorAll('[data-modify-div-name="by-day-price-option-item-box-div"]');
                for (let i = 0; i < 7; i++) { //일주일
                    for (let l = 0; l < basicPriceOptionLength; l++) {
                        optionName = data.addedBasicPriceList[l].optionName;
                        maxQuantity = data.addedBasicPriceList[l].maxQuantity;
                        priceOptionId = data.addedBasicPriceList[l].priceOptionId;
                        productPrice = data.addedBasicPriceList[l].productPrice;
                        priceId = data.addedBasicPriceList[l].priceId;

                        byDayPriceOptionItemBoxDiv[i]
                            .insertAdjacentHTML("beforeend", `<div data-box-name="option-item">
                                                                <div class="schedule-option-item-box">
                                                                    <div class="price-basic-option-title">
                                                                        <p class="schedule-p-text" data-modify-option-type="name" style="width: 100%;" readonly>${optionName}</p>
                                                                        <input type="text" class="schedule-price-text" data-modify-option-type="price" onkeyup="checkInputNumValidation(event)" value="${insertSpecialCharReverse(productPrice, 3, ',')}" placeholder="가격을 입력해주세요.">
                                                                    </div>
                                                                </div>
                                                                <div style="display: none">
                                                                    <p class="schedule-p-text">최대수량</p>
                                                                    <input type="text" class="schedule-price-text" data-modify-option-type="maxQuantity" onkeyup="checkInputNumValidation(event)" value="${maxQuantity}" />
                                                                </div>
                                                                <input type="hidden" data-modify-option-type="priceOptionId" value="${priceOptionId}">
                                                              </div>`)

                    }
                }

                //이미 추가되어 있는 기본가격 삭제용
                for (let i = 0; i < data.addedPriceSetList.length; i++) {
                    if ( data.addedPriceSetList[i].priceSetType === "byDayPrice" ) {
                        const dateString = data.addedPriceSetList[i].priceSetDate
                        // 입력받은 날짜를 Date 객체로 변환
                        const dateObject = new Date(`${dateString.replace(/-/g, '/')}`);
                        //  입력받은 날짜의 요일을 가져옵니다. (0: 월요일, 1: 화요일, ..., 6: 일요일)
                        const dayOfWeek = dateObject.getDay();
                        const weekDayNumber = (dayOfWeek + 6) % 7;
                        const mdc = document.querySelectorAll('.modify-day-checkbox');
                        mdc[weekDayNumber].checked = true;
                        document.querySelectorAll('[data-modify-div-name="by-day-price-option-item-box-div"]')[weekDayNumber].style.display = 'block';
                        byDayPriceOptionItemBoxDiv[weekDayNumber].innerHTML = "";

                    }
                }
                //삭제한 자리에 요일별 가격 세팅
                for (let i = 0; i < data.addedPriceSetList.length; i++) {
                    if ( data.addedPriceSetList[i].priceSetType === "byDayPrice" ) {
                        const dateString = data.addedPriceSetList[i].priceSetDate
                        // 입력받은 날짜를 Date 객체로 변환
                        const dateObject = new Date(`${dateString.replace(/-/g, '/')}`);
                        //  입력받은 날짜의 요일을 가져옵니다. (0: 월요일, 1: 화요일, ..., 6: 일요일)
                        const dayOfWeek = dateObject.getDay();
                        const weekDayNumber = (dayOfWeek + 6) % 7;

                        let addPossibleFlag = true;
                        byDayPriceOptionItemBoxDiv[weekDayNumber].querySelectorAll('[data-box-name="option-item"]').forEach((item)=>{
                            if ( data.addedPriceSetList[i].priceOptionId == item.querySelector('[data-modify-option-type="priceOptionId"]').value ) {
                                addPossibleFlag = false;
                            }
                            else if ( data.addedPriceSetList[i].priceOptionId == item.querySelector('[data-modify-option-type="price"]').value ) {
                                addPossibleFlag = false;
                            }
                            else if ( data.addedPriceSetList[i].priceOptionId == item.querySelector('[data-modify-option-type="name"]').value ) {
                                addPossibleFlag = false;
                            }

                        })
                        if ( addPossibleFlag ) {
                            byDayPriceOptionItemBoxDiv[weekDayNumber]
                                .insertAdjacentHTML('beforeend', `<div data-box-name="option-item" >
                                                                    <div class="schedule-option-item-box">
                                                                        <div class="price-basic-option-title">
                                                                            <p class="schedule-p-text" data-modify-option-type="name" style="width: 100%;" readonly>${data.addedPriceSetList[i].optionName}</p>
                                                                            <input type="text" class="schedule-price-text" data-modify-option-type="price" onkeyup="checkInputNumValidation(event)" value="${insertSpecialCharReverse(data.addedPriceSetList[i].priceNormal, 3, ',')}" placeholder="가격을 입력해주세요.">
                                                                        </div>
                                                                    </div>
                                                                    <div style="display: none">
                                                                        <p class="schedule-p-text">최대수량</p>
                                                                        <input type="text" class="schedule-price-text" data-modify-option-type="maxQuantity" onkeyup="checkInputNumValidation(event)" value="${data.addedPriceSetList[i].maxQuantity}" />
                                                                    </div>
                                                                    <input type="hidden" data-modify-option-type="priceOptionId" value="${data.addedPriceSetList[i].priceOptionId}">
                                                                    <input type="hidden" data-modify-option-type="priceId" value="${data.addedPriceSetList[i].priceId}">
                                                                    <input type="hidden" data-modify-option-type="priceSetDate" value="${data.addedPriceSetList[i].priceSetDate}">
                                                                    <input type="hidden" data-modify-option-type="priceSequence" value="${data.addedPriceSetList[i].priceSequence}">
                                                                  </div>`)
                        }


                    }
                }
                syncModifyDailyOptionInfoWithBasicOptionInfo();

            }
        })
        startDate = new Date().toISOString().split('T')[0]
        endDate = new Date().toISOString().split('T')[0]
    }

    function initStartDatePicker() {
        $("#startDatePicker").daterangepicker({
            singleDatePicker:true,
            "minDate": moment(),
            "maxDate": moment().add(4, 'month'),
            startDate: new Date().toISOString().split('T')[0],
            locale: {
                format: 'YYYY.MM.DD',
                applyLabel: "적용",
                cancelLabel: "취소",
                daysOfWeek: ["일", "월", "화", "수", "목", "금", "토"],
                monthNames: ["1월", "2월", "3월", "4월", "5월", "6월", "7월", "8월", "9월", "10월", "11월", "12월"]
            }
        }, function(start, end, label) {

        });
        $('#startDatePicker').on('apply.daterangepicker', function(ev, picker) {
            const privateStartDate = picker.startDate.format('YYYY-MM-DD');
            $(this).text(privateStartDate.replaceAll('-', '. '));
            $(this).append(`<img src="/images/icon/calendar.svg" style="position:absolute; width: 15px; height: 17px; right: 9px;" alt="">`);
            startDate = privateStartDate;
            postJson.startDate = privateStartDate;

        });
        $("#startDatePicker").text(startDate.replaceAll('-', '. '));
        $("#startDatePicker").append(`<img src="/images/icon/calendar.svg" style="position:absolute; width: 15px; height: 17px; right: 9px;" alt="">`);
        postJson.startDate = startDate;
    }

    function initEndDatePicker() {
        $("#endDatePicker").daterangepicker({
            singleDatePicker:true,
            "minDate": moment(),
            "maxDate": moment().add(4, 'month'),
            startDate: new Date().toISOString().split('T')[0],
            locale: {
                format: 'YYYY.MM.DD',
                applyLabel: "적용",
                cancelLabel: "취소",
                daysOfWeek: ["일", "월", "화", "수", "목", "금", "토"],
                monthNames: ["1월", "2월", "3월", "4월", "5월", "6월", "7월", "8월", "9월", "10월", "11월", "12월"]
            },
        });
        $("#endDatePicker").on('apply.daterangepicker', function(ev, picker) {
            const privateEndDate = picker.startDate.format('YYYY-MM-DD');
            $(this).text(privateEndDate.replaceAll('-', '. '));
            $(this).append(`<img src="/images/icon/calendar.svg" style="position:absolute; width: 15px; height: 17px; right: 9px;" alt="">`);
            endDate = privateEndDate;
            postJson.endDate = privateEndDate;
        });
        $("#endDatePicker").text(endDate.replaceAll('-', '. '));
        $("#endDatePicker").append(`<img src="/images/icon/calendar.svg" style="position:absolute; width: 15px; height: 17px; right: 9px;" alt="">`);
        postJson.endDate = endDate;
    }

    $.widget.bridge('uibutton', $.ui.button)

    let basicPriceOptionLength = 0;
    //기본가격정보 로드
    function loadPriceOption() {
        $.ajax({
            url : "/manage/product/load-price-option"
            , type : "GET"
            , data : { "option_type" : 'package' }
            , beforeSend: function (xhr) {
                xhr.setRequestHeader(
                    [[${_csrf.headerName}]], [[${_csrf.token}]]
                );
            },
            success : function(data) {
                let optionName = "";
                let maxQuantity = "";
                const basicPriceOptionBox = document.getElementById("basicPriceOptionBox");
                basicPriceOptionLength = data.basicPriceOptionList.length;

                for (let i = 0; i < basicPriceOptionLength; i++) {
                    optionName = data.basicPriceOptionList[i].optionName;
                    maxQuantity = data.basicPriceOptionList[i].maxQuantity;
                    //기본가격 칸에 세팅
                    basicPriceOptionBox.insertAdjacentHTML("beforeend", `<div style="display:flex;">
                                                                            <div class="price-option-title">
                                                                                <input data-basic-option-type="name" type="text" class="schedule-p-text" style="width: 100%;" value="${optionName}" placeholder="항목을 입력해주세요." />
                                                                                <input data-basic-option-type="price" type="text" onkeyup="checkInputNumValidation(event)" class="schedule-price-text" value="" placeholder="가격을 입력해주세요." />
                                                                            </div>
                                                                            <div class="price-option-quantity">
                                                                                <p class="schedule-p-text">최대수량</p>
                                                                                <input data-basic-option-type="maxQuantity" type="text" onkeyup="checkInputNumValidation(event)" class="schedule-price-text" value="${maxQuantity}" placeholder="수량입력"/>
                                                                            </div>
                                                                            <div class="option-btx-box">
                                                                                <button type="button" class="delete-option-btn" onclick="deleteBasicPriceOption(this)">
                                                                                    <img src="/images/icon/x-black-box-15x15.svg" style="width: 15px; height: 15px;" alt="">
                                                                                </button>
                                                                            </div>
                                                                        </div>`)
                    //요일별 칸에 세팅
                    const byDayPriceOptionItemBoxDiv = document.querySelectorAll('[data-div-name="by-day-price-option-item-box-div"]');
                    for (let q = 0; q < byDayPriceOptionItemBoxDiv.length; q++) {
                        byDayPriceOptionItemBoxDiv[q].insertAdjacentHTML('beforeend', `<div data-box-name="option-item">
                                                                                        <div class="schedule-option-item-box">
                                                                                            <div class="price-basic-option-title">
                                                                                                <p class="schedule-p-text" data-option-type="name" style="width: 100%;" readonly>${optionName}</p>
                                                                                                <input type="text" class="schedule-price-text" data-option-type="price" onkeyup="checkInputNumValidation(event)" value="" placeholder="가격을 입력해주세요.">
                                                                                            </div>
                                                                                        </div>
                                                                                        <div style="display: none">
                                                                                            <p class="schedule-p-text">최대수량</p>
                                                                                            <input type="text" class="schedule-price-text" data-option-type="maxQuantity" onkeyup="checkInputNumValidation(event)" value="${maxQuantity}" placeholder="수량입력"/>
                                                                                        </div>
                                                                                     </div>`)
                    }
                }

                syncDailyOptionInfoWithBasicOptionInfo(basicPriceOptionLength, 'byDayPriceOption');
            }
        })
    }

    //기본가격 수정시 체크되지 않은 요일들이 기본가격의 값과 동기화 되도록 함
    function syncDailyOptionInfoWithBasicOptionInfo(dataLength, optionType) {
        for (let i = 0; i < dataLength; i++) {
            const priceOptionNameElement = document.querySelectorAll('[data-basic-option-type="name"]');
            priceOptionNameElement[i].addEventListener('input', () => {
                const byDayPriceOptionChildren = document.getElementById(`${optionType}`).children;
                let vv = 6; //postJson에 들어가는 날짜가 일요일부터 시작되도록
                for (let z = 0; z < byDayPriceOptionChildren.length; z++) { //월~일 length: 7
                    const childNode = byDayPriceOptionChildren[vv];
                    vv++;
                    if ( vv >= 7 ) { vv = 0 }

                    const nameElements = childNode.querySelectorAll('[data-option-type="name"]');
                    nameElements[i].textContent = priceOptionNameElement[i].value;

                }
            });

            const priceOptionPriceElement = document.querySelectorAll('[data-basic-option-type="price"]');
            priceOptionPriceElement[i].addEventListener('input', () => {
                const byDayPriceOptionChildren = document.getElementById(`${optionType}`).children;
                let vv = 6; //postJson에 들어가는 날짜가 일요일부터 시작되도록
                for (let z = 0; z < byDayPriceOptionChildren.length; z++) { //월~일 length: 7
                    const childNode = byDayPriceOptionChildren[vv];
                    vv++;
                    if ( vv >= 7 ) { vv = 0 }

                    //요일별 html의 자식 input 개수들
                    const inputs = childNode.getElementsByTagName('input');
                    for (let j = 0; j < inputs.length; j++) {
                        const input = inputs[j];
                        if (input.type === 'checkbox') {
                            //기본가격으로 사용될 요일체크
                            if (!input.checked) {

                                const priceElements = childNode.querySelectorAll('[data-option-type="price"]');
                                if ( priceElements[i] !== undefined ) {
                                    priceElements[i].value = priceOptionPriceElement[i].value;
                                }
                            }
                        }
                    }
                }
            });

            const priceOptionMaxQuantityElement = document.querySelectorAll('[data-basic-option-type="maxQuantity"]');
            priceOptionMaxQuantityElement[i].addEventListener('input', () => {
                const byDayPriceOptionChildren = document.getElementById(`${optionType}`).children;
                let vv = 6; //postJson에 들어가는 날짜가 일요일부터 시작되도록
                for (let z = 0; z < byDayPriceOptionChildren.length; z++) { //월~일 length: 7
                    const childNode = byDayPriceOptionChildren[vv];
                    vv++;
                    if ( vv >= 7 ) { vv = 0 }

                    //요일별 html의 자식 input 개수들
                    const inputs = childNode.getElementsByTagName('input');
                    for (let j = 0; j < inputs.length; j++) {
                        const input = inputs[j];
                        if (input.type === 'checkbox') {
                            //사용처리 될 요일체크
                            const maxQuantityElements = childNode.querySelectorAll('[data-option-type="maxQuantity"]');
                            if ( maxQuantityElements.length > 0 ) {
                                maxQuantityElements[i].value = priceOptionMaxQuantityElement[i].value;
                            }
                        }
                    }
                }
            });
        }
    }

    //수정용 - 기본가격 수정시 체크되지 않은 요일들이 기본가격의 값과 동기화 되도록 함
    function syncModifyDailyOptionInfoWithBasicOptionInfo() {
        const priceOptionElement = document.querySelector('#modifyBasicPriceOptionBox').children;
        for (let i = 0; i < priceOptionElement.length; i++) {
            const priceOptionId = priceOptionElement[i].querySelector('[data-modify-basic-option-type="priceOptionId"]').value;
            priceOptionElement[i].querySelector('[data-modify-basic-option-type="name"]').addEventListener('input', () => {
                const byDayPriceOptionChildren = document.getElementById('modifyByDayPriceOption').children;
                for (let z = 0; z < byDayPriceOptionChildren.length; z++) { //월~일 length: 7
                    const childNode = byDayPriceOptionChildren[z];

                    const nameElements = childNode.querySelectorAll('[data-box-name="option-item"]');
                    nameElements.forEach((item) => {
                        const nameElementItem = item.querySelector('[data-modify-option-type="priceOptionId"]');
                        if ( priceOptionElement[i] !== undefined && nameElementItem.value === priceOptionId ) {
                            item.querySelector('[data-modify-option-type="name"]').textContent = priceOptionElement[i].querySelector('[data-modify-basic-option-type="name"]').value
                        }
                    })
                }
            });

            priceOptionElement[i].querySelector('[data-modify-basic-option-type="price"]').addEventListener('input', () => {
                const byDayPriceOptionChildren = document.getElementById('modifyByDayPriceOption').children;
                let vv = 6; //postJson에 들어가는 날짜가 일요일부터 시작되도록
                for (let z = 0; z < byDayPriceOptionChildren.length; z++) { //월~일 length: 7
                    const childNode = byDayPriceOptionChildren[vv];
                    vv++;
                    if ( vv >= 7 ) { vv = 0 }

                    const priceElements = childNode.querySelectorAll('[data-modify-div-name="by-day-price-option-item-box-div"]');
                    priceElements.forEach((item) => {
                        if ( item.style.display === "none" || item.style.display === "" ) {
                            for (let c = 0; c < item.children.length; c++) {
                                const value = item.children[c];
                                const priceElementItem = value.querySelector('[data-modify-option-type="priceOptionId"]');
                                if ( priceOptionElement[i] !== undefined && priceElementItem.value === priceOptionId ) {
                                    value.querySelector('[data-modify-option-type="price"]').value = priceOptionElement[i].querySelector('[data-modify-basic-option-type="price"]').value
                                }
                            }
                        }
                    })
                }
            });
            const priceOptionMaxQuantityElement = document.querySelectorAll('[data-modify-basic-option-type="maxQuantity"]');
            priceOptionMaxQuantityElement[i].addEventListener('input', () => {
                const byDayPriceOptionChildren = document.getElementById('modifyByDayPriceOption').children;
                let vv = 6; //postJson에 들어가는 날짜가 일요일부터 시작되도록
                for (let z = 0; z < byDayPriceOptionChildren.length; z++) { //월~일 length: 7
                    const childNode = byDayPriceOptionChildren[vv];
                    vv++;
                    if ( vv >= 7 ) { vv = 0 }
                    //요일별 html의 자식 input 개수들
                    const inputs = childNode.getElementsByTagName('input');
                    for (let j = 0; j < inputs.length; j++) {
                        const input = inputs[j];
                        if (input.type === 'checkbox') {
                            //사용처리 될 요일체크
                            const maxQuantityElements = childNode.querySelectorAll('[data-modify-option-type="maxQuantity"]');
                            if ( maxQuantityElements.length > 0 && modifyPriceTypeSelect.value !== "samePrice" ) {
                                maxQuantityElements[i].value = priceOptionMaxQuantityElement[i].value;
                            }
                        }
                    }
                }
            });
        }
    }

    //판매항목 추가
    function addBasicPriceOption() {
        const basicPriceOptionBox = document.getElementById("basicPriceOptionBox");
        basicPriceOptionBox.insertAdjacentHTML('beforeend', `<div style="display:flex;">
                                                                <div class="price-option-title">
                                                                    <input data-basic-option-type="name" type="text" class="schedule-p-text" style="width: 100%;" value="" placeholder="항목을 입력해주세요." />
                                                                    <input data-basic-option-type="price" type="text" onkeyup="checkInputNumValidation(event)" class="schedule-price-text" value="" placeholder="가격을 입력해주세요." />
                                                                </div>
                                                                <div class="price-option-quantity">
                                                                    <p class="schedule-p-text">최대수량</p>
                                                                    <input data-basic-option-type="maxQuantity" type="text" onkeyup="checkInputNumValidation(event)" class="schedule-price-text" value="0" placeholder="수량입력"/>
                                                                </div>
                                                                <div class="option-btx-box">
                                                                    <button type="button" class="delete-option-btn" onclick="deleteBasicPriceOption(this)">
                                                                        <img src="/images/icon/x-black-box-15x15.svg" style="width: 15px; height: 15px;" alt="">
                                                                    </button>
                                                                </div>
                                                             </div>`)
        //요일별 칸에 세팅
        const byDayPriceOptionItemBoxDiv = document.querySelectorAll('[data-div-name="by-day-price-option-item-box-div"]');
        for (let q = 0; q < byDayPriceOptionItemBoxDiv.length; q++) {
            byDayPriceOptionItemBoxDiv[q].insertAdjacentHTML("beforeend", `<div <div data-box-name="option-item" data-added-type="new">
                                                                            <div class="schedule-option-item-box">
                                                                                <div class="price-basic-option-title">
                                                                                    <p type="text" class="schedule-p-text" data-option-type="name" style="width: 100%;"></p>
                                                                                    <input type="text" class="schedule-price-text" data-option-type="price" onkeyup="checkInputNumValidation(event)" value="" placeholder="가격을 입력해주세요.">
                                                                                </div>
                                                                            </div>
                                                                            <div style="display: none">
                                                                                <p class="schedule-p-text">최대수량</p>
                                                                                <input type="text" class="schedule-price-text" data-option-type="maxQuantity" onkeyup="checkInputNumValidation(event)" value="0" placeholder="수량입력"/>
                                                                            </div>
                                                                           </div>`)
        }
        basicPriceOptionLength++;
        syncDailyOptionInfoWithBasicOptionInfo(basicPriceOptionLength, 'byDayPriceOption');
    }
    //판매항목 삭제
    function deleteBasicPriceOption(button) {
        if ( confirm("삭제하시겠습니까?") ) {
            let deletedChildIndex = 0;
            const ele = button.closest("div[style='display:flex;']");
            if (ele) {
                deletedChildIndex = Array.from(ele.parentNode.children).indexOf(ele);
                ele.parentNode.removeChild(ele);
            }
            const byDayPriceOptionItemBoxDiv = document.querySelectorAll('[data-div-name="by-day-price-option-item-box-div"]');
            for (let i = 0; i < byDayPriceOptionItemBoxDiv.length; i++) {
                byDayPriceOptionItemBoxDiv[i].removeChild(byDayPriceOptionItemBoxDiv[i].children[deletedChildIndex]);
            }
            basicPriceOptionLength--;
            syncDailyOptionInfoWithBasicOptionInfo(basicPriceOptionLength, 'byDayPriceOption');
        }
    }

    //수정시 판매항목 추가
    function addModifyBasicPriceOption() {
        const modifyBasicPriceOptionBox = document.getElementById("modifyBasicPriceOptionBox");
        $.ajax({
            url : "/manage/product/add-basic-option"
            , type : "POST"
            , contentType : "application/json"
            , data : JSON.stringify({
                "productTourId": document.getElementById("product-tour-id").value
                , "optionSequence": modifyBasicPriceOptionBox.children.length+1
                , "optionName": ""
                , "optionDesc": ""
                , "maxQuantity": 0
            })
            , beforeSend: function (xhr) {
                xhr.setRequestHeader(
                    [[${_csrf.headerName}]], [[${_csrf.token}]]
                );
            },
            success : function (data) {
                if ( data.result === "success" ) {
                    const priceOptionId = data.priceOptionId;
                    modifyBasicPriceOptionBox.insertAdjacentHTML('beforeend', `<div style="display:flex;" data-price-option-id="${priceOptionId}" data-added-type="new">
                                                                        <div class="price-option-title">
                                                                            <input data-modify-basic-option-type="name" type="text" class="schedule-p-text" style="width: 100%;" value="" placeholder="항목을 입력해주세요." />
                                                                            <input data-modify-basic-option-type="price" type="text" onkeyup="checkInputNumValidation(event)" class="schedule-price-text" value="" placeholder="가격을 입력해주세요." />
                                                                        </div>
                                                                        <div class="price-option-quantity">
                                                                            <p class="schedule-p-text">최대수량</p>
                                                                            <input data-modify-basic-option-type="maxQuantity" onkeyup="checkInputNumValidation(event)" type="text" class="schedule-price-text" value="0" placeholder="수량입력"/>
                                                                        </div>
                                                                        <div class="option-btx-box">
                                                                            <button type="button" class="delete-option-btn" onclick="deleteModifyBasicPriceOption(this)">
                                                                                <img src="/images/icon/x-black-box-15x15.svg" style="width: 15px; height: 15px;" alt="">
                                                                            </button>
                                                                        </div>
                                                                        <input type="hidden" data-modify-basic-option-type="priceOptionId" value="${priceOptionId}">
                                                                   </div>`)
                    //요일별 칸에 세팅
                    const modifyByDayPriceOptionItemBoxDiv = document.querySelectorAll('[data-modify-div-name="by-day-price-option-item-box-div"]');
                    for (let q = 0; q < modifyByDayPriceOptionItemBoxDiv.length; q++) {
                        modifyByDayPriceOptionItemBoxDiv[q].insertAdjacentHTML("beforeend", `  <div data-box-name="option-item" data-added-type="new">
                                                                                    <div class="schedule-option-item-box">
                                                                                        <div class="price-basic-option-title">
                                                                                            <p type="text" class="schedule-p-text" data-modify-option-type="name" style="width: 100%;"></p>
                                                                                            <input type="text" class="schedule-price-text" data-modify-option-type="price" onkeyup="checkInputNumValidation(event)" value="" placeholder="가격을 입력해주세요.">
                                                                                        </div>
                                                                                    </div>
                                                                                    <div style="display: none">
                                                                                        <p class="schedule-p-text">최대수량</p>
                                                                                        <input type="text" class="schedule-price-text" data-modify-option-type="maxQuantity" onkeyup="checkInputNumValidation(event)" value="0" placeholder="수량입력"/>
                                                                                    </div>
                                                                                    <input type="hidden" data-modify-option-type="priceSetDate" value="item">
                                                                                    <input type="hidden" data-modify-option-type="priceOptionId" value="${priceOptionId}">
                                                                               </div>`)
                    }
                    syncModifyDailyOptionInfoWithBasicOptionInfo();
                }
                else {
                    alert(data.message);
                }
            }
        })
    }

    //수정시 판매항목 삭제
    function deleteModifyBasicPriceOption(button) {
        if ( confirm("삭제하시겠습니까?") ) {
            let deletedChildIndex = 0;
            const ele = button.closest("div[style='display:flex;']");
            if (ele) {
                deletedChildIndex = Array.from(ele.parentNode.children).indexOf(ele);
                ele.parentNode.removeChild(ele);
            }
            const byDayPriceOptionItemBoxDiv = document.querySelectorAll('[data-modify-div-name="by-day-price-option-item-box-div"]');
            for (let i = 0; i < byDayPriceOptionItemBoxDiv.length; i++) {
                byDayPriceOptionItemBoxDiv[i].removeChild(byDayPriceOptionItemBoxDiv[i].children[deletedChildIndex]);
            }
            basicPriceOptionLength--;
            syncModifyDailyOptionInfoWithBasicOptionInfo();
        }
    }

    let optionGroupCode = generateRandomCode(8);
    let calendarJson = []
    let calendarBarList = [];
    function addSchedule() {
        const inputElements = document.getElementById('scheduleAddModalScrollInnerBox').querySelectorAll("input:not([style='display:none;'])");
        let firstEmptyInput = null;
        for (const element of inputElements) {
            if ( element.offsetWidth !== 0 ) { //요소가 실제 보이는지 여부
                if (element.value.trim() === '') {
                    firstEmptyInput = element;
                    break; // 첫 번째 빈 input 태그를 찾으면 반복문을 종료
                }
            }
        }

        if ( firstEmptyInput ) {
            alert("모든 항목을 입력해주세요");
            firstEmptyInput.focus();
        }
        else if ( document.getElementById("product-tour-id").value === '' || document.getElementById("product-tour-id").value === null ) {
            alert("먼저 기본항목을 등록해주세요");
        }
        else {
            let confirmFlag = true;
            if ( priceTypeSelect.value === "samePrice" ) {
                endDate = startDate;
            }
            else {
                if ( new Date(endDate) < new Date(startDate) ) {
                    confirmFlag = false;
                    alert("종료일이 시작일보다 빠릅니다.");
                }
                else {
                    confirmFlag = true;
                }
            }

            if ( confirmFlag === true ) {
                const dayDuration = findDatesInRange(startDate, endDate);
                for (const date of dayDuration) {
                    let dayIndex = new Date(date).getDay();
                    dayIndex = (dayIndex+6)%7; //월요일부터 시작하도록
                    let basicOptionBoxIndex = 0;
                    const basicOptionBox = document.querySelector('#basicPriceOptionBox');
                    for (const basicOptionChildren of basicOptionBox.children) {
                        const basicOptionName = basicOptionChildren.querySelector('[data-basic-option-type="name"]').value;
                        const basicOptionPrice = basicOptionChildren.querySelector('[data-basic-option-type="price"]').value.replaceAll(",", "");
                        const basicOptionMaxQuantity = basicOptionChildren.querySelector('[data-basic-option-type="maxQuantity"]').value.replace(",", "");
                        if ( postJson.basicPriceList.length < basicOptionBox.children.length) {
                            const basicOptionItem = {
                                "optionSequence" : basicOptionBoxIndex+1
                                , "optionName" : basicOptionName
                                , "maxQuantity" : basicOptionMaxQuantity
                                , "optionGroupCode" : optionGroupCode
                                , "productTourId" : document.getElementById("product-tour-id").value
                            }
                            postJson.basicPriceList.push(basicOptionItem);
                        }

                        //기본가격 자식들 반복
                        //시작,종료기간안에 각 날짜별에 자식들 추가
                        const jsonItem = {
                            "priceSetDate" : date,
                            "optionName" : basicOptionName,
                            "priceNormal" : basicOptionPrice,
                            "maxQuantity" : basicOptionMaxQuantity,
                            "priceSequence" : "0",
                            "priceSetType" : priceTypeSelect.value === 'samePrice' ? 'samePrice' : 'periodSamePrice',
                            "aloneYn" : priceTypeSelect.value === 'samePrice' ? 'Y' : 'N',
                            "optionGroupCode" : optionGroupCode,
                            "productTourId" : document.getElementById("product-tour-id").value,
                            "deleteYn" : 'N'
                        }
                        //요일별 차등금액일시
                        const byDayPriceOptionChildren = document.querySelector('#byDayPriceOption').children;
                        const optionListDiv = byDayPriceOptionChildren[dayIndex].querySelector('[data-div-name="by-day-price-option-item-box-div"]')
                        if ( optionListDiv.style.display === 'block' ) {
                            const optionItem = optionListDiv.querySelectorAll('[data-box-name="option-item"]');
                            const name = optionItem[basicOptionBoxIndex].querySelector('[data-option-type="name"]').textContent;
                            const price = optionItem[basicOptionBoxIndex].querySelector('[data-option-type="price"]').value.replaceAll(",", "");
                            jsonItem.optionName = name;
                            jsonItem.priceNormal = price;
                            jsonItem.priceSetType = "byDayPrice";
                        }
                        postJson.dayList[dayIndex].push(jsonItem);
                        basicOptionBoxIndex++;
                    }
                }

                $.ajax({
                    url : "/manage/product/add-product-schedule"
                    , type : "POST"
                    , contentType : "application/json"
                    , data : JSON.stringify(postJson)
                    , beforeSend: function (xhr) {
                        xhr.setRequestHeader(
                            [[${_csrf.headerName}]], [[${_csrf.token}]]
                        );
                    },
                    success : function(data) {
                        let addBasicOptionIdList = document.getElementById('add-basic-option-id');
                        data.basicPriceIdList.forEach((idItem)=>{
                            addBasicOptionIdList.value = addBasicOptionIdList.value + idItem + ",";
                        })

                        $.ajax({
                            url : "/manage/product/load-added-price-option-list"
                            , type : "POST"
                            , contentType : "application/json"
                            , data : JSON.stringify({
                                "startDate" : startDate
                                , "optionGroupCode" : optionGroupCode
                                , "priceIdList" : data.priceIdList
                            })
                            , beforeSend: function (xhr) {
                                xhr.setRequestHeader(
                                    [[${_csrf.headerName}]], [[${_csrf.token}]]
                                );
                            }
                            , success : function(data) {
                                const addedPriceOptionList = data.AddedPriceOptionList;
                                let calendarJsonItem =
                                    {
                                        title: '', start: '', end : '',
                                        textColor : '', color : '', className : ''
                                    }
                                let preValue = 0;
                                addedPriceOptionList.forEach( (item) => {
                                    if ( preValue !== item.priceSequence ) {
                                        preValue = item.priceSequence;
                                    }
                                    calendarJsonItem =
                                        {
                                            title: '', start: '', end : '', textColor : '#000000',
                                            priceSequence : item.priceSequence, classNames: 'item-block'
                                        }
                                    calendarJsonItem.title = insertSpecialCharReverse(item.productPrice, 3, ',')+"~";
                                    calendarJsonItem.start = item.priceSetDate;
                                    // 하루를 추가 : FullCalendar의 end는 하루 줄어든채로 처리됨
                                    let dateStr = item.priceSetDate;
                                    let date = moment(dateStr, 'YYYY-MM-DD');
                                    date.add(1, 'days');
                                    calendarJsonItem.end = date.format('YYYY-MM-DD');
                                    calendarJsonItem.childGroupId = preValue;

                                    calendarJson.push(calendarJsonItem);
                                })

                                //캘린더 렌더 부분
                                const calendarEl = document.getElementById('calendar');
                                loadCalendar(calendarEl);

                                let dateStr = addedPriceOptionList[addedPriceOptionList.length - 1].priceSetDate;
                                let date = moment(dateStr, 'YYYY-MM-DD');
                                date.add(1, 'days');
                                // 막대 부분
                                calendarBarList.push({
                                    title: '', start: addedPriceOptionList[0].priceSetDate, end : date.format('YYYY-MM-DD'),
                                    barStartDate : addedPriceOptionList[0].priceSetDate, barEndDate : addedPriceOptionList[addedPriceOptionList.length-1].priceSetDate,
                                    priceSequence : addedPriceOptionList[0].priceSequence, textColor : '#000000', color : color[preValue % 10], groupId : preValue
                                })
                                calendar.addEventSource({
                                    events : calendarBarList
                                });
                                calendar.render();
                            }
                        })
                        closeScheduleAddModal();
                    }
                })
            }
        }
    }

    let copyPostJson = postJson;
    function modifySchedule() {
        const inputElements = document.getElementById('modifyScheduleAddModalScrollInnerBox').querySelectorAll("input:not([style='display:none;'])");
        let firstEmptyInput = null;
        for (const element of inputElements) {
            if ( element.offsetWidth !== 0 ) { //요소가 실제 보이는지 여부
                if (element.value.trim() === '') {
                    firstEmptyInput = element;
                    break; // 첫 번째 빈 input 태그를 찾으면 반복문을 종료
                }
            }
        }

        if (firstEmptyInput) {
            alert("모든 항목을 입력해주세요");
            firstEmptyInput.focus();
        }
        else {
            let confirmFlag = true;
            if ( modifyPriceTypeSelect.value === "samePrice" ) {
                endDate = startDate;
            }
            else {
                if ( new Date(endDate) < new Date(startDate) ) {
                    confirmFlag = false;
                    alert("종료일이 시작일보다 빠릅니다.");
                }
                else {
                    confirmFlag = true;
                }
            }

            if ( confirmFlag === true ) {
                const dayDuration = findDatesInRange(startDate, endDate);
                for (const date of dayDuration) {
                    let dayIndex = new Date(date).getDay();
                    dayIndex = (dayIndex+6)%7; //월요일부터 시작하도록
                    let basicOptionBoxIndex = 0;
                    const basicOptionBox = document.querySelector('#modifyBasicPriceOptionBox');
                    for (const basicOptionChildren of basicOptionBox.children) {
                        const basicOptionName = basicOptionChildren.querySelector('[data-modify-basic-option-type="name"]').value;
                        const basicOptionPrice = basicOptionChildren.querySelector('[data-modify-basic-option-type="price"]').value.replaceAll(",", "");
                        const basicOptionMaxQuantity = basicOptionChildren.querySelector('[data-modify-basic-option-type="maxQuantity"]').value.replace(",", "");
                        const basicPriceOptionId = basicOptionChildren.querySelector('[data-modify-basic-option-type="priceOptionId"]').value;

                        if ( postJson.basicPriceList.length < basicOptionBox.children.length) {
                            const basicOptionItem = {
                                "optionSequence" : basicOptionBoxIndex+1
                                , "optionName" : basicOptionName
                                , "maxQuantity" : basicOptionMaxQuantity
                                , "priceOptionId" : basicPriceOptionId
                                , "productTourId" : document.getElementById("product-tour-id").value
                                , "optionGroupCode" : optionGroupCode
                            }
                            postJson.basicPriceList.push(basicOptionItem);
                        }
                        //기본가격 자식들 반복
                        //시작,종료기간안에 각 날짜별에 자식들 추가
                        const jsonItem = {
                            "priceSetDate" : date,
                            "optionName" : basicOptionName,
                            "priceNormal" : basicOptionPrice,
                            "maxQuantity" : basicOptionMaxQuantity,
                            "priceSequence" : priceSequenceValue,
                            "priceSetType" : modifyPriceTypeSelect.value === 'samePrice' ? 'samePrice' : 'periodSamePrice',
                            "aloneYn" : modifyPriceTypeSelect.value === 'samePrice' ? 'Y' : 'N',
                            "optionGroupCode" : optionGroupCode,
                            "deleteYn" : 'N'
                        }
                        //요일별 차등금액일시
                        const modifyByDayPriceOptionChildren = document.querySelector('#modifyByDayPriceOption').children;
                        const optionListDiv = modifyByDayPriceOptionChildren[dayIndex].querySelector('[data-modify-div-name="by-day-price-option-item-box-div"]')
                        if ( optionListDiv.style.display === 'block' ) {
                            const optionItem = optionListDiv.querySelectorAll('[data-box-name="option-item"]');
                            const name = optionItem[basicOptionBoxIndex].querySelector('[data-modify-option-type="name"]').textContent;
                            const price = optionItem[basicOptionBoxIndex].querySelector('[data-modify-option-type="price"]').value.replaceAll(",", "");
                            jsonItem.optionName = name;
                            jsonItem.priceNormal = price;
                            jsonItem.priceSetType = "byDayPrice";
                            jsonItem.productTourId = document.getElementById("product-tour-id").value;
                        }

                        //이미 등록된 날짜가 있다면 그걸로 대체.
                        addedPriceSetList.forEach((item)=>{
                            if ( date === item.priceSetDate
                                && basicOptionChildren.querySelector('[data-modify-basic-option-type="priceOptionId"]').value == item.priceOptionId ) {
                                jsonItem.priceOptionId = item.priceOptionId
                                jsonItem.priceId = item.priceId
                            }
                        })

                        postJson.dayList[dayIndex].push(jsonItem);
                        basicOptionBoxIndex++;
                    }
                }
                copyPostJson = deepCopy(postJson);
                $.ajax({
                    url : "/manage/product/add-product-schedule"
                    , type : "POST"
                    , contentType : "application/json"
                    , data : JSON.stringify(postJson)
                    , beforeSend: function (xhr) {
                        xhr.setRequestHeader(
                            [[${_csrf.headerName}]], [[${_csrf.token}]]
                        );
                    },
                    success : function(data) {
                        $.ajax({
                            url : "/manage/product/load-added-price-option-list"
                            , type : "POST"
                            , contentType : "application/json"
                            , data : JSON.stringify({
                                "startDate" : startDate
                                , "optionGroupCode" : optionGroupCode
                                , "priceIdList" : data.priceIdList
                            })
                            , beforeSend: function (xhr) {
                                xhr.setRequestHeader(
                                    [[${_csrf.headerName}]], [[${_csrf.token}]]
                                );
                            }
                            , success : function(data) {
                                calendar.destroy();
                                const addedPriceOptionList = data.AddedPriceOptionList;
                                for (let i = 0; i < calendarJson.length; i++) {
                                    if (calendarJson[i].childGroupId === addedPriceOptionList[0].priceSequence) {
                                        calendarBarList.forEach((item,l)=>{
                                            if ( item.groupId === calendarJson[i].childGroupId ) {
                                                calendarBarList.splice(l,1);
                                            }
                                        })
                                        calendarJson.splice(i, 1); // 해당 항목 삭제
                                        i--; // 배열 크기가 줄어들었으므로 인덱스 조정
                                    }
                                }
                                let calendarJsonItem =
                                    {
                                        title: '', start: '', end : '',
                                        textColor : '', color : '', className : ''
                                    }
                                let preValue = 0;
                                addedPriceOptionList.forEach( (item) => {
                                    if ( preValue !== item.priceSequence ) {
                                        preValue = item.priceSequence;
                                    }
                                    calendarJsonItem =
                                        {
                                            title: '', start: '', end : '', textColor : '#000000',
                                            priceSequence : item.priceSequence, classNames: 'item-block'
                                        }
                                    calendarJsonItem.title = insertSpecialCharReverse(item.productPrice, 3, ',')+"~";
                                    calendarJsonItem.start = item.priceSetDate;
                                    // 하루를 추가 : FullCalendar의 end는 하루 줄어든채로 처리됨
                                    let dateStr = item.priceSetDate;
                                    let date = moment(dateStr, 'YYYY-MM-DD');
                                    date.add(1, 'days');
                                    calendarJsonItem.end = date.format('YYYY-MM-DD');
                                    calendarJsonItem.childGroupId = preValue;

                                    calendarJson.push(calendarJsonItem);
                                })

                                //캘린더 렌더 부분
                                const calendarEl = document.getElementById('calendar');
                                loadCalendar(calendarEl);

                                let dateStr = addedPriceOptionList[addedPriceOptionList.length - 1].priceSetDate;
                                let date = moment(dateStr, 'YYYY-MM-DD');
                                date.add(1, 'days');
                                // 막대 부분
                                calendarBarList.push({
                                    title: '', start: addedPriceOptionList[0].priceSetDate, end : date.format('YYYY-MM-DD'),
                                    barStartDate : addedPriceOptionList[0].priceSetDate, barEndDate : addedPriceOptionList[addedPriceOptionList.length-1].priceSetDate,
                                    priceSequence : addedPriceOptionList[0].priceSequence, textColor : '#000000', color : color[preValue % 10], groupId : preValue
                                })
                                calendar.addEventSource({
                                    events : calendarBarList
                                });
                                calendar.render();
                            }
                        })
                        closeScheduleModifyModal();
                    }
                })
            }
        }
    }

    function deleteSchedule(priceSequence) {
        if ( confirm("삭제하시겠습니까?") ) {
            const basicPriceOptionIdList = [];

            let addBasicOptionIdList = document.getElementById('add-basic-option-id');
            const basicPriceOptionId = document.querySelectorAll('[data-modify-basic-option-type="priceOptionId"]');
            for (const basicPriceOption of basicPriceOptionId) {
                basicPriceOptionIdList.push(basicPriceOption.value);
                addBasicOptionIdList.value = addBasicOptionIdList.value.replace(basicPriceOption.value+",", "");
            }
            $.ajax({
                url : "/manage/product/remove-price-set"
                , type : "POST"
                , contentType: "application/json"
                , beforeSend: function (xhr) {
                    xhr.setRequestHeader(
                        [[${_csrf.headerName}]], [[${_csrf.token}]]
                    );
                }
                , data : JSON.stringify({
                    "basicPriceOptionIdList" : basicPriceOptionIdList
                    , "priceSequence" : priceSequence
                    , "useYn" : "N"
                })
                , success : function (data) {
                    calendar.destroy();
                    const deletePriceOptionList = data.deletePriceOptionList;
                    if ( deletePriceOptionList.length > 0) {
                        for (let i = 0; i < calendarJson.length; i++) {
                            if (calendarJson[i].childGroupId === deletePriceOptionList[0].priceSequence) {
                                calendarBarList.forEach((item,l)=>{
                                    if ( item.groupId === calendarJson[i].childGroupId ) {
                                        calendarBarList.splice(l,1);
                                    }
                                })
                                calendarJson.splice(i, 1); // 해당 항목 삭제
                                i--; // 배열 크기가 줄어들었으므로 인덱스 조정
                            }
                        }

                        let preValue = 0;
                        calendarJson.forEach( (item) => {
                            if (preValue !== item.priceSequence) {
                                preValue = item.priceSequence;
                            }
                        })

                        //캘린더 렌더 부분
                        const calendarEl = document.getElementById('calendar');
                        loadCalendar(calendarEl);

                        let dateStr = deletePriceOptionList[deletePriceOptionList.length - 1].priceSetDate;
                        let date = moment(dateStr, 'YYYY-MM-DD');
                        date.add(1, 'days');
                        calendar.addEventSource({
                            events : calendarBarList
                        });
                        calendar.render();
                    }

                    closeScheduleModifyModal();


                }
            })
        }
    }

    const ajaxJson = {
        "priceOptionList" : {
            copyPostJson
            , "fixPriceList" : []
            , "deleteBasicPriceOptionList" : []
        },
        "productInfo" : { "productTourId" : document.getElementById("product-tour-id").value
            , "registerType" : "add" }
    } ;
    function saveProductPriceInfo(inputWrapper) {
        if ( document.getElementById("product-tour-id").value === "" || document.getElementById("product-tour-id").value === null ) {
            alert("기본정보를 먼저 저장해주세요.");
        }
        else {


            //판매가격설정 타입
            let inputValidation = true;
            let inputValidationItem = "";
            const priceSelectType = document.querySelector('.price-select').value;
            if ( priceSelectType === "fix" ) {
                for (let i = 0; i < document.querySelectorAll(`[data-fix-option-type]`).length; i++) {
                    if (document.querySelectorAll(`[data-fix-option-type]`)[i].value === "") {
                        inputValidation = false;
                        inputValidationItem = document.querySelectorAll(`[data-fix-option-type]`)[i];
                        break;
                    }
                    else {
                        inputValidation = true;
                    }
                }

                if ( inputValidation === true ) {
                    const fixPriceList = document.querySelector('#fix-price-list-box');
                    for ( let i = 0; i < fixPriceList.children.length; i++ ) {
                        const itemJson = {
                            "productTourId" : document.getElementById("product-tour-id").value,
                            "optionName": fixPriceList.children[i].querySelector('[data-fix-option-type="name"]').value,
                            "priceNormal": fixPriceList.children[i].querySelector('[data-fix-option-type="price"]').value.replaceAll(",", ""),
                            "maxQuantity": fixPriceList.children[i].querySelector('[data-fix-option-type="maxQuantity"]').value.replace(",", ""),
                            "optionGroupCode": optionGroupCode,
                            "optionSequence": i+1,
                        };
                        ajaxJson.priceOptionList.fixPriceList.push(itemJson);
                    }
                }
                else if ( priceSelectType === "fix" && inputValidation === false ) {
                    alert("모든 항목을 입력해주세요");
                    inputValidationItem.focus();
                }
            }
            else if ( priceSelectType !== "fix" ) {
                ajaxJson.priceOptionList.addBasicOptionId = document.getElementById('add-basic-option-id').value;
            }

            if ( inputValidation ) {
                $.ajax({
                    url : '/manage/product/add-product-price-info'
                    , type : 'POST'
                    , contentType : 'application/json'
                    , data : JSON.stringify(ajaxJson)
                    , beforeSend : function (xhr) {
                        xhr.setRequestHeader([[${_csrf.headerName}]], [[${_csrf.token}]]);
                    }
                    , success : function(data) {
                        if ( data.result === 'success' ) {
                            document.getElementById('price-info').value = 'Y';
                            let nextInfoTab = inputWrapper.nextElementSibling;
                            let nextInfoToggle = nextInfoTab.querySelector(".title-div > .info-toggle");
                            nextInfoToggle.click();

                            let currentInfoToggle = inputWrapper.querySelector(".title-div > .info-toggle");
                            currentInfoToggle.click();
                        }
                    }
                });
            }
        }
    }

    function saveProductDetailSchedule() {
        if ( document.getElementById("product-tour-id").value === "" || document.getElementById("product-tour-id").value === null ) {
            alert("기본정보를 먼저 저장해주세요.");
        }
        else {
            const thisJson = {
                "detailScheduleList" : [],
            } ;

            const detailScheduleType = document.querySelector('.detail-schedule-select').value;
            //일자별 사용여부 체크
            if ( detailScheduleType !== "notUse" ) {
                let passFlag = true;

                const dayItem = document.querySelectorAll('.detail-schedule-content-box');
                //날짜별 일정 추가가 안되어 있는 곳 체크
                for ( let i = 0; i < detailScheduleType; i++ ) {
                    if ( dayItem[i].querySelectorAll('.schedule-item').length === 0 ) {
                        const elNum = dayItem[i].id.lastIndexOf("-")+1;
                        alert(`${dayItem[i].id.substring(elNum)}일차 일정을 추가해 주세요.`);
                        document.querySelector(`.detail-schedule-day-tab-box [data-btn-order-num="${dayItem[i].id.substring(elNum)}"]`).click();
                        passFlag = false;
                        break;
                    }
                }

                if ( passFlag ) {
                    let scheduleList = [];
                    const tabBox = document.querySelector('.detail-schedule-day-tab-box');
                    //일차별
                    for (const item of tabBox.children) {
                        //노출되어 있는 일차만 가져옴
                        if ( item.style.display !== 'none' ) {
                            refreshOrderNumber(item.dataset.btnOrderNum)
                            const contentBox = document.querySelector(`#detail-schedule-content-box-${item.dataset.btnOrderNum}`);
                            if ( contentBox.querySelectorAll('ul').length > 0 ) {
                                //각 일차에 속한 일정들
                                for ( const ulItem of contentBox.querySelectorAll('ul') ) {
                                    scheduleList.push({
                                        "productTourId" : document.getElementById("product-tour-id").value
                                        , "detailId" : ulItem.querySelector('input[name="detail_id"]')?.value
                                        , "detailSequence" : ulItem.querySelector('input[name="schedule_item_order"]').value
                                        , "detailCategory" : item.dataset.btnOrderNum
                                        , "detailTitle" : ulItem.querySelector('input[name="detail_title"]').value
                                        , "address" : ulItem.querySelector('input[name="day_address"]').value
                                        , "tourspotId" : ulItem.querySelector('input[name="spot_id"]').value
                                        , "dayText" : ulItem.querySelector('input[name="day_text"]').value
                                        , "attachImage" : ulItem.querySelector('input[name="imageNums"]').value
                                        , "detailType" : "use"
                                        , "registerType" : "add"
                                    });
                                }
                            }
                        }
                    }
                    thisJson.detailScheduleList = scheduleList;

                    $.ajax({
                        url : '/manage/product/add-product-detail-schedule'
                        , type : 'POST'
                        , contentType : 'application/json'
                        , data : JSON.stringify(thisJson)
                        , beforeSend : function (xhr) {
                            xhr.setRequestHeader([[${_csrf.headerName}]], [[${_csrf.token}]]);
                        }
                        , success : function(data) {
                            if ( data.result === 'success' ) {
                                document.getElementById('schedule-info').value = 'Y';
                                alert(data.message)
                            }
                        }
                    });
                }
            }
            else {
                let scheduleList = [];
                scheduleList.push({ "productTourId" : document.getElementById("product-tour-id").value,
                                    "detailType" : "notUse" });
                thisJson.detailScheduleList = scheduleList;

                $.ajax({
                    url : '/manage/product/add-product-detail-schedule'
                    , type : 'POST'
                    , contentType : 'application/json'
                    , data : JSON.stringify(thisJson)
                    , beforeSend : function (xhr) {
                        xhr.setRequestHeader([[${_csrf.headerName}]], [[${_csrf.token}]]);
                    }
                    , success : function(data) {
                        if ( data.result === 'success' ) {
                            document.getElementById('schedule-info').value = 'Y';
                            alert(data.message)
                        }
                    }
                });
            }
        }
    }

    function checkDayCheckBox(event) {
        const checkbox = event.target;
        const scheduleOptionItemBox = checkbox.closest(".by-day-price-option-item-box").querySelectorAll('[data-div-name="by-day-price-option-item-box-div"]');
        const displayStyle = checkbox.checked ? "block" : "none";

        scheduleOptionItemBox.forEach(itemBox => {
            itemBox.style.display = displayStyle;
        });
    }

    function modifyCheckDayCheckBox(event) {
        const checkbox = event.target;
        const scheduleOptionItemBox = checkbox.closest(".by-day-price-option-item-box").querySelectorAll('[data-modify-div-name="by-day-price-option-item-box-div"]');
        const displayStyle = checkbox.checked ? "block" : "none";


        scheduleOptionItemBox.forEach(itemBox => {
            itemBox.style.display = displayStyle;
        });
    }

    function closeScheduleAddModal() {
        document.querySelector('.schedule-add-modal-box').style.display = "none";
        document.querySelector('.schedule-add-modal-box').innerHTML = "";
        postJson = {
            basicPriceList: [],
            priceSequence: '0',
            dayList: {
                0 : [], 1 : [], 2 : [], 3 : [], 4 : [], 5 : [], 6 : [],
            }
        };
    }

    function closeScheduleModifyModal() {
        document.querySelector('.schedule-modify-modal-box').style.display = "none";
        document.querySelector('.schedule-modify-modal-box').innerHTML = "";
        postJson = {
            basicPriceList: [],
            priceSequence: '0',
            dayList: {
                0 : [], 1 : [], 2 : [], 3 : [], 4 : [], 5 : [], 6 : [],
            }
        };
        startDate = new Date().toISOString().split('T')[0]
        endDate = new Date().toISOString().split('T')[0]
    }

    let detailSchedulePlaceParents = "";
    function selectConnectPlace() {
        const parentsDiv = detailSchedulePlaceParents;
        const selectedPlace = document.querySelector('.place-item-box.active');

        parentsDiv.querySelector('.connect-place-box-input').value = selectedPlace.querySelector('.place-item-name').textContent;
        parentsDiv.querySelector('.detail-schedule-address-input').value = selectedPlace.querySelector('.place-item-address').textContent;
        parentsDiv.querySelector('input[name="spot_id"]').value = selectedPlace.querySelector('#place-item-id').value;
        parentsDiv.querySelector('.detail-schedule-item-image-list').querySelector('.place-image-box')?.remove();
        parentsDiv.querySelector('.detail-schedule-item-image-list > .swiper-wrapper').insertAdjacentHTML('beforeend',`
            <div class="detail-schedule-item-image-box swiper-slide place-image-box">
                <img src="${selectedPlace.querySelector('#place-item-image').value}" style="object-fit: cover;" alt="">
            </div>
        `)

        closeConnectPlaceModal();
        detailSchedulePlaceParents = "";
    }

    function showConnectPlaceModal(e) {
        detailSchedulePlaceParents = e.closest('.detail-schedule-item-box')
        $('#place-item-list-paging').pagination({
            dataSource: function(done) {
                $.ajax({
                    url: '/manage/place/spot-list',
                    type: 'POST',
                    data: { titleLike : ""},
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader(
                            [[${_csrf.headerName}]], [[${_csrf.token}]]
                        );
                    },
                    success: function(data) {
                        done(data.data); // 데이터와 총 개수 전달
                    }
                })
            }
            , totalNumberLocator: function(response) {
                return response;
            }
            , pageSize : 5
            , showPrevious: true
            , showNext: true
            , locator: 'lists'
            , alias: {
                pageNumber: 'startPage'
                , pageSize : 'boardPerPage'
            }
            , callback: function (data) {
                document.querySelector('#place-item-list').innerHTML = "";
                //검색결과 item에 생성
                for ( const item of data ) {
                    document.querySelector('#place-item-list').insertAdjacentHTML('afterbegin',
                        `
                    <div class="place-item-box">
                        <p class="place-item-name">${item.tsTitle}</p>
                        <p class="place-item-address">${item.tsRoad}</p>
                        <input id="place-item-id" type="hidden" value="${item.tsId}">
                        <input id="place-item-image" type="hidden" value="${item.tsAppend}">
                    </div>
                    `)
                }
                //검색결과 모든 item에 active 효과
                document.querySelectorAll('.place-item-box').forEach((div) => {
                    div.addEventListener('click', () => {
                        document.querySelectorAll('.place-item-box').forEach((item) => {
                            item.classList.remove('active');
                        });
                        div.classList.add('active');
                    });
                });
            }
        })

        document.querySelector('.connect-place-select-modal-box').style.display = "flex";
    }

    function closeConnectPlaceModal() {
        document.querySelector('.connect-place-select-modal-box').style.display = "none";
        document.querySelector('#search-form').reset();
        document.querySelector('#place-item-list').innerHTML = "";
    }

    function addDetailScheduleItem(num) {
        const contentBox = document.querySelector(`#detail-schedule-content-box-${num}`);
        const childLength = contentBox.querySelector(`#detail-schedule-content-item-${num}`).children.length
        contentBox.querySelector(`#detail-schedule-content-item-${num}`).insertAdjacentHTML('beforeend',
        `
        <ul class="schedule-item">
            <li class="detail-schedule-content-inner-box">
                <p class="detail-schedule-order-text">일정#${childLength+1}</p>
                <div class="detail-schedule-item-box">
                    <div class="detail-schedule-first-line">
                        <div class="detail-schedule-name-box">
                            <label class="detail-schedule-name-label">
                                일정명*
                                <input type="text" name="day_text" class="detail-schedule-name-input" placeholder="일정명을 입력해주세요.">
                            </label>
                        </div>
                        <div class="detail-schedule-address-box">
                            <label class="detail-schedule-address-label">
                                주소
                                <input type="text" name="day_address" class="detail-schedule-address-input" placeholder="주소" readonly>
                            </label>
                        </div>
                    </div>
                    <div class="detail-schedule-second-line">
                        <label class="detail-schedule-title-label">
                            일정내용
                            <input type="text" name="detail_title" class="detail-schedule-title-input" placeholder="일정내용을 입력해주세요.">
                        </label>
                    </div>
                    <div class="detail-schedule-third-line">
                        <div style="display:flex;">
                            <div id="detail-schedule-item-image-list" class="swiper-container detail-schedule-item-image-list">
                                <div class="swiper-wrapper">
                                <!--스크립트에서 처리-->
                                </div>
                                <div class="schedule-swiper-button-prev"></div>
                                <div class="schedule-swiper-button-next"></div>
                            </div>
                            <input type="hidden" id="imageNums" name="imageNums"/>
                            <input type="file" id="attach" name="attach" accept="image/*" hidden/>
                            <button type="button" onclick="uploadDetailScheduleImage(this);" style="min-width: 70px; height: 70px; background: url('/images/icon/upload-rectangle.svg')"></button>
                        </div>
                        <div style="display: flex;">
                            <div class="connect-place-box">
                                <label class="connect-place-box-label">
                                    연결 장소
                                    <input type="text" class="connect-place-box-input" placeholder="연결 장소">
                                </label>
                            </div>
                            <button type="button" class="choose-place-btn" onclick="showConnectPlaceModal(this)">
                                장소 선택
                            </button>
                        </div>
                    </div>
                    <input type="hidden" name="spot_id">
                </div>
                <div class="delete-schedule-btn">
                    <button type="button" onclick="deleteDetailScheduleItem(this, ${num})">
                        <img src="/images/icon/x-black-box-15x15.svg" style="width: 15px; height: 15px;" alt="">
                    </button>
                </div>
                <input type="hidden" name="schedule_item_order">
            </li>
        </ul>
        `);
        new Swiper(`.swiper-container`, {
            slidesPerView: "auto",  // 한 번에 보여줄 슬라이드 개수
            spaceBetween: 8,  // 슬라이드 간의 간격 (px)
            draggable: false,
            navigation: {
                nextEl: `.schedule-swiper-button-next`,
                prevEl: `.schedule-swiper-button-prev`,
            },
        });
        initScheduleItemSortable(num);
    }

    function uploadDetailScheduleImage(e) {
        const fileInput = e.parentElement.querySelector("#attach");
        const formData = new FormData();

        fileInput.click();

        function handleFileChange() {
            fileInput.removeEventListener('change', handleFileChange);

            let file = fileInput.files[0];
            formData.append('file', file);

            $.ajax({
                url: "/manage/product/upload-tour-detail-schedule-image",
                type: "POST",
                processData: false,
                contentType: false,
                data: formData,
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(
                        [[${_csrf.headerName}]], [[${_csrf.token}]]
                    );
                },
                success: function (data) {
                    if ( data.result === "success" ) {
                        const imageList = e.closest(".schedule-item").querySelector("#detail-schedule-item-image-list");
                        imageList.querySelector('.swiper-wrapper').insertAdjacentHTML('beforeend',
                            `<div class="detail-schedule-item-image-box swiper-slide">
                                <img class="schedule-item-images-${data.imageNum}" src="/upload/${data.uploadFilename}" style="object-fit: cover;" alt="">
                                <button type="button" class="detail-schedule-item-image-delete-btn" onclick="deleteDetailScheduleImage(this)">
                                    <img src="/images/icon/x-black-box-15x15.svg" alt="">
                                </button>
                                <input type="hidden" name="image_num" value="${data.imageNum}">
                             </div>`
                        );

                        initScheduleItemSwiper(e);

                        const imageNumInput = e.closest(".schedule-item").querySelector("#imageNums");
                        imageNumInput.value =  imageNumInput.value + "," + data.imageNum;
                    }
                    fileInput.removeEventListener('change', handleFileChange);
                    fileInput.value = null;

                    Zoom(`.schedule-item-images-${data.imageNum}`);
                }
            });
        }

        fileInput.addEventListener('change', handleFileChange);
    }

    function deleteDetailScheduleImage(e) {
        if ( confirm("삭제하시겠습니까?") ) {
            const imageBox = e.closest('.swiper-slide');
            const imageBoxRootBox = imageBox.closest('.schedule-item');
            const imageNum = imageBox.querySelector('input[name="image_num"]').value;

            imageBoxRootBox.querySelector("#imageNums").value = imageBoxRootBox.querySelector("#imageNums").value.replace(imageNum, "");
            imageBox.remove();
        }
    }

    function deleteDetailScheduleItem(obj, num) {
        if ( confirm("삭제하시겠습니까?") ) {
            const item = obj.closest('.schedule-item');
            item.remove();
            refreshOrderNumber(num);
        }
    }

    function refreshOrderNumber(num) {
        const optionSortItem = document.querySelector(`#detail-schedule-content-item-${num}`).querySelectorAll('.schedule-item');
        for(let i = 0; i < optionSortItem.length; i++){
            optionSortItem[i].querySelector(".detail-schedule-order-text").textContent = `일정#${Number(i + 1)}`;
            optionSortItem[i].querySelector("input[name='schedule_item_order']").value = Number(i + 1);
        }
    }

    function addFixPriceOption() {
        document.querySelector('#fix-price-list-box').insertAdjacentHTML('beforeend',
        `
            <div class="price-option-id-box">
                <div class="fix-price-option-title">
                    <input data-fix-option-type="name" type="text" class="schedule-p-text" style="width: 100%;" placeholder="항목을 입력해주세요.">
                    <input data-fix-option-type="price" type="text" onkeyup="checkInputNumValidation(event)" class="schedule-price-text" placeholder="가격을 입력해주세요.">
                </div>
                <div class="fix-price-option-quantity">
                    <p class="schedule-p-text">최대수량</p>
                    <input data-fix-option-type="maxQuantity" type="text" onkeyup="checkInputNumValidation(event)" class="schedule-price-text" placeholder="수량을 입력해주세요.">
                </div>
                <div class="option-btx-box">
                    <button type="button" class="delete-option-btn" onclick="deleteFixPriceOption(this)">
                        <img src="/images/icon/x-black-box-15x15.svg" style="width: 15px; height: 15px;" alt="">
                    </button>
                    <input type="hidden" id="price-id" value="0">
                </div>
            </div>
        `)

    }

    function deleteFixPriceOption(e) {
        if ( confirm("삭제하시겠습니까?") ) {
            e.closest('.price-option-id-box').remove();
        }
    }

    function goAddOption() {
        window.open("/manage/product/option/list", "_blank");
    }

    //뒤에서부터 n자리마다 원하는 문자 넣기
    function insertSpecialCharReverse(str, n, char){
        const regex = new RegExp(`(.)(?=(.{${n}})+$)`, "g");

        return str.toString().replace(regex, `$1${char}`);
    }

    //날짜범위안에 있는 모든 날짜 구하기
    function findDatesInRange(startDate, endDate) {
        const start = new Date(startDate);
        const end = new Date(endDate);
        const result = [];

        while (start <= end) {
            const year = start.getFullYear();
            const month = String(start.getMonth() + 1).padStart(2, '0');
            const day = String(start.getDate()).padStart(2, '0');
            const formattedDate = `${year}-${month}-${day}`;
            result.push(formattedDate);

            // 다음 날짜로 이동
            start.setDate(start.getDate() + 1);
        }

        return result;
    }

    function initScheduleItemSortable(num) {
        $(`#detail-schedule-content-item-${num}`).sortable({
            items: $(`.schedule-item`),
            forcePlaceholderSize: true,
            placeholder: 'box-line',
            start: function (a,item) {
            },
            stop: function (a,item) {
                refreshOrderNumber(num);
            }
        })
    }

    function initScheduleItemSwiper(e) {
        const con = e.closest(".schedule-item").querySelector('.swiper-container')
        const next = e.closest(".schedule-item").querySelector('.schedule-swiper-button-next')
        const prev = e.closest(".schedule-item").querySelector('.schedule-swiper-button-prev')
        new Swiper(con, {
            slidesPerView: "auto",  // 한 번에 보여줄 슬라이드 개수
            spaceBetween: 8,  // 슬라이드 간의 간격 (px)
            draggable: false,
            navigation: {
                nextEl: next,
                prevEl: prev,
            },
        });
    }

    function deepCopy(obj) {
        if (typeof obj !== 'object' || obj === null) {
            return obj;
        }

        let copy;

        if (Array.isArray(obj)) {
            copy = [];
            for (const item of obj) {
                copy.push(deepCopy(item));
            }
        } else {
            copy = {};
            for (const key in obj) {
                if (obj.hasOwnProperty(key)) {
                    copy[key] = deepCopy(obj[key]);
                }
            }
        }

        return copy;
    }

    function generateRandomCode(length) {
        let result = '';
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        const charactersLength = characters.length;

        for (let i = 0; i < length; i++) {
            const randomIndex = Math.floor(Math.random() * charactersLength);
            result += characters.charAt(randomIndex);
        }

        return result;
    }

    function loadCalendar(calendarEl) {
        calendar = new FullCalendar.Calendar(calendarEl, {
            height: "auto",
            eventOrder : 'displayOrder',
            headerToolbar: {
                left: '',
                center: 'prev,title,next',
                right: ''
            },
            titleFormat: 'YYYY.MM',
            locale : 'ko',
            eventDidMount: function (info) {
                info.el.dataset.groupId = info.event._def.groupId;
                info.el.dataset.barStartDate = info.event._def.extendedProps.barStartDate;
                const barGroupId = info.el.dataset.groupId;
                const barStartDate = info.el.closest('td').dataset.date;

                calendarJson.forEach((calendarItem) => {
                    if ( barGroupId === calendarItem.childGroupId && barStartDate === calendarItem.start ) {
                        info.el.insertAdjacentHTML('beforebegin',
                            `<p style="width: fit-content; margin-top: 5px; margin-left: 15px;" data-p-group-id="${calendarItem.childGroupId}">${calendarItem.title}</p>`)
                    }
                })
            },
            eventClick: function(arg, i,c) {
                const priceSequence = arg.event._def.extendedProps.priceSequence;
                showScheduleModifyModal(priceSequence);
                arg.jsEvent.preventDefault() // don't navigate in main tab
            },
            dateClick: function(info) {
                // 선택한 날짜가 오늘이후 경우에만 alert 띄우기
                if ( new Date(info.dateStr) > new Date() || new Date(info.dateStr).getDate() === new Date().getDate() ) {
                    startDate = info.dateStr;
                    endDate = info.dateStr;
                    showScheduleAddModal('samePrice');
                }
            },
            dayCellContent: function(e) {
                e.dayNumberText = e.dayNumberText.replace("일", "");
            },
            datesSet: function(info) {
                setTimeout(()=>{
                    let topPx = 0;
                    let addFlag = true; //true p태그(가격title) 추가 : false p태그 추가 불가
                    for (let i=0; i < calendarJson.length; i++){
                        //막대바
                        if ( document.querySelector('.calendar-box').querySelector(`[data-date="${calendarJson[i].start}"]`) !== null ) {
                            const aItem = document.querySelector('.calendar-box').querySelector(`[data-date="${calendarJson[i].start}"]`).querySelector(`[data-group-id="${calendarJson[i].childGroupId}"]`);
                            //각 jsonItem 요일에 막대바가 존재하는지 체크(막대바 시작일 체크용)
                            if ( aItem !== null ) {
                                topPx = Number(aItem.closest('.fc-daygrid-event-harness').style.top.replace('px',''));
                                addFlag = true;
                            }
                            else {//막대바가 없는 요일 체크
                                //같은 요일에 이미 추가된 p태그(가격title)가 있는지 체크
                                document.querySelector('.calendar-box').querySelector(`[data-date="${calendarJson[i].start}"]`).querySelector('.fc-daygrid-day-events').querySelectorAll('p').forEach((pItem)=>{
                                    //있으면 false 처리
                                    if ( pItem.dataset.pGroupId === calendarJson[i].childGroupId) {
                                        addFlag = false;
                                    }
                                })
                                //p태그 추가
                                if ( addFlag === true ) {
                                    document.querySelector('.calendar-box').querySelector(`[data-date="${calendarJson[i].start}"]`).querySelector('.fc-daygrid-day-events').insertAdjacentHTML('beforeend'
                                        ,`<p style="position: absolute; top:${topPx+5}px; margin-left: 14px;" data-p-group-id="${calendarJson[i].childGroupId}">${calendarJson[i].title}</p>`);
                                }
                            }
                        }
                    }
                },30)
            }
        });
    }

    function searchTourPlace() {
        $('#place-item-list-paging').pagination({
            dataSource: function(done) {
                const searchWord = document.querySelector('.connect-place-select-modal-box').querySelector('.place-search-name-input').value;
                $.ajax({
                    url: '/manage/place/spot-list',
                    type: 'POST',
                    data: { titleLike : searchWord},
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader(
                            [[${_csrf.headerName}]], [[${_csrf.token}]]
                        );
                    },
                    success: function(data) {
                        done(data.data); // 데이터와 총 개수 전달
                    }
                })
            }
            , totalNumberLocator: function(response) {
                return response;
            }
            , pageSize : 5
            , showPrevious: true
            , showNext: true
            , locator: 'lists'
            , alias: {
                pageNumber: 'startPage'
                , pageSize : 'boardPerPage'
            }
            , callback: function (data) {
                document.querySelector('#place-item-list').innerHTML = "";
                //검색결과 item에 생성
                for ( const item of data ) {
                    document.querySelector('#place-item-list').insertAdjacentHTML('afterbegin',
                        `
                    <div class="place-item-box">
                        <p class="place-item-name">${item.tsTitle}</p>
                        <p class="place-item-address">${item.tsRoad}</p>
                        <input id="place-item-id" type="hidden" value="${item.tsId}">
                    </div>
                    `)
                }
                //검색결과 모든 item에 active 효과
                document.querySelectorAll('.place-item-box').forEach((div) => {
                    div.addEventListener('click', () => {
                        document.querySelectorAll('.place-item-box').forEach((item) => {
                            item.classList.remove('active');
                        });
                        div.classList.add('active');
                    });
                });
            }
        })
    }


</script>
<!-- AdminLTE App -->
<script src="/js/manage/adminlte.js"></script>

</body>
</html>
