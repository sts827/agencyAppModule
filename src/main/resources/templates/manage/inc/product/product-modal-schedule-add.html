<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head></head>
<body>
	<!--일정등록 모달-->
	<div th:fragment="product-modal-schedule-add(strClass, strDataId)" th:class="${strClass}" th:id="${strDataId}">
    <!--스크립트에서 처리-->
    </div>
    <script th:inline="javascript">
		function showScheduleAddModal(type) {
			const scheduleAddModalBox = document.querySelector('.schedule-add-modal-box');
			scheduleAddModalBox.insertAdjacentHTML('beforeend', `
			<div class="schedule-add-modal-inner-box" >
			<div class="schedule-add-modal-top" style="">
				<p class="schedule-add-modal-top-text">일정추가</p>
				<button type="button" onclick="closeScheduleAddModal()"><img src="/images/icon/x-black-17x17.svg" style="width: 17px; height: 17px;" alt=""></button>
			</div>
			<div class="schedule-add-modal-scroll-box">
				<div id="scheduleAddModalScrollInnerBox" class="schedule-add-modal-scroll-inner-box">
					<div class="schedule-add-modal-price-select-box">
						<label style="width: 100%; height: 35px">
							<span class="schedule-p-text">요금방식*</span>
							<select id="priceTypeSelect" style="margin-left: 10px">
								<option value="samePrice">단일금액</option>
								<option value="periodSamePrice">기간 동일금액</option>
								<option value="byDayPrice">출발요일별 차등금액</option>
							</select>
						</label>
						<hr class="schedule-hr-15">
					</div>
					<div style="padding-right: 17px;">
						<div class="start-day-box">
							<p class="schedule-p-text">시작일*</p>
							<div class="calendar-text" id="startDatePicker">
							</div>
						</div>
						<div class="end-day-box">
							<p class="schedule-p-text">종료일*</p>
							<div class="calendar-text" id="endDatePicker">
							</div>
						</div>
						<hr class="schedule-hr">
						<div style="display:flex;">
							<p class="schedule-p-text">기본가격*</p>
							<div>
								<div id="basicPriceOptionBox">
								</div>
								<div class="add-option-btn" onclick="addBasicPriceOption()">
									<p class="add-option-btn-text">판매항목 추가</p>
									<img src="/images/icon/+-white-10x10.svg" style="width: 15px; height: 15px;" alt="">
								</div>

							</div>
						</div>
						<hr class="schedule-hr">
						<div id="byDayPriceOption" class="by-day-price-option-box">
							<div class="by-day-price-option-item-box">
								<label class="schedule-option-item-label">
									<input role="switch" type="checkbox" class="day-checkbox">
									<span class="schedule-p-text" style="margin-right: 21px;">월요일 출발</span>
								</label>
								<div data-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
									<!--스크립트에서 처리-->
								</div>
							</div>
							<div class="by-day-price-option-item-box">
								<label class="schedule-option-item-label">
									<input role="switch" type="checkbox" class="day-checkbox">
									<span class="schedule-p-text" style="margin-right: 21px;">화요일 출발</span>
								</label>
								<div data-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
									<!--스크립트에서 처리-->
								</div>
							</div>
							<div class="by-day-price-option-item-box">
								<label class="schedule-option-item-label">
									<input role="switch" type="checkbox" class="day-checkbox">
									<span class="schedule-p-text" style="margin-right: 21px;">수요일 출발</span>
								</label>
								<div data-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
									<!--스크립트에서 처리-->
								</div>
							</div>
							<div class="by-day-price-option-item-box">
								<label class="schedule-option-item-label">
									<input role="switch" type="checkbox" class="day-checkbox">
									<span class="schedule-p-text" style="margin-right: 21px;">목요일 출발</span>
								</label>
								<div data-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
									<!--스크립트에서 처리-->
								</div>
							</div>
							<div class="by-day-price-option-item-box">
								<label class="schedule-option-item-label">
									<input role="switch" type="checkbox" class="day-checkbox">
									<span class="schedule-p-text" style="margin-right: 21px;">금요일 출발</span>
								</label>
								<div data-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
									<!--스크립트에서 처리-->
								</div>
							</div>
							<div class="by-day-price-option-item-box">
								<label class="schedule-option-item-label">
									<input role="switch" type="checkbox" class="day-checkbox">
									<span class="schedule-p-text" style="margin-right: 21px;">토요일 출발</span>
								</label>
								<div data-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
									<!--스크립트에서 처리-->
								</div>
							</div>
							<div class="by-day-price-option-item-box">
								<label class="schedule-option-item-label">
									<input role="switch" type="checkbox" class="day-checkbox">
									<span class="schedule-p-text" style="margin-right: 21px;">일요일 출발</span>
								</label>
								<div data-div-name="by-day-price-option-item-box-div" class="by-day-price-option-item-box-div">
									<!--스크립트에서 처리-->
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div style="display: flex; justify-content: center; margin-top: 15px;">
				<button type="button" style="width: 75px; height: 35px; margin-right: 10px; font: 600 14px Pretendard; border-radius: 5px; color: #FFFFFF; background-color: #0062D4" onclick="addSchedule()">저장</button>
				<button type="button" style="width: 75px; height: 35px; font: 600 14px Pretendard; border-radius: 5px; color: #FFFFFF; background-color: #383838" onclick="closeScheduleAddModal()">취소</button>
			</div>
		</div>
			`)

			loadPriceOption();
			priceTypeSelect = document.getElementById('priceTypeSelect');
			if (priceTypeSelect.value === 'samePrice') {
				document.getElementById('byDayPriceOption').style.display = 'none';
				scheduleAddModalBox.querySelector('.end-day-box').style.display = 'none';
				postJson.priceSetType = "samePrice";
			}
			priceTypeSelect.addEventListener('change', function() {
				const selectedValue = this.value;

				if (selectedValue === 'samePrice') {
					document.getElementById('byDayPriceOption').style.display = 'none';
					scheduleAddModalBox.querySelector('.end-day-box').style.display = 'none';
					endDate = startDate;
					postJson.endDate = startDate;
					postJson.priceSetType = "samePrice";
				}
				else if (selectedValue === 'byDayPrice') {
					document.getElementById('byDayPriceOption').style.display = 'block';
					scheduleAddModalBox.querySelector('.end-day-box').style.display = 'flex';
					endDate = startDate;
					endDate = scheduleAddModalBox.querySelector('#endDatePicker').textContent.trim().replaceAll(". ", "-");
					postJson.priceSetType = "byDayPrice";
				}
				else if (selectedValue === 'periodSamePrice') {
					document.getElementById('byDayPriceOption').style.display = 'none';
					scheduleAddModalBox.querySelector('.end-day-box').style.display = 'flex';
					endDate = startDate;
					endDate = scheduleAddModalBox.querySelector('#endDatePicker').textContent.trim().replaceAll(". ", "-");
					postJson.priceSetType = "periodSamePrice";
				}
			});

			scheduleAddModalBox.style.display = "flex";

			initStartDatePicker();
			initEndDatePicker();

			const checkboxes = document.querySelectorAll(".day-checkbox");
			checkboxes.forEach((checkbox) => {
				checkbox.addEventListener('change', checkDayCheckBox);
			});

			//요금방식 disable용
			if ( type === 'samePrice' ) {
				priceTypeSelect.disabled = true;
				priceTypeSelect.style.backgroundColor = '#D9D9D9';
				priceTypeSelect.style.color = '#666666';
			}
		}

		function closeScheduleAddModal() {
			document.querySelector('.schedule-add-modal-box').style.display = "none";
			document.querySelector('.schedule-add-modal-box').innerHTML = "";
			postJson = {
				basicPriceList: [],
				priceSequence: '0',
				dayList: {
					0 : [], 1 : [], 2 : [], 3 : [], 4 : [], 5 : [], 6 : [],
				}
			};
		}

		function checkDayCheckBox(event) {
			const checkbox = event.target;
			const scheduleOptionItemBox = checkbox.closest(".by-day-price-option-item-box").querySelectorAll('[data-div-name="by-day-price-option-item-box-div"]');
			const displayStyle = checkbox.checked ? "block" : "none";

			scheduleOptionItemBox.forEach(itemBox => {
				itemBox.style.display = displayStyle;
			});
		}
	</script>
</body>
</html>